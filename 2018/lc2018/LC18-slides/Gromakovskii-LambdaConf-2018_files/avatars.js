define(["require","exports","tslib","esignature_prototype/constants","react","external/prop-types","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/style","modules/clean/avatar/viewer_avatar","modules/clean/datetime","modules/clean/em_string","modules/clean/previews/util","modules/clean/react/pass/constants","modules/clean/react/pass/utils","modules/clean/react/title_bubble","modules/clean/react_format","modules/core/browser_detection","modules/core/user_i18n","modules/core/i18n","modules/clean/react/pass/upsell/tooltip/pass_upsell_tooltip","modules/clean/react/pass/upsell/simple_upsell"],function(e,t,o,n,r,a,s,i,l,p,u,c,m,d,f,h,_,w,g,v,T,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=o.__importDefault(r),a=o.__importStar(a),s=o.__importDefault(s),p=o.__importDefault(p),w=o.__importStar(w),g=o.__importStar(g);var I=(function(e){function t(t){var o=e.call(this,t)||this;return o.allowInteractingWithTooltip=function(){return!1},o.renderAvatarButton=function(){return r.default.createElement("button",{className:"pass-facepile-avatar"},o.getAvatar())},o.state={loadResult:"loaded"},o}return o.__extends(t,e),t.prototype.getInitialsColor=function(){},t.prototype.render=function(){var e=this.wrapAvatarWithTooltip(),t="pending"===this.state.loadResult?"react-pass__face-no-display":"react-pass__face-container";return r.default.createElement("div",{className:t},e)},t.prototype.wrapAvatarWithTooltip=function(){return r.default.createElement(h.TitleBubble,{content:this.getTooltipElement(),position:h.TitleBubble.POSITIONS.BOTTOM,distanceFromTarget:9,isTargetPositionFixed:!0,onMouseEnter:this.props.onMouseEnter,className:this.getTooltipClass(),backgroundColor:this.getInitialsColor(),allowInteractTooltip:this.allowInteractingWithTooltip()},this.renderAvatarButton())},t})(r.default.Component),y=(function(e){function t(t){var o=e.call(this,t)||this;return o.allowInteractingWithTooltip=function(){return o.showPassUpsell},o.state={loadResult:null==o.props.userInfo.photoUrl?"loaded":"pending"},o.boundOnLoad=o.onFinalize.bind(o,!0),o.boundOnError=o.onFinalize.bind(o,!1),o}return o.__extends(t,e),Object.defineProperty(t.prototype,"showPassUpsell",{get:function(){return this.context.isInSimpleUpsellExperiment()&&b.shouldShowSimpleUpsellForAvatar(this.props.userInfo)&&!!this.props.upsellInfo&&this.props.upsellInfo.isViewerEligibleForUpsell},enumerable:!0,configurable:!0}),t.prototype.offlineTooltipTemplate=function(){var e=v._("<b>%(user_name)s</b> <newline/> Viewed %(ago)s",{comment:'Format like "userName <newline> Viewed 5 days ago'});if(m.shouldShowPlatformInfo()){var t=this.props.userInfo.platformType;t===d.PASS_PLATFORM.DESKTOP?e=v._("<b>%(user_name)s</b> <newline/> Viewed %(ago)s <newline/> on desktop",{comment:'Format like "userName <newline> Viewed 5 days ago <newline> on desktop'}):t===d.PASS_PLATFORM.WEB?e=v._("<b>%(user_name)s</b> <newline/> Viewed %(ago)s <newline/> on web",{comment:'Format like "userName <newline> Viewed 5 days ago <newline> on web'}):t===d.PASS_PLATFORM.MOBILE&&(e=v._("<b>%(user_name)s</b> <newline/> Viewed %(ago)s <newline/> on mobile",{comment:'Format like "userName <newline> Viewed 5 days ago <newline> on mobile'}))}return e.replace("%(ago)s",u.ago(1e3*this.props.userInfo.whenLastSeen,!1,!0,!0))},t.prototype.onlineTooltipTemplate=function(){return v._("<b>%(user_name)s</b> <newline/> Viewing now",{comment:'Format like "user_name <newline> Viewing now"'})},t.prototype.accessNameTooltipTemplate=function(e){switch(e){case"owner":return v._("<b>%(user_name)s</b> <newline/> Owner",{comment:'Format like "user_name <newline> Owner"'});case"writer":return v._("<b>%(user_name)s</b> <newline/> Can edit",{comment:'Format like "user_name <newline> Can edit"'});case"reader":return v._("<b>%(user_name)s</b> <newline/> Can comment",{comment:'Format like "user_name <newline> Can comment"'});case"signer":return n.CAN_SIGN_PASS_TEMPLATE;case"reader_no_comment":case void 0:return v._("<b>%(user_name)s</b> <newline/> Can view",{comment:'Format like "user_name <newline> Can view"'})}},t.prototype.isGuestAvatar=function(){return this.props.userInfo.userId&&f.AnonymousViewerUtils.isAnonymousUserId(this.props.userInfo.userId)},t.prototype.getUserAvatarProps=function(){var e=this.props.userInfo,t=e.displayName,n=e.isActive,a=this.isGuestAvatar()?f.AnonymousViewerUtils.getAnonymousViewerInitials(t):g.getInitials(t),s={dimension:32,initials:a,color:this.getInitialsColor(),shape:"CIRCLE"};n||(s.optionalClass="c-avatar--inactive",w.msie&&(s.color="#7B8994"));var l=r.default.createElement(i.InitialsAvatar,o.__assign({},s));return n||(l=r.default.createElement("span",{className:"c-avatar-initials-wrapper"},l)),{alt:t,dimension:32,photoUrl:this.getEffectivePhotoUrl(),defaultAvatar:l,optionalClass:s.optionalClass,shape:"CIRCLE",onLoad:this.boundOnLoad,onError:this.boundOnError}},t.prototype.getEffectivePhotoUrl=function(){return"error"===this.state.loadResult?void 0:this.props.userInfo.photoUrl},t.prototype.getAvatar=function(){var e=this.getUserAvatarProps();return this.props.userInfo.isViewer&&"error"!==this.state.loadResult?r.default.createElement(p.default,o.__assign({},e)):r.default.createElement(s.default,o.__assign({},e))},t.prototype.onFinalize=function(e){if(null!=this.getEffectivePhotoUrl()){this.setState({loadResult:e?"loaded":"error"});var t=this.props,o=t.userInfo.photoUrl,n=t.onLoad;n&&o&&n(o)}},t.prototype.getTooltipClass=function(){return this.showPassUpsell?"seen-state-title-bubble-with-upsell":"seen-state-title-bubble"},t.prototype.getInitialsColor=function(){return this.isGuestAvatar()?l.colorValueForAvatarName(this.props.userInfo.userId):l.colorValueForAvatarName(this.props.userInfo.displayName)},t.prototype.getTooltipElement=function(){var e=c.Emstring.em_snippet(this.props.userInfo.displayName,10);if(this.showPassUpsell&&this.context.getTracker()&&this.context.getUpsellUrl()&&this.context.getVariant()&&this.props.upsellInfo)return r.default.createElement(T.PassUpsellTooltip,{displayName:e,baseColor:this.getInitialsColor(),tracker:this.context.getTracker(),info:this.props.upsellInfo,upsellUrl:this.context.getUpsellUrl(),variant:this.context.getVariant()});var t=void 0;t=this.props.userInfo.isActive?this.onlineTooltipTemplate():null!=this.props.userInfo.whenLastSeen?this.offlineTooltipTemplate():this.accessNameTooltipTemplate(this.props.userInfo.accessLevel);var o=_.reactFormat(t,{user_name:e,b:r.default.createElement("b",{key:"thebold"}),newline:r.default.createElement("br",null)});return r.default.createElement("span",null,o)},t.contextTypes={getTracker:a.func,getUpsellUrl:a.func,getVariant:a.func,isInSimpleUpsellExperiment:a.func},t})(I);t.UserAvatar=y;var A=(function(e){function t(t){return e.call(this,t)||this}return o.__extends(t,e),t.prototype.getDisplayNum=function(){return this.props.moreFacepileCount>=d.MAX_OVERFLOW_BUTTON_INDICATOR?d.MAX_OVERFLOW_BUTTON_INDICATOR:this.props.moreFacepileCount},t.prototype.getMoreFacepileCountText=function(){return this.props.moreFacepileCount>=d.MAX_OVERFLOW_BUTTON_INDICATOR?d.MAX_OVERFLOW_BUTTON_INDICATOR+"+":""+this.props.moreFacepileCount},t.prototype.getAvatar=function(){return r.default.createElement(i.InitialsAvatar,{alt:this.getMoreFacepileCountText(),dimension:32,initials:this.getMoreFacepileCountText(),color:"#7B8994",shape:"CIRCLE",optionalClass:"c-avatar--overflow"})},t.prototype.getTooltipClass=function(){return"seen-state-title-bubble facepile-overflow"},t.prototype.getTooltipElement=function(){return v.ungettext("%(display_num)s other","%(display_num)s others",this.getDisplayNum()).format({display_num:this.getMoreFacepileCountText()})},t})(I);t.OverflowAvatar=A});
//# sourceMappingURL=avatars.min.js-vflF4pBZ1.map