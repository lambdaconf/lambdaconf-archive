define("modules/clean/browse/browse_bolt_client",["require","exports","tslib","modules/clean/ajax","modules/clean/bolt","modules/clean/react/browse/constants"],function(e,t,r,o,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var i=(function(){function e(e){var t=this;this.startLiveUpdate=function(e){void 0===e&&(e=null),e&&(t.handleUpdate=e),t.updateBoltClient(),t.status=a.BrowseBoltClientStatus.Live},this.onBoltRefresh=function(){t.updateBoltClient(),t.status=a.BrowseBoltClientStatus.Live},this.onBoltUpdate=function(){t.handleUpdate&&t.handleUpdate()},this.updateBoltClient=function(){var e=t.boltData.map(function(e){return new s.SignedChannelState("sfj",e.bolt_unique_id,e.latest_sjid.toString(),e.bolt_token)});t.boltClient?t.boltClient.update_states(e):(t.boltClient=new s.BoltClient(e,t.onBoltUpdate,t.onBoltRefresh),t.boltClient.start())},this.userId=e,this.status=a.BrowseBoltClientStatus.NotReady,this.boltData=[]}return e.prototype.isReady=function(){return this.status!==a.BrowseBoltClientStatus.NotReady},e.prototype.setInitialBoltData=function(e){this.boltData=e,this.status=a.BrowseBoltClientStatus.NotLive},e.prototype.fetchInitialBoltData=function(e){var t=this;this.initialBoltDataRequest&&this.initialBoltDataRequest.abort(),this.initialBoltDataRequest=o.WebRequest({url:"/get_browse_bolt_data",dataType:"json",subject_user:this.userId,success:function(r,o,s){t.setInitialBoltData(r),e()},error:function(e,r,o){t.status=a.BrowseBoltClientStatus.NotReady},complete:function(){delete t.initialBoltDataRequest}})},e.prototype.handleUpdateBoltClient=function(e){this.boltData=e,this.updateBoltClient()},e.prototype.getNsMap=function(){var e={};return this.boltData.forEach(function(t){e[t.bolt_unique_id]=parseInt(t.latest_sjid,10)}),e},e.prototype.stopLiveUpdate=function(){this.status=a.BrowseBoltClientStatus.NotLive,this.boltClient&&this.boltClient.unsubscribe()},e})();t.BrowseBoltClient=i}),define("modules/clean/cloud_docs/constants",["require","exports","tslib","external/lodash"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);(function(e){e.PAPER="paper"})(t.PaperFileTypes||(t.PaperFileTypes={}));(function(e){e.GOOGLE_DSS_DOC="gdoc",e.GOOGLE_DSS_SHEET="gsheet",e.GOOGLE_DSS_SLIDES="gslides"})(t.GoogleFileTypes||(t.GoogleFileTypes={}));var s;(function(e){e.WORD="docx",e.EXCEL="xlsx",e.POWERPOINT="pptx"})(s=t.MicrosoftFileTypes||(t.MicrosoftFileTypes={}));(function(e){e.HOME="new_file_menu_home",e.BROWSE="new_file_menu_browse"})(t.NewFileMenuFromType||(t.NewFileMenuFromType={})),t.isMicrosoftFileType=function(e){return o.values(s).includes(e)},t.IFRAME_LOAD_EVENT_TIMEOUT=3e4,t.LOADING_PAGE_URL="/cloud_docs/loading"}),define("modules/clean/cloud_docs/create_api",["require","exports","tslib","modules/clean/cloud_docs/constants","modules/clean/react/async_folder_selector_modal","modules/clean/react/snackbar","modules/clean/react/browse/api","modules/clean/react/browse/action_logger","modules/clean/web_user_action_events","modules/core/browser","modules/core/cookies","modules/core/i18n"],function(e,t,r,o,s,a,i,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),i=r.__importStar(i),c=r.__importStar(c),t.getDepthFromPath=function(e){return(e.replace(/\/$/,"").match(/\//g)||[]).length},t.showAsyncFolderSelectorModal=function(e){var r=e.user,o=e.source,a=e.documentType;s.show({primaryAction:u._("Create"),secondaryAction:u._("Cancel"),title:u._("Create file in..."),ariaLabel:u._("Create file in..."),user:r,initialFolderSelection:"",forceRootSelectable:!1,onFolderSelected:function(e){n.logFileCreateClick({uid:r.id,source:o,action:l.WebUserActionLogEvent.FILE_CREATE_HOME_FOLDER_SELECTED,depth_folder_selected:t.getDepthFromPath(e)}),t.createNewFile({userId:r.id,path:e,documentType:a})},showFolderPicker:!1})},t.createNewFile=function(e){var r=e.userId,s=e.path,a=e.documentType;o.isMicrosoftFileType(a)?p({userId:r,path:s,documentType:a}):t.createNewCloudOnlyDoc({userId:r,pathName:s,title:"Untitled",documentType:a})};var p=function(e){var r=e.userId,o=e.path,s=e.documentType,a={fq_path:o,extension:s,_subject_uid:String(r),t:d.Cookies.read("__Host-js_csrf")},i=t.constructFormForCreateNewMicrosoftFile(a);document.body.appendChild(i),i.submit()};t.constructFormForCreateNewMicrosoftFile=function(e){var t=document.createElement("form");t.action="/ow/msft/create_new_file",t.method="POST",t.target="_blank";for(var r=0,o=Object.keys(e);r<o.length;r++){var s=o[r],a=document.createElement("input");a.type="hidden",a.name=s,a.value=e[s],t.appendChild(a)}return t},t.createNewCloudOnlyDoc=function(e){var t,r=e.userId,s=e.pathName,n=e.title,l=e.documentType;switch(l){case o.PaperFileTypes.PAPER:t="Paper doc";break;case o.GoogleFileTypes.GOOGLE_DSS_DOC:t="Google Docs";break;case o.GoogleFileTypes.GOOGLE_DSS_SHEET:t="Google Sheets";break;case o.GoogleFileTypes.GOOGLE_DSS_SLIDES:t="Google Slides";break;default:t="Cloud Doc"}a.Snackbar.sync(u._("Creating new %(type)s...").format({type:t}),!0);var d=o.LOADING_PAGE_URL+s,p=c.unsafe_open_tab(d);i.createCloudDoc({pathName:s,title:n,documentType:l,userId:r,onSuccess:function(e){var r=(e.changesets,e.createdFile);a.Snackbar.complete(u._("%(type)s created!").format({type:t})),c.redirect(r.preview_url,p)},onError:function(e){a.Snackbar.fail(e)}})}}),define("modules/clean/cloud_docs/new_file_menu",["require","exports","tslib","external/classnames","react","spectrum/icon_partners","spectrum/popover","spectrum/button","spectrum/tertiary_link","modules/clean/cloud_docs/constants","modules/clean/cloud_docs/create_api","modules/clean/react/browse/action_logger","modules/clean/web_user_action_events","modules/clean/react/css","modules/core/i18n"],function(e,t,r,o,s,a,i,n,l,c,d,u,p,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),s=r.__importDefault(s);var f=_._("Google (Alpha)"),m=_._("Microsoft Office Online"),S=_._("Create in Microsoft Office Online");t.NewFileCreateLabel=_._("Create new file");var g=_._("Google Docs"),E=_._("Google Sheets"),F=_._("Google Slides"),w=_._("Excel workbook"),T=_._("PowerPoint presentation"),y=_._("Word document"),v=_._("Paper doc"),b=_._("Dropbox Paper");t.handleNewFileSelection=function(e){e.handleClick()};var R=function(e){switch(e){case c.MicrosoftFileTypes.WORD:return p.WebUserActionLogEvent.FILE_CREATE_WORD;case c.MicrosoftFileTypes.EXCEL:return p.WebUserActionLogEvent.FILE_CREATE_EXCEL;case c.MicrosoftFileTypes.POWERPOINT:return p.WebUserActionLogEvent.FILE_CREATE_POWERPOINT;case c.GoogleFileTypes.GOOGLE_DSS_DOC:return p.WebUserActionLogEvent.FILE_CREATE_GOOGLE_DOC;case c.GoogleFileTypes.GOOGLE_DSS_SHEET:return p.WebUserActionLogEvent.FILE_CREATE_GOOGLE_SHEET;case c.GoogleFileTypes.GOOGLE_DSS_SLIDES:return p.WebUserActionLogEvent.FILE_CREATE_GOOGLE_SLIDES;case c.PaperFileTypes.PAPER:return p.WebUserActionLogEvent.FILE_CREATE_PAPER}},A=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.renderIcon=function(){return s.default.createElement(a.IconPartners,{name:this.props.item.iconName,width:"24px",height:"24px"})},t.prototype.render=function(){return s.default.createElement(i.PopoverContentItem,{key:this.props.item.displayName,value:this.props.item,className:this.props.item.className},s.default.createElement("div",{className:"newfile-popover--item"},this.renderIcon(),s.default.createElement("div",{className:"newfile-popover--item-text"},this.props.item.displayName)))},t})(s.default.Component);t.NewFileTypeRow=A;var C=(function(e){function a(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCreateNewFile=function(e){return function(){u.logFileCreateClick({uid:t.props.user.id,source:t.props.source,action:R(e)}),t.props.path?d.createNewFile({userId:t.props.user.id,path:t.props.path,documentType:e}):d.showAsyncFolderSelectorModal({user:t.props.user,source:t.props.source,documentType:e})}},t.logTriggerClick=function(){u.logFileCreateClick({uid:t.props.user.id,source:t.props.source,action:p.WebUserActionLogEvent.FILE_CREATE_OPEN_MENU})},t}return r.__extends(a,e),a.prototype.getNewFileTypeSections=function(){var e=[];this.props.showPaper&&e.push({title:b,items:[{displayName:v,iconName:"dropbox_paper",className:"action-create-file-paper-doc",handleClick:this.handleCreateNewFile(c.PaperFileTypes.PAPER)}]});var t=[];t.push({displayName:y,iconName:"microsoft_docx",className:"action-create-file-word",handleClick:this.handleCreateNewFile(c.MicrosoftFileTypes.WORD)}),t.push({displayName:w,iconName:"microsoft_xlsx",className:"action-create-file-excel",handleClick:this.handleCreateNewFile(c.MicrosoftFileTypes.EXCEL)}),t.push({displayName:T,iconName:"microsoft_pptx",className:"action-create-file-powerpoint",handleClick:this.handleCreateNewFile(c.MicrosoftFileTypes.POWERPOINT)});var r=!(this.props.showGdd||this.props.showPaper);if(e.push({title:r?S:m,items:t}),this.props.showGdd){var o=[];o.push({displayName:g,iconName:"google_gdoc",className:"action-create-file-google-doc",handleClick:this.handleCreateNewFile(c.GoogleFileTypes.GOOGLE_DSS_DOC)}),o.push({displayName:E,iconName:"google_gsheet",className:"action-create-file-google-sheet",handleClick:this.handleCreateNewFile(c.GoogleFileTypes.GOOGLE_DSS_SHEET)}),o.push({displayName:F,iconName:"google_gslides",className:"action-create-file-google-slides",handleClick:this.handleCreateNewFile(c.GoogleFileTypes.GOOGLE_DSS_SLIDES)}),e.push({title:f,items:o})}return e},a.prototype.renderTrigger=function(){return this.props.primaryButton?s.default.createElement(n.Button,{key:t.NewFileCreateLabel,onClick:this.logTriggerClick,disabled:this.props.disabled,className:o.default("primary-action-menu__button","action-create-file"),tagName:"span"},t.NewFileCreateLabel):s.default.createElement(l.TertiaryLink,{key:t.NewFileCreateLabel,icon:"create",onClick:this.logTriggerClick,disabled:this.props.disabled,className:o.default("secondary-action-menu__button","action-create-file")},t.NewFileCreateLabel)},a.prototype.renderSection=function(e){return s.default.createElement("div",{className:"newfile-popover--section",key:e.title},s.default.createElement("div",{className:"newfile-popover--title"},e.title),e.items.map(function(e){return s.default.createElement(A,{item:e,key:e.displayName})}))},a.prototype.render=function(){return s.default.createElement(i.Popover,{onSelection:t.handleNewFileSelection},s.default.createElement(i.PopoverTrigger,{disabled:this.props.disabled,className:"newfile-popover--trigger"},this.renderTrigger()),s.default.createElement(i.PopoverContent,{attachment:"right"},s.default.createElement("div",{className:"newfile-popover"},this.getNewFileTypeSections().map(this.renderSection))))},a})(s.default.Component),I=h.requireCssWithComponent(C,["/static/css/spectrum/index.web-vflsx5vgZ.css","/static/css/cloud_docs/new_file_menu-vflzcLNNt.css"]);t.NewFileMenu=I}),define("modules/clean/file_operations/notifications",["require","exports","tslib","external/lodash","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/undo","modules/core/html","modules/core/i18n","modules/core/notify"],function(e,t,r,o,s,a,i,n,l,c,d,u){"use strict";function p(e,t,r,o,s){var a=function(){return n.rollbackChangeSets({changesets:r,userId:t.id,progressText:d._("Undoing…"),rollbackHints:o?o:void 0,onSuccess:function(){u.Notify.success(d._("Undo complete.")),s&&s()}})};l.notifyWithUndo(e,r,a)}function h(e,t){var r=s.browse_uri_for_fq_path(t,e),n=a.Emstring.em_snippet(i.filename(e),40);return{href:r,text:o.escape(n)}}function _(e,t,r,o,s,a){var i;if(o){var n=h(o,t);i=d.ungettext('Copied %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Copied %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e).format({num_items:e,dest_href:n.href,dest_name:n.text}),i=new c.HTML(i)}else i=d.ungettext("Copied %(num_items)d item.","Copied %(num_items)d items.",e).format({num_items:e});p(i,t,r,s,a)}function f(e,t,r,o,s,a){var i;if(o){var n=h(o,t);i=d.ungettext('Moved %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Moved %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e).format({num_items:e,dest_href:n.href,dest_name:n.text}),i=new c.HTML(i)}else i=d.ungettext("Moved %(num_items)d item.","Moved %(num_items)d items.",e).format({num_items:e});p(i,t,r,s,a)}function m(e,t,r,o,s){p(d.ungettext("Deleted %(num_items)d item.","Deleted %(num_items)d items.",e).format({num_items:e}),t,r,o,s)}function S(e,t,r,o){p(d._("Rename complete."),e,t,r,o)}function g(e,t,r){p(d._("Created folder %(folder_name)s.").format({folder_name:e}),t,r)}function E(e){var t=d.ungettext("Permanently deleted %(num)s item.","Permanently deleted %(num)s items.",e).format({num:e});u.Notify.success(t)}function F(e){var t,r=e.length;if(1===r){var s=o.escape(i.filename(e[0].fq_path));t=d._("Restored <strong>%(filename)s</strong>.").format({filename:s}),t=new c.HTML(t)}else t=d.ungettext("Restored %(num)s file.","Restored %(num)s files.",r).format({num:r});u.Notify.success(t)}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),i=r.__importStar(i),n=r.__importStar(n),l=r.__importStar(l),t.notifyCopySuccess=_,t.notifyMoveSuccess=f,t.notifyDeleteSuccess=m,t.notifyRenameSuccess=S,t.notifyFolderCreationSuccess=g,t.notifyPurgeSuccess=E,t.notifyRestoreSuccess=F}),define("modules/clean/pagination_manager",["require","exports","tslib","modules/clean/ajax","modules/core/i18n","modules/core/notify"],function(e,t,r,o,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var i=(function(){function e(e){this.hasMoreItems=e}return e.prototype.areAllItemsReady=function(){return!this.hasMoreItems},e.prototype.invalidateHasMore=function(){this.hasMoreItems=!0},e.prototype.addDataToAjax=function(e){},e})(),n=(function(){function e(e){this.ajaxURL=e.ajaxURL,this.newDataCallback=e.newDataAvailableCallback,this.autoFetching=!1,this.mode=e.mode,this.keyName=e.keyName,this.items={},this.pages=[],this.nextRequestVoucher=e.firstPage.next_request_voucher,this.userID=e.userID,this.fqPathPrefix=e.fqPathPrefix?"/"+e.fqPathPrefix:"",this.addPage(e.firstPage.items)}return e.prototype.areAllItemsReady=function(){return this.mode.areAllItemsReady()},e.prototype.addPage=function(e){for(var t=[],r=[],o=0,i=e;o<i.length;o++){var n=i[o],l=n[this.keyName];if(null==l)return void a.Notify.warning(s._("Invalid server response"));null==this.items[l]&&(this.items[l]=n,r.push(n),t.push(l))}this.pages.push(t),this.newDataCallback(this,r)},e.prototype.startAutoFetching=function(){this.autoFetching=!0,this.fetchNext()},e.prototype.stopAutoFetching=function(){this.autoFetching=!1},e.prototype.reSync=function(e){void 0===e&&(e=!1),e&&(this.nextRequestVoucher=null,this.items={},this.pages=[]);var t=this.autoFetching&&this.mode.areAllItemsReady();this.mode.invalidateHasMore(),t&&this.startAutoFetching()},e.prototype.fetchNext=function(){var e=this;if(!this.mode.areAllItemsReady()){var t={};this.nextRequestVoucher&&(t.voucher=this.nextRequestVoucher),this.mode.addDataToAjax(t),o.WebRequest({url:this.ajaxURL,data:t,subject_user:this.userID,success:function(t){var r=JSON.parse(t);e.nextRequestVoucher=r.next_request_voucher,e.mode.hasMoreItems=r.has_more_items,e.autoFetching&&e.fetchNext();for(var o=0,s=r.items;o<s.length;o++){var a=s[o];a.fq_path=e.fqPathPrefix+a.fq_path}e.addPage(r.items)},error:function(){a.Notify.error(s._("There was a problem completing this request."))}})}},e.prototype.loadedPageCount=function(){return this.pages.length},e.prototype.getLoadedPage=function(e){var t=this,r=this.pages[e];return null==r?null:r.map(function(e){return t.items[e]})},e.prototype.getLastLoadedPage=function(){return this.getLoadedPage(this.loadedPageCount()-1)},e})();t.BasePaginationManager=n;var l=(function(e){function t(t){return e.call(this,r.__assign({},t,{mode:new i(t.firstPage.has_more_items)}))||this}return r.__extends(t,e),t.create=function(e){return new t(e)},t})(n);t.PaginationManager=l}),define("modules/clean/react/app_actions/app_actions_store",["require","exports","tslib","modules/clean/filepath","modules/clean/api_v2/client"],function(e,t,r,o,s){"use strict";function a(e){return void 0!==e.ext}function i(e){return void 0!==e.fq_path}function n(e){return a(e)?e.ext:i(e)?"."+o.file_extension(o.filename(e.fq_path)):void 0}function l(){return d||(d=new c(new s.ApiV2Client)),d}Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(e){this.actionIdToAppAction={},this.client=e}return e.prototype.getActionsForFile=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var o;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this.getActionsForFileBatch([e],t)];case 1:return o=r.sent(),[2,o[e.file_id]]}})})},e.prototype.getActionsForFileBatch=function(e,t){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(r){return[2,this.loadActionsByUser(e,t)]})})},e.prototype.loadActionsByUser=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var o,s,a,i;return r.__generator(this,function(r){switch(r.label){case 0:this.stateRequest||(this.stateRequest=this.loadActions(t)),o=this.stateRequest,s={},r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.stateRequest];case 2:return a=r.sent(),e.forEach(function(e){var t=void 0,r=n(e);r&&(t=a.extToCategories[r]),t||!a.appActionsEnabled||e.is_dir||(t=[]),t&&(s[e.file_id]=t)}),[3,4];case 3:return i=r.sent(),o===this.stateRequest&&(this.stateRequest=void 0),[3,4];case 4:return[2,s]}})})},e.prototype.loadActions=function(e){return r.__awaiter(this,void 0,void 0,function(){var t,o,s=this;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this.client.ns("app_actions").rpc("get_available_actions_for_user",void 0,{subjectUserId:e})];case 1:return t=r.sent(),t.actions.forEach(function(e){s.actionIdToAppAction[e.id]||(s.actionIdToAppAction[e.id]=e)}),o={},t.exts_to_action_ids.forEach(function(e){var t={},r=[];e.action_ids.forEach(function(e){var o=s.actionIdToAppAction[e],a=t[o.category];a?a.actions.push(o):(a={categoryId:o.category,actions:[o]},t[o.category]=a,r.push(a))}),r=r.map(function(e){return{categoryId:e.categoryId,actions:s.prioritizeActions(e.actions)}}),r.sort(function(e,t){return e.categoryId<t.categoryId?-1:t.categoryId<e.categoryId?1:0}),o[e.ext]=r}),[2,{appActionsEnabled:t.app_actions_enabled,extToCategories:o}]}})})},e.prototype.prioritizeActions=function(e){return e.sort(function(e,t){return e.priority&&t.priority?t.priority-e.priority:e.priority?-1:t.priority?1:e.description<t.description?-1:e.description>t.description?1:0})},e})();t.AppActionsStore=c;var d;t.getAppActionsStore=l}),define("modules/clean/react/app_actions/education/async_extensions_edu_modal",["require","exports","tslib","react","modules/clean/react/modal"],function(e,t,r,o,s){"use strict";function a(){var t=this;return new Promise(function(a){return r.__awaiter(t,void 0,void 0,function(){var t;return r.__generator(this,function(i){switch(i.label){case 0:return[4,new Promise(function(t,r){e(["modules/clean/react/app_actions/education/edu_modal_component"],t,r)}).then(r.__importStar)];case 1:return t=i.sent().AppActionsEduModal,a(s.Modal.showInstance(o.default.createElement(t,null))),[2]}})})})}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),t.asyncShowExtensionsEduModal=a});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/async_fileops_modals",["require","exports"],function(e,t){"use strict";function r(t){new Promise(function(t,r){e(["modules/clean/react/fileops_modals"],t,r)}).then(__importStar).then(t)}function o(e){r(function(t){return(0,t.showCopy)(e)})}function s(e){r(function(t){return(0,t.showMove)(e)})}function a(e){r(function(t){return(0,t.showUpload)(e)})}function i(e){r(function(t){return(0,t.showAdminUpload)(e)})}function n(t){new Promise(function(t,r){e(["modules/clean/react/folder_dialog/move_dialog_modal"],t,r)}).then(__importStar).then(function(e){return e.MoveDialogModal.show(t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.showCopy=o,t.showMove=s,t.showUpload=a,t.showAdminUpload=i,t.showMoveDialog=n});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/async_folder_selector_modal",["require","exports"],function(e,t){"use strict";function r(t){new Promise(function(t,r){e(["modules/clean/react/folder_selector_modal"],t,r)}).then(__importStar).then(function(e){e.FolderSelectorModal.show(t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.show=r});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/async_onboarding_move_modal",["require","exports"],function(e,t){"use strict";function r(t){new Promise(function(t,r){e(["modules/clean/react/onboarding_folder_dialog/onboarding_move_dialog"],t,r)}).then(__importStar).then(t)}function o(e){r(function(t){return(0,t.showMove)(e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.showOnboardingMoveDialog=o}),define("modules/clean/react/browse/actions",["require","exports","tslib","external/immutable","modules/clean/downloads","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/history","modules/clean/react/fileops_actions","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/action_logger","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/data/action_creators","modules/clean/react/browse/data/store","modules/clean/react/browse/dispatcher","modules/clean/react/browse/models","modules/clean/react/browse/nav_actions","modules/clean/react/browse/store","modules/constants/python","modules/core/browser","modules/core/i18n","modules/clean/search/constants","modules/clean/react/file_viewer/async_controller","modules/clean/search/search_results/dispatcher","modules/clean/react/files_view/types","modules/clean/user_education/user_education_client","modules/clean/sharing/browse_exports","modules/clean/cloud_docs/constants","modules/clean/flux/dispatcher"],function(e,t,r,o,s,a,i,n,l,c,d,u,p,h,_,f,m,S,g,E,F,w,T,y,v,b,R,A,C,I){"use strict";function P(){return e("modules/clean/react/file_viewer/controller")}function O(){return e.defined("modules/clean/react/file_viewer/controller")}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),a=r.__importStar(a),i=r.__importStar(i),n=r.__importDefault(n),l=r.__importStar(l),c=r.__importStar(c),u=r.__importStar(u),h=r.__importStar(h),F=r.__importStar(F),T=r.__importStar(T);var N=(function(){function e(e){var o=this;this.nameNewFolder=function(){o.reduxStore.dispatch(h.setNewFolderCreationState({newFolderCreationState:b.NewFolderCreationState.PENDING_INPUT}))},this.createFolderPending=function(){d.logCreateFolderPending(),o.reduxStore.dispatch(h.setNewFolderCreationState({newFolderCreationState:b.NewFolderCreationState.SAVING_INPUT}))},this.cancelCreateFolder=function(){d.logCreateFolderCancel(),o.reduxStore.dispatch(h.setNewFolderCreationState({newFolderCreationState:b.NewFolderCreationState.CREATE_FOLDER_INACTIVE})),window.setTimeout(function(){R.UEClient.sendEvent("CdmNewFolderModal","maybeFinished")},2500)},this.createFolderComplete=function(e){var t=e.folderName,r=e.user,s=e.changesets;d.logCreateFolderSuccess(),o.reduxStore.dispatch(h.setNewFolderCreationState({newFolderCreationState:b.NewFolderCreationState.CREATE_FOLDER_INACTIVE})),a.notifyFolderCreationSuccess(t,r,s),window.setTimeout(function(){R.UEClient.sendEvent("CdmNewFolderModal","maybeFinished")},2500)},this.createFolder=function(e){var t=e.folderName,s=e.pathName,a=e.nsId,n=void 0===a?null:a,l=e.checkFSWs,u=e.showShareModalOnSuccess,p=e.redirectOnSuccess,h=g.getBrowseStore().user();o.createFolderPending(),o.dataApi.createNewFolder({pathName:s,folderName:t,nsId:n,checkFSWs:l,userId:h.id,onSuccess:function(s){var a=s.changesets,n=s.createdFolder,l=s.failureDetails;if(l){var d=function(){o.createFolder(r.__assign({},e,{checkFSWs:!1}))};c.showFileSystemWarningsModal({fsws:l,onFinalAccept:d,confirmText:w._("Create folder"),onAbortAction:o.cancelCreateFolder})}else{var _=n?i.filename(n.fq_path):t;o.createFolderComplete({user:h,folderName:_,changesets:a}),n&&(o.selectRowsFromBoltClient([n]),p&&p(n.fq_path),u&&o.handleShowShareModal(n,"browse_new_folder_modal"))}},onError:function(){d.logCreateFolderError(),o.cancelCreateFolder()}})},this.createFolderInNewFolderModal=function(e){var r=e.folderName,s=e.isConfidential,a=e.user,i=e.context;s&&!i.isInsideTeamFolderTree?A.asyncShowNewFolderShareModal(a,null,i.currentFQPath,r,!1,!1,null,S.browseNavActions.setPath,S.browseNavActions.setUrl):t.browseActions.createFolder({pathName:i.currentFQPath,folderName:r,nsId:i.rootNSID,checkFSWs:!1,showShareModalOnSuccess:(a.is_cdm_member||s)&&i.isInsideTeamFolderTree,redirectOnSuccess:o.handleNewFolderRedirectOnSuccess})},this.handleNewFolderRedirectOnSuccess=function(e){S.browseNavActions.setUrl({path:e})},this.doDeleteFilesWithModal=function(e){var t=e.files,r=g.getBrowseStore(),s=r.user(),n=r.context();c.showDelete(s,t,n,i.filename(n.currentFQPath),function(){o.dataApi.deleteFiles({files:t,userId:s.id,onSuccess:function(e){var r=e.changesets,i=e.rollbackHints,n=e.fileDeltas;v.SearchResultsDispatcher.dispatch({type:T.CHANGE_FILES_ACTION,data:{fileDeltas:n.filter(function(e){return!!e.before}).map(function(e){return{before:e.before.fq_path,after:null}})}}),a.notifyDeleteSuccess(t.length,s,r,i,function(){o.selectRowsFromBoltClient(t),v.SearchResultsDispatcher.dispatch({type:T.CHANGE_FILES_ACTION,data:{fileDeltas:n.filter(function(e){return!!e.before}).map(function(e){return{before:null,after:e.before}})}})})}})})},this.onPurgeSuccessCallback=function(e){a.notifyPurgeSuccess(e.length),t.browseActions.reloadCurrentPath(),v.SearchResultsDispatcher.dispatch({type:T.CHANGE_FILES_ACTION,data:{fileDeltas:e.map(function(e){return{before:e.fq_path,after:null}})}})},this.onPurge=function(e,t){o.dataApi.purgeFiles({files:t,userId:e,onSuccess:o.onPurgeSuccessCallback})},this.doPermanentDeleteWithModal=function(e){var t=e.files,r=g.getBrowseStore(),s=r.user(),a=r.context();c.showPurgeModal({userId:s.id,context:a,files:t,onPurge:o.onPurge})},this.onRestore=function(e,t,r){o.dataApi.restoreFiles({files:t,userId:e,onSuccess:function(){a.notifyRestoreSuccess(t)},isSearchMode:r})},this.doRestoreFilesWithUnifiedTrashModal=function(e){var t=e.files,r=g.getBrowseStore(),s=r.user(),a=r.context();c.showUnifiedTrashModal({userId:s.id,context:a,files:t,onRestore:function(e,t){o.onRestore(e,t,!1)}})},this.fetchFolderSizes=function(e){var t=e.file;return r.__awaiter(o,void 0,void 0,function(){var e,o,s,a,i,n,l,c,d;return r.__generator(this,function(r){switch(r.label){case 0:e=g.getBrowseStore().user(),o=p.MAX_FOLDER_SIZE_ITERATIONS,r.label=1;case 1:return r.trys.push([1,7,,8]),this.reduxStore.dispatch(h.requestFolderSizes({fqPath:t.fq_path})),[4,this.dataApi.fetchSharedFolderSizes(e.id,{fq_path:t.fq_path})];case 2:return s=r.sent(),this.reduxStore.dispatch(h.setFolderSizesPending({fetchFolderSizesResp:s})),a=[],[4,this.fetchAndSetSameNamespaceFolderSize(e.id,{fq_path:t.fq_path,folder_limit:p.MAX_FOLDERS_PER_CALL})];case 3:i=r.sent(),i.queue&&(a=a.concat(i.queue)),r.label=4;case 4:return a.length>0&&o>0?(o--,n=Math.min(p.MAX_FOLDER_SIZE_QUEUE_SIZE,a.length),l=a.splice(0,n),[4,this.fetchAndSetSameNamespaceFolderSize(e.id,{fq_path:t.fq_path,folder_limit:p.MAX_FOLDERS_PER_CALL,queue:l})]):[3,6];case 5:return i=r.sent(),i.queue&&a&&(a=a.concat(i.queue)),[3,4];case 6:return c=0!==o&&i.queue&&0===i.queue.length?b.FetchFolderSizeState.COMPLETE:b.FetchFolderSizeState.ERROR,this.reduxStore.dispatch(h.completeFolderSizes({fetchFolderSizeState:c})),[3,8];case 7:return d=r.sent(),this.reduxStore.dispatch(h.completeFolderSizes({fetchFolderSizeState:b.FetchFolderSizeState.ERROR})),[3,8];case 8:return[2]}})})},this.fetchMultipleFolderSizes=function(e){var t=e.files;return r.__awaiter(o,void 0,void 0,function(){var e,o,s;return r.__generator(this,function(r){switch(r.label){case 0:e=0,o=t.toArray(),r.label=1;case 1:return e<o.length?(s=o[e],[4,this.fetchFolderSizes({file:s})]):[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},this.dataApi=e,this.reduxStore=_.getStoreForBrowse()}return e.prototype.initializeEverything=function(e){var t=e.path,r=e.files,o=e.paginatedTotalNumFiles,s=e.context,a=e.mountPoints,i=e.fqPathsToSelect,n=e.loadingState,l=e.teamFolders;f.BrowseDispatcher.dispatch({type:p.DEPRECATED__BrowseActionType.INITIALIZE_EVERYTHING,data:{path:t,files:r,paginatedTotalNumFiles:o,context:s,mountPoints:a,fqPathsToSelect:i,loadingState:n,teamFolders:l}}),I.Dispatcher.dispatch({type:p.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:t,files:r}})},e.prototype.load=function(e){var t=e.path,r=e.files,o=e.paginatedTotalNumFiles,s=e.context;S.browseNavActions.load({path:t,files:r,paginatedTotalNumFiles:o,context:s})},e.prototype.addFilesAndSetLoadingState=function(e){var t=e.path,r=e.loadingState,o=e.files,s=e.paginatedTotalNumFiles;S.browseNavActions.addFilesAndSetLoadingState({path:t,loadingState:r,files:o,paginatedTotalNumFiles:s})},e.prototype.setPath=function(e){var t=e.path,r=e.ajaxWebTimer;S.browseNavActions.setPath({path:t,ajaxWebTimer:r})},e.prototype.reloadCurrentPath=function(){var e=g.getBrowseStore();this.setPath({path:e.path()})},e.prototype.updatePreview=function(e){var t=e.files;O()&&P().updateFiles(t)},e.prototype.closeFileViewer=function(){O()&&P().close()},e.prototype.setUrl=function(e){var t=e.path,r=e.qargs;S.browseNavActions.setUrl({path:t,qargs:r})},e.prototype.selectRowsFromBoltClient=function(e){void 0===e&&(e=[]),this.reduxStore.dispatch(h.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:o.Set(e.map(function(e){return e.fq_path}))}))},e.prototype.copyFiles=function(e){l.copyFiles(e)},e.prototype.moveFiles=function(e){l.moveFiles(e)},e.prototype.openLocalCopy=function(e){var t=e.nsId,r=e.nsPath,o=e.userId,s=e.onSuccess,a=e.onError;this.dataApi.openLocalCopy({nsId:t,nsPath:r,userId:o,onSuccess:s,onError:a})},e.prototype.selectFilesAfterUpload=function(e){var t=e.fqPathsToSelect;f.BrowseDispatcher.dispatch({type:p.DEPRECATED_PRIVATE__BrowseActionType.SELECT_FILES_AFTER_UPLOAD,data:{fqPathsToSelect:t}})},e.prototype.selectFilesByFqPath=function(e){var t=e.fqPathsToSelect;this.reduxStore.dispatch(h.selectFilesByFqPath({fqPathsToSelect:t}))},e.prototype.navigateToFileOrFolder=function(e){var t=e.file,r=e.shouldFocusComment,o=void 0!==r&&r,s=e.shouldPrepareForSignature,a=void 0!==s&&s,i=e.onFileViewerUnmount,n=e.fileViewAction,l=void 0===n?E.FileViewActionType.CLICK:n,d=e.fileViewOrigin,p=void 0===d?E.FileViewOriginType.BROWSE:d,h=g.getBrowseStore().user(),_=g.getBrowseStore().context();t.isDeleted?this.doRestoreFilesWithUnifiedTrashModal({files:[t]}):t.is_dir?m.File.isNoAccessSharedFolder(t)?c.showNoAccess(h,t,_):this.setUrl({path:t.fq_path}):this.openPreviewForBrowseFile(t,o,a,h,l,p,function(e){return u.fetchPreviewData(e,h)},i)},e.prototype.openPreviewForBrowseFile=function(e,t,r,o,s,a,n,l){var c=g.getBrowseStore().getIndexOfFile(e),d=c<0?[e]:g.getBrowseStore().files().toArray();if(c<0?c=0:d[c]=e,e.is_cloud_doc&&n){var u=C.LOADING_PAGE_URL+i.parent_dir(e.fq_path),h=F.unsafe_open_tab(u);n(e).then(function(e){e.preview_url&&null!==h&&F.redirect(e.preview_url,h)})}else{var _=function(){y.showElementsBehindFileViewer(),
l&&l()};y.asyncOpenPreview({containerId:p.BROWSE_FILE_VIEWER_ELEMENT_ID,files:d,indexOfPreviewFile:c,shouldFocusComment:t,user:o,onFileViewerDidMount:y.hideElementsBehindFileViewer,onFileViewerUnmount:_,fileViewAction:s,fileViewOrigin:a,fileViewTarget:E.FileViewTargetType.PRIVATE,filePreviewDataFetcher:n,shouldPrepareForSignature:r})}},e.prototype.navigateToResultObjectParentFolder=function(e){var t=e.file,r=e.fileViewAction;void 0===r&&E.FileViewActionType.CLICK;if(m.File.isNoAccessSharedFolder(t))c.showNoAccess(g.getBrowseStore().user(),t,g.getBrowseStore().context());else{var o=i.parent_dir(t.fq_path);this.setUrl({path:o})}},e.prototype.navigateToParentFolder=function(){var e=i.parent_dir(g.getBrowseStore().path());this.setUrl({path:e})},e.prototype.setShouldShowDeletedFiles=function(e){var t=e.shouldShowDeletedFiles,r=e.shouldReloadFolder,o=void 0===r||r,s=e.shouldUpdateUrl,a=void 0===s||s;this.reduxStore.dispatch(h.setShouldShowDeletedFiles({shouldShowDeletedFiles:t})),o&&this.reloadCurrentPath(),a&&(t?n.default.update_query_param(p.BrowseQueryArg.d,"1"):n.default.remove_query_param(p.BrowseQueryArg.d))},e.prototype.sortFiles=function(e){var t=e.sortField,r=e.sortDirection;f.BrowseDispatcher.dispatch({type:p.DEPRECATED__BrowseActionType.SORT_FILES,data:{sortField:t,sortDirection:r}})},e.prototype.downloadFiles=function(e){var t=e.files,r=e.context,o=e.user;if(1===t.count()&&!t.first().is_dir)return void s.get_blockserver_link({url:t.first().direct_blockserver_link});if(r.blockHash){var a=r.currentFQPath,i=t.toArray().map(function(e){return e.fq_path});s.get_zip({fq_paths:i,subject_uid:o.id,block_hash:r.blockHash,parent_path:a})}},e.prototype.setDataApi=function(e){this.dataApi=e,S.browseNavActions.setDataApi(e)},e.prototype.fetchAndSetSameNamespaceFolderSize=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var o;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this.dataApi.fetchSameNamespaceFolderSizes(e,t)];case 1:return o=r.sent(),this.reduxStore.dispatch(h.setFolderSizesPending({fetchFolderSizesResp:o})),[2,o]}})})},e.prototype.handleShowShareModal=function(e,t){var r=g.getBrowseStore(),o=r.user(),s=r.context();A.asyncShowShareModal(o,e,{browseContext:s,origin:t},S.browseNavActions.setPath,S.browseNavActions.setUrl)},e.prototype.handleShowShareInterstitialModal=function(e,t,r,o,s){var a=g.getBrowseStore(),i=a.user(),n=a.context();A.expAsyncShowShareInterstitialModal(i,e,r,o,s,{browseContext:n,origin:t},S.browseNavActions.setPath,S.browseNavActions.setUrl)},e})();t.browseActions=new N(u)}),define("modules/clean/react/browse/api",["require","exports","tslib","external/lodash","modules/clean/ajax","modules/clean/api_v2/client","modules/clean/react/browse/models","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,r,o,s,a,i,n,l,c){"use strict";function d(e){try{return JSON.parse(e)}catch(e){if(!(e instanceof SyntaxError))throw e}return null}function u(e){var t=e.sortLabel,r=e.sortIsAscending,o=e.path,a=e.userId,i=e.onSuccess,n=e.includeDeletedFiles,l=void 0!==n&&n,c=e.sortFoldersFirst,u=void 0===c||c,p=e.onError;return s.WebRequest({data:{sort_label:t,sort_is_ascending:r.toString(),show_deleted:l||"",sort_folders_first:u,include_file_info:"True",path2:o},url:"/browse",subject_user:a,success:function(e,t,r){var s=d(e);s&&i({path:o,data:s,xhr:r})},error:function(e,t,r){p&&p(e,t,r)}})}function p(e){var t=e.files,r=e.newPath,a=e.userId,c=e.onSuccess,d=e.checkFSWs,u=t.map(function(e){return e.fq_path});return u.includes(r)?(l.Notify.error(n._("You can’t copy a folder into itself.")),null):s.WebProgressRequest({url:"/cmd/copy",data:{files:u,to_path:r,fsw_request:d?"check":void 0},subject_user:a,progress_text:n._("Copying files..."),success:function(e){try{var t=o.isString(e)?JSON.parse(e):e;c({newFiles:t.new_browse_files?t.new_browse_files.map(i.File.fromServerObject):[],destinationPath:r,changesets:t.changesets,rollbackHints:t.rollback_hints,failureDetails:t.failure_details})}catch(e){}}})}function h(e){var t=e.files,r=e.userId,a=e.onSuccess,i=t.map(function(e){return e.fq_path});return s.WebProgressRequest({url:"/cmd/delete",data:{files:i},subject_user:r,progress_text:n._("Deleting files..."),success:function(e){try{var r=o.isString(e)?JSON.parse(e):e;a({fileDeltas:t.map(function(e){return{before:e,after:null}}),changesets:r.changesets,rollbackHints:r.rollback_hints})}catch(e){}}})}function _(e){var t=e.path,r=e.files,a=e.newPath,c=e.userId,d=e.onSuccess,u=e.allowOwnershipTransfer,p=e.checkFSWs;if(t===a)return l.Notify.error(n._("Those files already exist in that folder.")),null;var h=r.map(function(e){return e.fq_path});return h.includes(a)?(l.Notify.error(n._("You can’t move a folder into itself.")),null):s.WebProgressRequest({url:"/cmd/move",data:{files:h,to_path:a,allow_ownership_transfer:u,fsw_request:p?"check":void 0},subject_user:c,progress_text:n._("Moving files..."),skipNotifyError:!u,success:function(e){try{var r=o.isString(e)?JSON.parse(e):e;d({path:t,destinationPath:a,newFiles:r.new_browse_files?r.new_browse_files.map(i.File.fromServerObject):[],changesets:r.changesets,rollbackHints:r.rollback_hints,failureDetails:r.failure_details})}catch(e){}},error:function(t,r,o){l.Notify.error(o),e.onError&&e.onError(o)}})}function f(e){var t=e.files,r=e.userId,o=e.onSuccess,a=e.isSearchMode;return s.WebProgressRequest({url:"/cmd/restore",data:{files:t.map(function(e){return e.fq_path}),source:a?"search":"browse"},subject_user:r,dataType:"json",progress_text:n._("Restoring…"),success:function(){o()}})}function m(e){var t=e.files,r=e.userId,o=e.onSuccess,a=e.progressText,i=void 0===a?n._("Deleting…"):a;return s.WebProgressRequest({url:"/cmd/purge",data:{files:t.map(function(e){return e.fq_path})},subject_user:r,dataType:"text",progress_text:i,success:function(e){var r=d(e);r&&"success"===r.status&&o(t)}})}function S(e){var t=e.userId,r=e.changesets,o=void 0===r?null:r,a=e.progressText,i=e.rollbackHints,n=void 0===i?{}:i,l=e.onSuccess;return s.WebProgressRequest({url:"/cmd/rollback",data:{ns_to_cs:JSON.stringify(o),rollback_hints:JSON.stringify(n)},subject_user:t,progress_text:a,success:function(){l()}})}function g(e){var t=e.pathName,r=e.folderName,o=e.userId,a=e.onSuccess,n=e.onError,l=e.checkFSWs;return s.WebProgressRequest({url:new c.URI({path:"/cmd/new"+t}).toString(),data:{to_path:r,folder:"yes",fsw_request:l?"check":void 0},subject_user:o,success:function(e){var t=d(e);if(t){var r=t.new_browse_files?i.File.fromServerObject(t.new_browse_files[0]):null;a({changesets:t.changesets,createdFolder:r,failureDetails:t.failure_details})}},error:function(){n()}})}function E(e){var t=e.pathName,r=e.title,o=e.documentType,a=e.userId,n=e.onSuccess,l=e.onError,u=(t+"/"+r+"."+o).replace("//","/");return s.WebRequest({url:new c.URI({path:"/cmd/create_cloud_doc"}).toString(),subject_user:a,data:{to_path:u,title:r},success:function(e){var t=d(e);if(t){n({changesets:null,createdFile:i.File.fromServerObject(t.new_browse_files[0])})}},error:function(e,t,r){l(r)},skipNotifyError:!0})}function F(e){var t=e.path,r=e.userId,a=e.namespaceToJournalIdMap,i=e.onSuccess,n=e.includeDeletedFiles,l="/"===t?"":t,c={fq_dir:l,ns_map:o.map(a,function(e,t){return t+"_"+e}).join(","),show_deleted:!!n};return s.WebRequest({url:"/update/list_dir",subject_user:r,data:c,dataType:"text",success:function(e){var t=d(e);t&&i(t)}})}function w(e,t){if(!b(e))return Promise.resolve(e);var o=[[e.ns_id,e.sjid,e.fq_path.substr(0,e.fq_path.length-e.ns_path.length)]];return new Promise(function(a,i){s.WebRequest({data:{nsid_sjid_fq_mount_point_tuples:JSON.stringify(o)},url:"/browse_file_info",dataType:"json",subject_user:t,success:function(t,o,s){var i=t.file_results[0];a(r.__assign({},e,i))},error:function(e,t,r){i(r)}})})}function T(e,t){return(new a.ApiV2Client).ns("folders").rpc("get_shared_subfolder_sizes",t,{subjectUserId:e})}function y(e,t){return(new a.ApiV2Client).ns("folders").rpc("get_subfolder_sizes_in_same_namespace",t,{subjectUserId:e})}function v(t){var o,s=t.nsId,a=t.nsPath,i=t.userId,n=t.onSuccess,l=t.onError;return o="string"==typeof a?a.startsWith("/")?a:"/"+a:"/",new Promise(function(t,r){e(["modules/clean/unity/features"],t,r)}).then(r.__importStar).then(function(e){e.UnityFeatures.open_file(s,o,i,n,l,!1)})}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),t.loadPath=u,t.copyFiles=p,t.deleteFiles=h,t.moveFiles=_,t.renameFile=function(e){var t=e.file,r=e.name,o=e.user;return new Promise(function(e,a){s.WebRequest({url:new c.URI({path:"/cmd/rename"+t.fq_path}).toString(),subject_user:o.id,data:{to_path:r},success:function(r){var o=d(r);if(o){var s=t.merge(o.new_browse_files[0]);e({changesets:o.changesets,renamedFile:s,rollbackHints:o.rollback_hints})}else a(r)},error:a})})},t.restoreFiles=f,t.purgeFiles=m,t.rollbackChangeSets=S,t.createNewFolder=g,t.createCloudDoc=E,t.getChangesForDirectory=F;var b=function(e){return e.is_cloud_doc||!(e.event_type||e.preview_url||e.preview_thumbnail_url||e.preview_type||e.linkfile_data||e.htmlified_link||e.preview_ssr_image_url_tmpl||e.preview_ssr_refresh_url||e.preview_ssr_text_url_tmpl)};t.fetchPreviewData=w,t.fetchSharedFolderSizes=T,t.fetchSameNamespaceFolderSizes=y,t.openLocalCopy=v}),define("modules/clean/react/browse/browse",["require","exports","tslib","react","external/react-redux","modules/clean/react/browse/controller","modules/clean/react/browse/data/action_creators","modules/clean/react/browse/data/selectors","modules/clean/react/browse/data/store","modules/clean/react/browse/store","modules/clean/react/files_view/data/action_creators","modules/clean/react/files_view/data/selectors","modules/clean/react/files_view/data/store","modules/clean/search/search_bar/data/action_creators","modules/clean/search/search_bar/data/selectors","modules/clean/viewer","modules/clean/web_timing_logger"],function(e,t,r,o,s,a,i,n,l,c,d,u,p,h,_,f,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),i=r.__importStar(i),n=r.__importStar(n),d=r.__importStar(d),u=r.__importStar(u),h=r.__importStar(h),_=r.__importStar(_),m=r.__importStar(m);var S=function(e){var t=n.context,r=n.sortedFilesWithFoldersSizesWithoutTeamFolders,o=n.sortedFilesWithFolderSizes,s=n.teamFolders,a=n.paginatedTotalNumFiles,i=n.loadingState,l=n.path,c=n.selection,d=n.selectedFiles,p=n.fileRename,h=n.shouldShowDeletedFiles,f=n.shouldShowPinnedTeamFolders,m=n.shouldShowSharedFolderInvites,S=n.newFolderCreationState,g=n.isTimelineVisible,E=n.sortOrder,F=n.urlPrefix,w=n.canDisplayFolderSizes,T=n.viewTypeColumns,y=n.isQueryingFolderSizes,v=n.user,b=n.viewer,R=n.browsePostTTIExperiments,A=n.mountPoints,C=n.isFileJumping,I=n.isSearchMode,P=_.searchSessionId,O=_.isSearchBarFocused;return{files:o(e),filesWithoutTeamFolders:r(e),teamFolders:s(e),paginatedTotalNumFiles:a(e),loadingState:i(e),path:l(e),fileRename:p(e),shouldShowDeletedFiles:h(e),shouldShowPinnedTeamFolders:f(e),shouldShowSharedFolderInvites:m(e),isTextSelectable:!!p(e),createNewFolderState:S(e),isTimelineVisible:g(e),currentSort:E(e),urlPrefix:F(e),canDisplayFolderSizes:w(e),viewTypeColumns:T(e),isQueryingFolderSizes:y(e),user:v(e),viewer:b(e),browsePostTTIExperiments:R(e),brsContext:t(e),brsSelection:c(e),brsSelectedFiles:d(e),mountPoints:A(e),isFileJumping:C(e),searchSessionId:P(e),isSearchBarFocused:O(e),isSearchMode:I(e),viewType:u.viewType(e)}},g={addFileJumpKeyCode:i.addFileJumpKeyCode,applyBoltUpdates:i.applyBoltUpdates,blurSearchBar:h.blurSearchBar,clearSearchBar:h.clearSearchBar,copyFilesToClipboard:i.copyFilesToClipboard,hideTimeline:i.hideTimeline,pasteFilesFromClipboard:i.pasteFilesFromClipboard,renameFile:i.renameFile,resetFileJumpFilter:i.resetFileJumpFilter,setAndStoreViewTypeColumns:i.setAndStoreViewTypeColumns,setBrowsePostTTIExperiments:i.setBrowsePostTTIExperiments,setBrowseScope:h.setBrowseScope,setCanDisplayFolderSizes:i.setCanDisplayFolderSizes,setFileCategories:h.setFileCategories,setFileRename:i.setFileRename,setIsSearchMode:i.setIsSearchMode,setSearchBarExperiments:h.setExperiments,setSearchQuery:h.setSearchQuery,setSelection:i.setSelection,setUrl:i.setUrl,showTimeline:i.showTimeline,setViewType:d.setViewType},E=s.connect(S,g)(a.BrowseController),F=(function(e){function t(t){var r=e.call(this,t)||this;m.log_js_modules_application_code_start(),p.getStoreForFilesView(),r.reduxStore=l.getStoreForBrowse(),c.getBrowseStore();var o=f.Viewer.get_viewer(),s=o.get_user_by_id(t["user-id"]);return r.reduxStore.dispatch(d.loadViewType()),r.reduxStore.dispatch(i.appInit({experiments:t["exp-browse-experiments"]||{},shouldShowDeletedFiles:!!t["should-show-deleted-files"],user:s,viewer:o})),r}return r.__extends(t,e),t.prototype.render=function(){return o.default.createElement(s.Provider,{store:this.reduxStore},o.default.createElement(E,r.__assign({},this.props)))},t})(o.default.PureComponent);t.BrowseApp=F}),define("modules/clean/react/browse/browse_prefetch_loader",["require","exports","tslib","modules/core/exception","modules/clean/react/files_view/types","modules/clean/react/browse/models","modules/clean/pagination_manager","modules/core/notify","modules/clean/web_timing_logger"],function(e,t,r,o,s,a,i,n,l){"use strict";function c(e){if(0===e.indexOf("err:")){var t=e.substr("err:".length);n.Notify.error(t)}}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),l=r.__importStar(l);var d=(function(){function e(e,t,r,n){var d=e.user,u=e.path,p=e.fqPathsToSelect,h=t.onPrefetchComplete,_=t.onPrefetchError,f=t.onLoadComplete,m=t.onPostTTIPrefetchComplete,S=t.onPostTTIPrefetchError,g=r.onInitializeEverything,E=r.onLoad,F=r.onAddFilesAndSetLoadingState;void 0===n&&(n=window);var w=this;this.isPrefetching=function(){return!!w.browsePreloadHandler&&!!w.firstPagePreloadHandler},this.handlePrefetch=function(){o.assert(w.isPrefetching(),"trying to handle prefetching and think we aren't prefetching at the same time.  something is wrong"),w.browsePreloadHandler(w.handlePrefetchDataSuccess,w.onPrefetchError),l.waitForTTI().then(function(){w.postTTIPreloadHandler(w.handlePostTTIDataSuccess,w.onPostTTIPrefetchError)})},this.handlePostTTIDataSuccess=function(e){var t=void 0;try{t=JSON.parse(e)}catch(e){return void w.onPostTTIPrefetchError(e)}if(!t)return void w.onPostTTIPrefetchError();w.onPostTTIPrefetchComplete(t)},this.handlePrefetchDataSuccess=function(e){var t=w.extractAjaxInitData(e);if(!t)return void w.onPrefetchError();var r,o,i=[],n=0,l=s.LoadingState.LOADING_FIRST_PAGE,c=w.firstPagePreloadHandler.getDataIfAvailable();if(c){if(!c.payload||c.error)return void w.onPrefetchError();var d=w.extractAjaxFileInfo(c.payload);if(!d)return void w.onPrefetchError();r=d.file_info,o=d.first_page,o?(i=[],n=o.total_num_items,l=s.LoadingState.LOADING_REMAINING_PAGES):r&&(i=r,n=i.length,l=s.LoadingState.LOADED)}var u=a.BrowseContext.fromServerObject(t);w.onInitializeEverything({path:w.path,files:i,paginatedTotalNumFiles:n,context:u,mountPoints:t.ns_id_to_mount_point,fqPathsToSelect:w.fqPathsToSelect,loadingState:l,teamFolders:t.team_folders_js_info}),r||o?(o?w.initializePaginationManager(o):w.onLoadComplete(),w.onPrefetchComplete(t)):w.firstPagePreloadHandler(function(e){w.handleFirstPagePrefetchDataSuccess(e,t,u)},w.onPrefetchError)},this.handleFirstPagePrefetchDataSuccess=function(e,t,r){var o=w.extractAjaxFileInfo(e);if(!o)return void w.onPrefetchError();o.paginated?w.initializePaginationManager(o.first_page):(w.onLoad({path:w.path,files:o.file_info,paginatedTotalNumFiles:o.file_info.length,context:r}),w.onLoadComplete()),w.onPrefetchComplete(t)},this.extractAjaxInitData=function(e){var t=void 0;try{t=JSON.parse(e)}catch(t){c(e)}return t},this.extractAjaxFileInfo=function(e){var t=void 0;try{t=JSON.parse(e)}catch(t){c(e)}return t},this.initializePaginationManager=function(e){var t=e.total_num_items,r=i.PaginationManager.create({firstPage:e,keyName:"sjid",ajaxURL:"/browse_get_next",userID:w.user.id,newDataAvailableCallback:function(e,r){var o=e.areAllItemsReady(),a=o?s.LoadingState.LOADED:s.LoadingState.LOADING_REMAINING_PAGES;w.onAddFilesAndSetLoadingState({path:w.path,files:r,paginatedTotalNumFiles:t,loadingState:a}),o&&(e.stopAutoFetching(),w.onLoadComplete())}});l.waitForTTI().then(function(){return r.startAutoFetching()})},this.user=d,this.path=u,this.fqPathsToSelect=p,this.onPrefetchComplete=h,this.onPrefetchError=_,this.onLoadComplete=f,this.onPostTTIPrefetchComplete=m,this.onPostTTIPrefetchError=S,this.onInitializeEverything=g,this.onLoad=E,this.onAddFilesAndSetLoadingState=F,this.browsePreloadHandler=n.__REGISTER_BROWSE_PRELOAD_HANDLER,this.firstPagePreloadHandler=n.__REGISTER_BROWSE_FIRST_PAGE_PRELOAD_HANDLER,this.postTTIPreloadHandler=n.__REGISTER_BROWSE_POST_TTI_PRELOAD_HANDLER}return e})();t.BrowsePrefetchLoader=d}),define("modules/clean/react/browse/browse_view",["require","exports","tslib","external/immutable","react","modules/clean/browse_uri_interface","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/browse/action_logger","modules/clean/react/browse/constants","modules/clean/react/browse/logger_util","modules/clean/react/browse/models","modules/clean/react/browse/sidebar","modules/clean/react/browse/title","modules/clean/react/browse/web_team_sharing_experiment","modules/clean/react/file_uploader/file_uploader","modules/clean/react/files_view/constants","modules/clean/react/files_view/controller","modules/clean/react/files_view/types","modules/clean/react/maestro/layout","modules/clean/react/search_success_banner/constants","modules/clean/react/search_success_banner/search_success_banner","modules/clean/react/search_success_banner/util","modules/clean/search/search_bar/experiments","modules/clean/search/search_bar/log_helper","modules/clean/search/search_results/controller","modules/clean/search/search_results/log_helper","modules/clean/sharing/access_level","modules/clean/user_education/user_education_client","modules/clean/web_timing_logger","modules/core/browser","modules/clean/react/async/loadable","modules/clean/web_user_action_events"],function(e,t,r,o,s,a,i,n,l,c,d,u,p,h,_,f,m,S,g,E,F,w,T,y,v,b,R,A,C,I,P,O,N){"use strict";var D=this;Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importDefault(s),i=r.__importStar(i),l=r.__importStar(l),d=r.__importStar(d),P=r.__importStar(P);var L=[A.NameSpaceAccess.ACCESS_NO_ACCESS,A.NameSpaceAccess.ACCESS_READER,A.NameSpaceAccess.ACCESS_READER_NO_COMMENT],x=(function(t){function A(a){var h=t.call(this,a)||this;return h.onSearchBarAbandonedEvent=function(e){var t=e.detail.searchBarState;h.setState({searchBarAbandoned:t.abandoned})},h.handleGetOverflowMenuActions=function(e,t,r){var s=h.handleGetFileActionsForSetOfFiles(o.Set([e]),t,r,!1),a=new Array;return s.forEach(function(e){"function"!=typeof e&&a.push(e)}),[a]},h.handleGetFileActionsForSetOfFiles=function(t,r,o,s,a){if(h.props.arePostTTIModulesLoaded){var i=h.props,n=i.context,l=i.user,c=i.actionHandlers,d=i.isSearchMode,u=i.isOverFreeQuota,p=i.isQueryingFolderSizes,_=i.browsePostTTIExperiments,f=i.viewType,m=e("modules/clean/react/browse/file_actions"),S=_.expShowAddToShowcase,g=_.expShowAddFolderToShowcase,E=_.expBrowseMoveSuggestions,F=_.expEsignatureEnabled,w=_.expHasCreatedShowcase,T=_.expHasShowcaseFreemium,y=_.expNewBrowseMoveDialog,v=_.expShowShowcaseInterstitial,b=_.expFolderCalcSize,R="ON"===E,A="CTX"===b,C=h.state.fileIdToActionCategories;return m.getActionsForFileCollection({files:t,context:n,user:l,viewType:f,fileIdToActionCategories:C,canDisplayFolderSizes:r,actionHandlers:c,skipSharing:!1,isSearchMode:d,isOverFreeQuota:u,isQueryingFolderSizes:p,canShowUJPopup:s,showAddToShowcase:!!S,showAddFolderToShowcase:!!g,hasCreatedShowcase:!!w,hasShowcaseFreemium:!!T,isSidebar:a,showShowcaseInterstitialExp:!!v,responsive:o,showNewMoveDialog:!!y,showFolderSuggestion:R,showPrepareForSignature:!!F,showFolderCalcSize:A})}return[]},h.handleLocationLinkClick=function(e,t){if(!t){var r=i.parent_dir(e.fq_path);h.props.onNavigateToPath(r)}},h.handleOpenPaper=function(e){var t=h.props,r=t.user,o=t.isSearchMode,s=t.viewType;o&&R.recordSearchResultsAction({result:e,user:r,action_type:N.WebUserActionLogEvent.PAPER_OPEN,view_type:s}),P.redirect(e.url)},h.handleUploadButtonClick=function(e){f.FileUploaderController.setPath(h.props.path),f.FileUploaderController.handleUploadButtonClick(e)},h.handleShowFileUploader=function(){f.FileUploaderController.setPath(h.props.path),f.FileUploaderController.showModal()},h.handleSelectionChange=function(e){var t=h.props.getFileByFullPath(e.selected.first());if(t){var r=t.ns_id,o=t.sjid,s=t.file_id,a=t.fq_path,n=t.bytes,c=t.ext,d=t.request_id;l.logSelectRow({uid:h.props.user.id,entity_type:t.is_dir?"folder":"file",view_type:h.props.viewType,file_nsid:r,file_sjid:o,file_id:s,file_name:i.filename(t.fq_path),file_path:a,file_size:n,file_extension:c,request_id:d})}h.props.onSelectionChange({selection:e})},h.handleFileListSortChange=function(e,t){l.logSortRecords({uid:h.props.user.id,sort_by:e,sort_direction:t,view_type:h.props.viewType}),h.props.onSortFiles({sortField:e,sortDirection:t})},h.handleStarClick=function(e,t){var r=t?N.WebUserActionLogEvent.STAR:N.WebUserActionLogEvent.REMOVE_STAR,o=h.props,s=o.user,a=o.isSearchMode,i=o.viewType,n=o.selectedFiles,c=d.countFilesAndFolders(n),u=c.num_files_selected,p=c.num_folders_selected;a&&R.recordSearchResultsAction({result:e,user:s,action_type:r,view_type:i}),l.logBrowseAction(s.id,"BROWSE",r,u,p,i,e)},h.handleSearchFromSearchBar=function(e){var t=e.query,r=e.searchPath,o=e.qargs;t?h.props.onSearch(t,r,!0,o):h.props.onSetUrl({path:r})},h.handleSearchResultOpen=function(e){e instanceof u.File?(v.logDropdownSearchAction({result:e,user:h.props.user,action_type:e.is_dir?N.WebUserActionLogEvent.FOLDER_OPEN:N.WebUserActionLogEvent.FILE_VIEW,viewport:"dropdown-view"}),h.props.onSearchBarResultOpen(e)):(e instanceof u.Paper||e instanceof u.PaperFolder)&&(v.logDropdownSearchAction({result:e,user:h.props.user,action_type:N.WebUserActionLogEvent.PAPER_OPEN,viewport:"dropdown-view"}),P.open_tab(e.url))},h.handleResultObjectPathClick=function(e){v.logDropdownSearchAction({result:e,user:h.props.user,action_type:N.WebUserActionLogEvent.CLICK_PATH_LINK,viewport:"dropdown-view"}),h.props.onSearchBarPathClicked(e)},h.setFilesViewControllerRef=function(e){h.filesViewControllerRef=e},h.handleSearchFromSearchResults=function(e,t,r){h.props.onSearch(e,t,!1,r)},h.handleFocusSearchBar=function(){return document.getElementsByClassName("search-bar__text-input")[0].focus()},h.renderSharedWithController=function(t){var r=h.props,o=r.context,a=r.arePostTTIModulesLoaded,i=r.user;if(!a)return null;if(t.type===n.FileTypes.TEAM_SHARED_FOLDER&&("archived"===t.team_folder_status||"archive_in_progress"===t.team_folder_status))return null;var l=h.props.selectedFiles,c=!!l.size,d=e("modules/clean/react/browse/shared_with").SharedWithController;return s.default.createElement("div",{className:"brws-vertically-center brws-shared-with-wrapper"},s.default.createElement(d,{file:t,browseContext:o,inSelectMode:c,user:i}))},h.renderAppContent=function(e){return h.props.isSearchMode?h.renderSearchResults(e):h.renderFilesViewController(e)},h.getPageHeaderHeight=function(e){return e.isMatchedLarge||e.isMatchedMedium?c.DEFAULT_PAGE_HEADER_HEIGHT:c.COMPACT_PAGE_HEADER_HEIGHT},h.renderSidebar=function(e){var t=h.props,o=t.fileCategories,a=t.isNautilusEnabled,i=t.isPaperEnabled;return s.default.createElement(p.BrowseSidebar,r.__assign({},h.props,{onSearch:h.handleSearchFromSearchResults,onUploadButtonClick:h.handleUploadButtonClick,onGetFileActionsForFiles:h.handleGetFileActionsForSetOfFiles,responsive:e,fileCategories:o,isNautilusEnabled:a,isPaperEnabled:i}))},h.hideTimeline=function(){h.props.onHideTimeline()},h.state={searchBarProps:h.getCurrentSearchBarProps(h.props),fileIdToActionCategories:{},searchBarAbandoned:!1},window.addEventListener(F.SEARCH_BAR_ABANDONED_EVENT,h.onSearchBarAbandonedEvent),h}return r.__extends(A,t),A.prototype.componentWillReceiveProps=function(e){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(t){switch(t.label){case 0:return e.isSearchMode===this.props.isSearchMode&&e.path===this.props.path||this.setState({searchBarProps:this.getCurrentSearchBarProps(e)}),this.props.files===e.files?[3,2]:[4,this.getAppActions(e.files,e.path)];case 1:t.sent(),t.label=2;case 2:return[2]}})})},A.prototype.componentDidMount=function(){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(t){switch(t.label){case 0:return[4,I.waitForTTI()];case 1:return t.sent(),this.defineFileUploader(),this.maybeOpenUploaderOnMount(),new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.maybeShowSubgrowthProOQRecurringModal("wb_oq_ups_recur_fb")}),C.UEClient.sendEvent("BrowseView","componentDidMount",this.props.context.toJSON()),[4,this.getAppActions(this.props.files,this.props.path)];case 2:return t.sent(),[2]}})})},A.prototype.componentDidUpdate=function(){this.props.loadingState===g.LoadingState.LOADED&&C.UEClient.sendEvent("BrowseView","componentDidUpdate",this.props.context.toJSON())},A.prototype.componentWillUnmount=function(){window.removeEventListener(F.SEARCH_BAR_ABANDONED_EVENT,this.onSearchBarAbandonedEvent)},A.prototype.maybeOpenUploaderOnMount=function(){this.props.shouldOpenUploadModal&&this.handleShowFileUploader()},A.prototype.getCurrentDropTargetHighlightMode=function(){var e=this.props,t=e.selectedFiles,r=e.context;return r.isInsideSharedFolder&&L.includes(r.currentSharedFolderPermissionRole)?g.DropTargetHighlightMode.NONE:this.props.isDraggingInternalFiles?t.some(function(e){return e.isDeleted||e.type===n.FileTypes.TEAM_SHARED_FOLDER})?g.DropTargetHighlightMode.NONE:t.some(function(e){return e.type===n.FileTypes.SHARED_FOLDER})?r.currentNSAllowsNesting?g.DropTargetHighlightMode.NONSELECTED_FOLDERS:g.DropTargetHighlightMode.NONSELECTED_NONSHARED_FOLDERS:g.DropTargetHighlightMode.NONSELECTED_FOLDERS:this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen?g.DropTargetHighlightMode.ALL_FOLDERS:g.DropTargetHighlightMode.NONE},A.prototype.getCurrentSearchBarProps=function(e){return{showSearchBar:!0,currentPath:e.path,onSearch:this.handleSearchFromSearchBar,onSearchResultOpen:this.handleSearchResultOpen,onResultObjectPathClick:this.handleResultObjectPathClick,isSearchBarExpanded:e.isSearchMode,searchBarExperiments:e.searchBarExperiments,onSearchFiltersChanged:e.onSearchFiltersChanged,searchFrom:e.searchFrom}},A.prototype.getFilesViewControllerRef=function(){return this.filesViewControllerRef},A.prototype.renderSearchSuccessBanner=function(){var e=this.props.searchBarExperiments,t=e.expSearchSuccessBanner,r=this.state.searchBarAbandoned||T.shouldShowSearchSuccessBanner();return t&&!T.isFilePreview()&&!T.userIsOptedOutOfSearchSuccessBanner()&&r?s.default.createElement(w.SearchSuccessBanner,{user:this.props.user,displayContext:F.SearchSuccessDisplayContext.IN_EMBEDDED_APP}):null},A.prototype.getAppActions=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var o,s,a=this;return r.__generator(this,function(i){switch(i.label){case 0:return[4,I.waitForTTI()];case 1:return i.sent(),o=[],e.toArray().forEach(function(e){e&&e instanceof u.File&&!e.isDeleted&&o.push(e)}),[4,this.props.appActionsStore.getActionsForFileBatch(o,this.props.user.id)];case 2:return s=i.sent(),this.setState(function(e){return a.props.path===t?{fileIdToActionCategories:r.__assign({},e.fileIdToActionCategories,s)}:e}),[2]}})})},A.prototype.renderSearchResults=function(e){var t=this.props,r=t.actionHandlers,o=t.filesViewActionHandlers,i=t.fileRename,n=t.path,l=t.user,c=t.handleComponentTTI,d=t.isFileViewerShown,u=t.arePostTTIModulesLoaded,p=t.getIsFileJumping,h=t.ensureFileViewerClosedIfNotPreviewing,_=t.browseExperiments,m=t.searchResultsExperiments,S=t.searchBarExperiments,g=t.onNavigateToParentFolder,E=t.onNavigateToPath,F=t.shouldShowDeletedFiles,w=t.onNavigateToFileOrFolder,T=t.onSearchFiltersChanged,v=t.starredState,R=t.fileCategories,A=t.isPaperEnabled,C=t.viewType;return s.default.createElement("div",null,this.renderSearchSuccessBanner(),s.default.createElement(b.SearchResultsController,{actionHandlers:r,filesViewActionHandlers:o,path:n,user:l,searchResultsExperiments:m,searchBarExperiments:S,browseExperiments:_,onSearch:this.handleSearchFromSearchResults,setFileUploaderPath:f.FileUploaderController.setPathAndPermissions,maestroSearchBarProps:this.state.searchBarProps,handleComponentTTI:c,ensureFileViewerClosedIfNotPreviewing:h,getIsFileJumping:p,renderSharedWithController:this.renderSharedWithController,hrefForFile:a.href_for_file,isFileViewerShown:d,fileRename:i,arePostTTIModulesLoaded:u,getOverflowMenuActions:this.handleGetOverflowMenuActions,onFocusSearchBar:this.handleFocusSearchBar,onNavigateToFileOrFolder:w,onNavigateToParentFolder:g,onNavigateToPath:E,onOpenPaper:this.handleOpenPaper,shouldShowDeletedFiles:y.isInDeletedFilterRightRailExperiment(S)?F:void 0,responsive:e,onSearchFiltersChanged:T,starredState:v,viewType:C,fileCategories:R,isPaperEnabled:A,pageHeaderHeight:this.getPageHeaderHeight(e)}))},A.prototype.renderFilesViewController=function(e){var t=this.props.shouldShowPinnedTeamFolders,o=t?this.props.filesWithoutTeamFolders:this.props.files;return s.default.createElement("div",{className:"maestro-browse-app-content"},this.renderSearchSuccessBanner(),s.default.createElement(_.WebTeamSharingModalExperiment,{context:this.props.context,user:this.props.user,path:this.props.path,selectedFiles:this.props.selectedFiles,browsePostTTIExperiments:this.props.browsePostTTIExperiments}),s.default.createElement(S.FilesViewController,r.__assign({},this.props.filesViewActionHandlers,{disabledMultiselect:this.props.isTimelineVisible,getOverflowMenuActions:this.handleGetOverflowMenuActions,renderSharedWithController:this.renderSharedWithController,hrefForFile:a.href_for_file,onLocationLinkClick:this.handleLocationLinkClick,onNavigateToFileOrFolder:this.props.onNavigateToFileOrFolder,onNavigateToParentFolder:this.props.onNavigateToParentFolder,onOpenPaper:this.handleOpenPaper,onFocusSearchBar:this.handleFocusSearchBar,context:this.props.context,createNewFolderState:this.props.createNewFolderState,currentSort:this.props.currentSort,dropTargetHighlightMode:this.getCurrentDropTargetHighlightMode(),fileRename:this.props.fileRename,items:o,responsive:e,getIsFileJumping:this.props.getIsFileJumping,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isFileViewerShown:this.props.isFileViewerShown,isOverFreeQuota:this.props.isOverFreeQuota,shouldShowPinnedTeamFolders:t,arePostTTIModulesLoaded:this.props.arePostTTIModulesLoaded,fileIdToActionCategories:this.state.fileIdToActionCategories,isTextSelectable:this.props.isTextSelectable,loadingState:this.props.loadingState,onComponentTTI:this.props.handleComponentTTI,onSelectionChange:this.handleSelectionChange,onSortChange:this.handleFileListSortChange,onStarClick:this.handleStarClick,path:this.props.path,ref:this.setFilesViewControllerRef,selectedFiles:this.props.selectedFiles,selection:this.props.selection,setFileUploaderPath:f.FileUploaderController.setPathAndPermissions,showFileUploaderModal:this.handleShowFileUploader,teamFolders:this.props.teamFolders,totalNumFiles:this.props.totalNumItems,user:this.props.user,viewType:this.props.viewType,isQueryingFolderSizes:this.props.isQueryingFolderSizes,columns:this.props.columns,viewTypeColumns:this.props.viewTypeColumns,viewTypes:m.AllViewTypes,viewTypeLabels:m.ViewTypeLabels,starredState:this.props.starredState,pageHeaderHeight:this.getPageHeaderHeight(e),shouldShowSharedFolderInvites:this.props.shouldShowSharedFolderInvites})))},A.prototype.defineFileUploader=function(){f.FileUploaderController.loadCoreComponent()},A.prototype.render=function(){
var e=this.props,t=e.user,r=e.path,o=e.isDraggingExternalFiles,a=e.isDraggingInternalFiles,i=e.isUploadModalOpen,n=e.isSearchMode,l=e.context,c=e.isTimelineVisible,d=e.onSetUrl,u=e.browsePostTTIExperiments.expFolderHistoryRollbacks;return s.default.createElement("div",null,s.default.createElement(M,{user:t,browseContext:l,hideTimeline:this.hideTimeline,isTimelineVisible:c,expFolderHistoryRollbacks:u||!1}),s.default.createElement(E.MaestroChrome,{user:t,titleRegion:s.default.createElement(h.BrowseTitle,{path:r,user:t,isDraggingExternalFiles:o,isDraggingInternalFiles:a,isUploadModalOpen:i,isSearchMode:n,onSetUrl:d}),titleClass:"page-header__title-overflow",embeddedAppRegion:this.renderAppContent,actionSidebarRegion:this.renderSidebar,searchBarProps:this.state.searchBarProps}))},A.defaultProps={selectedFiles:o.OrderedMap(),viewType:g.ViewType.List},A})(s.default.PureComponent);t.BrowseView=x;var M=O.Loadable({loader:function(){return r.__awaiter(D,void 0,void 0,function(){var t;return r.__generator(this,function(o){switch(o.label){case 0:return[4,I.waitForTTI()];case 1:return o.sent(),[4,new Promise(function(t,r){e(["modules/clean/react/timeline/timeline"],t,r)}).then(r.__importStar)];case 2:return t=o.sent().Timeline,[2,t]}})})}})}),define("modules/clean/react/browse/controller",["require","exports","tslib","external/lodash","react","external/react-dom","modules/clean/analytics","modules/clean/browse/browse_bolt_client","modules/clean/em_string","modules/clean/filepath","modules/clean/filepath","modules/clean/filetypes","modules/clean/history","modules/clean/pagelet_logger","modules/clean/react/app_actions/app_actions_store","modules/clean/react/app_actions/education/async_extensions_edu_modal","modules/clean/react/async_overquota_modal_controller","modules/clean/react/browse/action_logger","modules/clean/react/browse/actions","modules/clean/react/browse/api","modules/clean/react/browse/browse_prefetch_loader","modules/clean/react/browse/browse_view","modules/clean/react/browse/constants","modules/clean/react/browse/dispatcher","modules/clean/react/browse/models","modules/clean/react/browse/nav_actions","modules/clean/react/browse/professional_collection_actions","modules/clean/react/browse/store","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/file_uploader","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/utils","modules/clean/react/file_viewer/async_controller","modules/clean/react/fileops_actions","modules/clean/react/files_view/types","modules/clean/react/search_success_banner/util","modules/clean/react/snackbar","modules/clean/search/logger","modules/clean/search/search_bar/chips","modules/clean/search/search_bar/experiments","modules/clean/search/search_helpers","modules/clean/search/search_results/actions","modules/clean/search/search_results/log_helper","modules/clean/search/search_results/store","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/sharing/ui_notifications_util","modules/clean/storage","modules/clean/upsell/prompt_event_emitter","modules/clean/user_education/user_education_client","modules/clean/web_timing_logger","modules/clean/web_user_action_events","modules/constants/python","modules/core/browser","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/react/browse/uri_helper"],function(e,t,r,o,s,a,i,n,l,c,d,u,p,h,_,f,m,S,g,E,F,w,T,y,v,b,R,A,C,I,P,O,N,D,L,x,M,U,B,q,k,V,W,H,G,z,j,Q,K,J,Y,X,Z,$,ee,te,re,oe,se,ae){"use strict";function ie(e){oe.Notify.success(re._("%(file_name)s added to your Dropbox.").format({file_name:d.filename(e)}))}function ne(e){var t=re._('Added “%(folder_name)s” <a href="%(href)s">Learn More</a>').format({folder_name:l.Emstring.em_snippet(d.filename(e),z.SNIPPET_SIZES.FILENAME),href:"/help/business/team-space-overview#acceptfolder"});oe.Notify.success(new te.HTML(t))}function le(e){var t=d.parent_dir(e);"/"!==t&&oe.Notify.success(re._("Folder is in %(path)s").format({path:l.Emstring.em_snippet(t,22)}))}function ce(e){var t=ae.getQueryArgs();p.default.replace_state(e,o.pick.apply(o,[t,T.BrowseQueryArg.d,T.BrowseQueryArg.select,T.BrowseQueryArg.preview,T.BrowseQueryArg.activity,T.BrowseQueryArg.preselected_for_showcase].concat(T.FRAMEWORK_ARGS)))}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importDefault(s),a=r.__importStar(a),c=r.__importStar(c),p=r.__importDefault(p),m=r.__importStar(m),S=r.__importStar(S),E=r.__importStar(E),O=r.__importStar(O),D=r.__importStar(D),U=r.__importStar(U),k=r.__importStar(k),Y=r.__importStar(Y),$=r.__importStar($);var de;(function(e){e[e.BROWSE=0]="BROWSE",e[e.SEARCH=1]="SEARCH"})(de||(de={}));var ue=(function(t){function l(s){var n=t.call(this,s)||this;n.logOnceFetchedDataRequiredForTTI=o.once(function(){return Y.log_js_modules_fetched_data_required_for_tti()}),n.previousHistoryCallbackMode=de.BROWSE,n.handlePreviewAndShareModalsOnLoad=function(t){var o=n.getPathFromProps(),s=n.props.user,a=!!n.props["open-preview"],i=!!n.props["show-share-modal"],l=n.props["share-prefill-email"];if(a&&!t){oe.Notify.error(re._("The file doesn’t exist"));var c=n.props.urlPrefix,d=n.getUrlForFQPath(c,o),u=ae.getQueryArgs();delete u.preview,p.default.replace_state(d,u)}if(t){var h=v.File.fromServerObject(t);N.asyncOpenPreview({containerId:T.BROWSE_FILE_VIEWER_ELEMENT_ID,files:[h],fileViewAction:Z.FileViewActionType.CLICK,fileViewOrigin:Z.FileViewOriginType.BROWSE,fileViewTarget:Z.FileViewTargetType.PRIVATE,indexOfPreviewFile:0,user:s,updateBrowserLocation:!1,onFileViewerDidMount:N.hideElementsBehindFileViewer,filePreviewDataFetcher:function(e){return E.fetchPreviewData(e,s)},onFileViewerUnmount:function(){N.showElementsBehindFileViewer();var e=n.browseViewRef;(e=e.getFilesViewControllerRef())&&(e=e.getFilesViewTileGridRef())&&(e=e.getTileGridRef())&&e.getAndUpdateTileLayout(),n.restoreUrlAfterFileViewClose()}}),i&&Y.waitForTTI().then(function(){n.mounted&&G.asyncShowPrefilledShareModal({user:s,sharePrefillEmail:l,content:h,setPath:b.browseNavActions.setPath,setUrl:n.props.setUrl})})}else i&&n.showShareModalForCurrentPath(l);i||n.props["showing-mobile-billing-modal"]||n.props["showing-client-modal"]||Y.waitForTTI().then(function(){K.promptBufferedEventEmitter.on(K.Events.ON_PROMPT_INITIALIZED,function(t){return r.__awaiter(n,void 0,void 0,function(){var o,s,a,i,n,l;return r.__generator(this,function(c){switch(c.label){case 0:return t&&(t.didMainCampaignLoad()||t.didCampaignForUserEducationLoad())?[2]:[4,new Promise(function(t,r){e(["modules/clean/react/ncct/post_tti_ncct_modal"],t,r)}).then(r.__importStar)];case 1:return o=c.sent().postTTINCCTReminderModal,[4,o()];case 2:return(s=c.sent())?[2]:(a="V2"===this.props.browsePostTTIExperiments.expSubgrowthBizTeamsTriggersClientLinkWork,i="V1"===this.props.browsePostTTIExperiments.expEngageDesktopWebOnly,a&&this.props.user.is_team?[4,new Promise(function(t,r){e(["modules/clean/growth/experiments/open_in_desktop_modal"],t,r)}).then(r.__importStar)]:[3,4]);case 3:return n=c.sent().openInDesktopModalExperiment,n(this.props.user,this.browseContext),[3,6];case 4:return i&&this.props.user.is_team?[4,new Promise(function(t,r){e(["modules/clean/growth/experiments/install_client_modal"],t,r)}).then(r.__importStar)]:[3,6];case 5:l=c.sent().installClientModalExperiment,l(),c.label=6;case 6:return[2]}})})})})},n.receiveStateFromStores=function(){n.setState(n.getStateFromStores())},n.handleComponentTTI=function(e){n.browseLogger&&(n.browseLogger.componentReady(e),n.browseLogger.ttiLogged&&n.ajaxRequestWebTimer&&(n.ajaxRequestWebTimer.markTimeToInteractive(),delete n.ajaxRequestWebTimer))},n.onAllUploadsComplete=function(e){var t=e.detail.files,r=t.map(function(e){return c.normalize(e.path)+c.normalize(e.name)});g.browseActions.selectFilesAfterUpload({fqPathsToSelect:r})},n.getIsFileJumping=function(){return n.props.isFileJumping},n.getFileByFullPath=function(e){return n.props.files.find(function(t){return t.fq_path===e})||null},n.getFileByFilename=function(e){return n.props.files.find(function(t){return c.filename(t.fq_path)===e})||null},n.setBrowseViewRef=function(e){n.browseViewRef=e},n.startBoltLiveUpdate=function(){n.browseBoltClient.startLiveUpdate(function(){n.getChangesRequest&&n.getChangesRequest.abort();var e=n.props,t=e.user,r=e.path,o=e.shouldShowDeletedFiles;n.getChangesRequest=E.getChangesForDirectory({path:r,userId:t.id,namespaceToJournalIdMap:n.browseBoltClient.getNsMap(),includeDeletedFiles:o,onSuccess:function(e){delete n.getChangesRequest,r===n.props.path&&(n.props.applyBoltUpdates({updates:e,setPath:g.browseActions.setPath,fluxStore:A.getBrowseStore(),fluxDispatch:y.BrowseDispatcher.dispatch}),n.browseBoltClient.handleUpdateBoltClient(e.bolt_data))}})})},n.toggleTimelineIfNecessary=function(){var e=ae.getQueryArgs().activity;e&&!n.props.isTimelineVisible&&n.props.showTimeline(),!e&&n.props.isTimelineVisible&&n.props.hideTimeline()},n.showShareModalForCurrentPath=function(e){var t=n.props.user,r=n.getPathFromProps();Y.waitForTTI().then(function(){if(n.mounted){var o=n.props["ns-id"],s=n.props["ns-path"];G.asyncShowPrefilledShareModal({user:t,sharePrefillEmail:e,content:{fqPath:r,isFolder:!0,nsId:o&&s?o:null,targetNsId:o&&!s?o:null},setPath:b.browseNavActions.setPath,setUrl:n.props.setUrl})}})},n.handleFileLocationChange=function(e,t){e="/"+se.URI.decode(e),n.ensureFileViewerIsOpenedOrClosedIfNeeded(t),n.toggleTimelineIfNecessary(),t.share&&!n.props["show-share-modal"]&&n.showShareModalForCurrentPath(),n.previousHistoryCallbackMode===de.BROWSE&&c.paths_are_equal(n.props.path,e)||(n.previousHistoryCallbackMode=de.BROWSE,n.navigateToPath({path:e}))},n.getPathFromProps=function(){return n.props["init-fq-path"]||"/"},n._handleSearchLocationChange=function(e,t){if(t){n.props.isSearchMode||n.props.setIsSearchMode({isSearchMode:!0});var r=n.searchBarExperiments,o=t.query||t.query_unnormalized||"";e=t.path||t.last_fq_path||"/";var s=t.search_session_id||"",a=t.file_categories||"",i=void 0,l=void 0;if(q.isInDeletedFilterRightRailExperiment(r)&&(i="1"===t.d,setTimeout(function(){g.browseActions.setShouldShowDeletedFiles({shouldShowDeletedFiles:i,shouldUpdateUrl:!1,shouldReloadFolder:!1}),i&&(S.logSwitchViewType({uid:n.props.user.id,isSearchMode:!1,viewType:L.ViewType.List}),n.props.setViewType({viewType:L.ViewType.List}))},0)),o&&(!c.paths_are_equal(e,n.props.path)||o!==n.state.latestQuery||q.isInDeletedFilterRightRailExperiment(r)&&i!==n.props.shouldShowDeletedFiles||k.isInFileTypeFilterExperiment(r)&&a!==k.fileCategoriesToString(n.state.latestFileCategories))){var d=n.props.user;setTimeout(function(){b.browseNavActions.clear({path:e,context:n.props.brsContext})}),n.previousHistoryCallbackMode=de.SEARCH,c.paths_are_equal(n.props.path,e)||g.browseActions.setPath({path:e}),k.isInFileTypeFilterExperiment(r)&&(l=k.fileCategoriesFromString(a),a!==k.fileCategoriesToString(n.state.latestFileCategories)&&n.props.setFileCategories({fileCategories:l})),n.props.setSearchQuery({query:o,searchSessionId:s,searchPath:e});var u=n.searchResultsExperiments,p=u.expShowSymlinkIcon,h=u.expDeletedFileInCerebro;V.searchResultsActions.runSearch({user:d,path:e,query:o,searchSessionId:s,showSymlinkIcon:!!p,webTimer:n.ajaxRequestWebTimer,logOnceFetchedDataRequiredForTTI:n.logOnceFetchedDataRequiredForTTI,deletedFiles:i,expSinglePageSearch:n.isInSinglePageSearchExperiment,fileCategories:l,deletedFileInCerebro:!!h,isPaperEnabled:!!n.props["paper-enabled-for-user"]})}}},n.handleSearchExit=function(){n.props.setIsSearchMode({isSearchMode:!1}),V.searchResultsActions.clearSearch(),!n.searchBarExperiments.expSearchSuccessBanner||x.getClickedOnSearchResultsPageItem()||q.isInSinglePageSearchExperiment(n.searchBarExperiments)||x.setSearchSuccessBannerVisible(),n.isInSinglePageSearchExperiment&&!n.props.isSearchBarFocused&&n.props.blurSearchBar()},n.markTTVIfNeeded=function(){if(!n.hasTTVBeenLogged&&n.mounted&&(n.prefetchComplete||n.props["search-query"])){var e=window.ensemble;e&&e.markPageletRenderedByDOMNode(a.findDOMNode(n)),Y.mark_time_to_view(),n.hasTTVBeenLogged=!0}},n.handleFileListUpdated=function(){n.fileViewerIsShown()?n.props.files.isEmpty()?g.browseActions.closeFileViewer():g.browseActions.updatePreview({files:n.props.files.toJS()}):n.ensureFileViewerIsOpenedOrClosedIfNeeded(ae.getQueryArgs()),n.prefetchPreviewData(n.props.files.toArray(),n.props.user)},n.handleOnNavigateToPath=function(e){n.blurSearchBarIfInSinglePageSearch(),g.browseActions.setUrl({path:e})},n.handleOnNavigateToParentFolder=function(){n.blurSearchBarIfInSinglePageSearch(),g.browseActions.navigateToParentFolder()},n.handleDelete=function(e){var t=e.some(v.File.isTeamSharedFolder),r=e.some(function(e){return e.read_only}),o=e.every(function(e){return e.isDeleted});!n.browseContext.isCurrentPathWriteable()||t||r?t?oe.Notify.error(re._("Team folders can’t be deleted.")):oe.Notify.warning(re._("You don’t have permission to delete files in this folder.")):o?g.browseActions.doPermanentDeleteWithModal({files:e}):g.browseActions.doDeleteFilesWithModal({files:e})},n.handleSearchBarResultOpen=function(e){g.browseActions.navigateToFileOrFolder({file:e,fileViewAction:Z.FileViewActionType.SEARCH})},n.handleSearchBarPathClicked=function(e){g.browseActions.navigateToResultObjectParentFolder({file:e,fileViewAction:Z.FileViewActionType.SEARCH})},n.handleOnNavigateToFileOrFolder=function(e,t){if(n.blurSearchBarIfInSinglePageSearch(),n.searchBarExperiments.expSearchSuccessBanner&&!x.userIsOptedOutOfSearchSuccessBanner()){x.resetSearchResultClickKey();var r=e.is_dir;if(n.props.isSearchMode)x.setClickedOnSearchResultsPageItem(),x.setSearchSuccessBannerVisible(),r&&x.setFolderSearchResultData(e.fq_path);else{x.doSearchBarInteractionBroadcast(!1);var o=e.fq_path,s=x.getSearchResultPath(),a=x.getSearchResultClickTimestamp();Date.now()-a<=3e4&&x.parentPathOfFileEqualsSearchResultPath(o,s,r)?x.setSearchSuccessBannerVisible():x.resetSearchSuccessBannerSettings()}}n.props.hideTimeline(),n.ensureFullFileObjectPopulated(e,n.completeNavigateToFileOrFolder,t)},n.ensureFullFileObjectPopulated=function(e,t,r){n.props.isSearchMode?V.searchResultsActions.fetchCompleteSearchResultSRP({searchResult:e,user:n.props.user,onSuccess:t}):t(e,r)},n.completeNavigateToFileOrFolder=function(e,t){var r=n.props,o=r.isSearchMode,s=r.user,a=r.viewer,l=r.viewType,d=e.ns_id,p=e.sjid,h=e.file_id,_=e.fq_path,f=e.bytes,m=e.ext,E=e.request_id;if(S.logOpenRow({uid:s.id,entity_type:e.is_dir?"folder":"file",source:"list_browse",view_type:l,file_nsid:d,file_sjid:p,file_id:h,file_name:c.filename(e.fq_path),file_path:_,file_size:f,file_extension:m,request_id:E}),e.type===u.FileTypes.TEAM_SHARED_FOLDER&&(J.UEClient.sendEvent("FileItemRow","TeamFolderClicked"),i.TeamsWebActionsLogger.log("clicked_team_folder_web",{team_id:a.team_id})),o){var F=X.WebUserActionLogEvent.FILE_VIEW;e.is_unmounted?F=X.WebUserActionLogEvent.UNMOUNTED_VIEW:e.is_dir&&(F=X.WebUserActionLogEvent.FOLDER_OPEN),W.recordSearchResultsAction({result:e,user:s,action_type:F,view_type:l})}g.browseActions.navigateToFileOrFolder({file:e,onFileViewerUnmount:t,fileViewAction:o?Z.FileViewActionType.SEARCH:Z.FileViewActionType.CLICK})},n.actionHandlers={onDelete:n.handleDelete,onShowRename:function(e){return n.props.setFileRename({file:e,renameState:L.RenameState.PENDING_INPUT})},onRestore:function(e){var t=n.state.isOverFreeQuota;!n.props.user.is_team&&t?m.showOverquota("wb_oq_rstdel_f"):g.browseActions.doRestoreFilesWithUnifiedTrashModal({files:e})},onPermanentDelete:function(e){g.browseActions.doPermanentDeleteWithModal({files:e})},onShowComment:function(e){return n.onShowComment(e)},onPrepareForSignature:function(e){return n.onPrepareForSignature(e)}},n.getOnShowShareHandler=function(e,t){var r=n.props.browsePostTTIExperiments,o=r.expShowShowcaseInterstitial,s=r.expHasCreatedShowcase,a=r.expHasShowcaseFreemium;o?g.browseActions.handleShowShareInterstitialModal(e,t,!!s,!!a,n.props.viewType):g.browseActions.handleShowShareModal(e,t)},n.filesViewActionHandlers={onDelete:n.handleDelete,onShowRename:function(e){return n.props.setFileRename({file:e,renameState:L.RenameState.PENDING_INPUT})},onCopyToClipboard:function(e){return n.props.copyFilesToClipboard({files:e})},onPasteFromClipboard:function(){return n.props.pasteFilesFromClipboard({copyFiles:D.copyFiles})},onNewFolderSubmit:function(e){return g.browseActions.createFolder({pathName:n.browseContext.currentFQPath,folderName:e,nsId:n.browseContext.rootNSID,checkFSWs:!0})},onNewFolderCancel:function(){return g.browseActions.cancelCreateFolder()},onRenameSubmit:function(e,t){return n.props.renameFile({file:e,name:t,isSearchMode:n.props.isSearchMode})},onRenameCancel:function(e){return n.props.setFileRename({file:e,renameState:null})},onSwitchViewType:function(e){S.logSwitchViewType({uid:n.props.user.id,isSearchMode:n.props.isSearchMode,viewType:e}),n.props.setViewType({viewType:e})},onColumnsChanged:function(e,t,r){n.props.setAndStoreViewTypeColumns({columns:e,viewType:t}),n.props.setCanDisplayFolderSizes({canDisplayFolderSizes:r})},onCanDisplayFolderSizesChanged:function(e){return n.props.setCanDisplayFolderSizes({canDisplayFolderSizes:e})},onAddFileJumpKeyCode:function(e){return n.props.addFileJumpKeyCode({keyChar:e})},onResetFileJump:function(){return n.props.resetFileJumpFilter()},onShowShare:n.getOnShowShareHandler},n.uploadAjaxInterceptor={interceptUploadPrecheck:function(e){return e},interceptUpload:function(e,t){var o=t.ns_id_for_routing;if(!o){var s=n.props.mountPoints,a=n.props.brsContext.rootNSID;ee.assert(null!=s,"mountPoints is null"),ee.assert(null!=a,"rootNSID is null"),o=O.getNsId(s,a,e.dest)}return r.__assign({},t,{ns_id_for_routing:o,ns_id:o})}},n.handleSearch=function(e,t,r,o){var s=k.buildSearchURL({user:n.props.user,searchPath:t,normalizedQuery:e,searchSessionId:r?n.props.searchSessionId:H.getSearchResultsStore().searchSessionId(),searchToken:k.getSearchCsrfToken(),qargs:o});n.ensureTimer("search_results"),n.isInSinglePageSearchExperiment&&(e.length>1||n.state.latestQuery)?p.default.replace_state(s.getPath(),s.getQuery()):p.default.push_state(s.getPath(),s.getQuery())},n.handleSearchFiltersChanged=function(e){var t=e.path,r=void 0===t?n.props.path:t,o=e.deletedFiles,s=e.fileCategories,a=void 0===s?n.state.latestFileCategories:s,i=n.state,l=i.searchSessionId,c=i.latestQuery,d=n.props.user;r&&r!==n.props.path&&U.logScopeChipChanged({searchSessionId:l,user:d,chipAdded:!B.isScopeChipRoot(r),filePath:r,viewport:"right-rail",searchType:"full_page"}),void 0!==o&&o!==n.props.shouldShowDeletedFiles&&U.logDeletedFilterChanged({searchSessionId:l,user:d,deletedFiles:o,viewport:"right-rail",searchType:"full_page"});var u={};if(void 0!==o&&(u.d=o?"1":"0"),void 0!==a&&!k.allCategoriesUnchecked(a)){var p=k.fileCategoriesToString(a);u.file_categories=p}n.handleSearch(c,r,!1,u)},n.fileViewerIsShown=function(){if(n.state.arePostTTIModulesLoaded){return e("modules/clean/react/file_viewer/controller").isShown()}return!1},n.ensureFileViewerClosedIfNotPreviewing=function(e){!e.preview&&n.fileViewerIsShown()&&g.browseActions.closeFileViewer()},n.prefetchPreviewData=function(t,r){if(n.state.arePostTTIModulesLoaded){e("modules/clean/react/file_viewer/controller").prewarmPreviewData(t,r)}},n.ensureFileViewerIsOpenedOrClosedIfNeeded=function(e){var t=n.fileViewerIsShown();if(e.preview&&!t){var r=n.getFileByFilename(e.preview);r&&g.browseActions.navigateToFileOrFolder({file:r})}else t&&!e.preview&&g.browseActions.closeFileViewer()},n.getLearnMoreLinkHandler=function(){window.open("/help/business/unsynced-team-folder","_blank")};var l=H.getSearchResultsStore();return n.props.setSearchBarExperiments({experiments:n.searchBarExperiments}),n.appActionsStore=_.getAppActionsStore(),l.add_change_listener(n.receiveStateFromStores),P.uploaderStore.add_change_listener(n.receiveStateFromStores),window.addEventListener(C.ALL_UPLOADS_COMPLETE_EVENT,n.onAllUploadsComplete),n.state=r.__assign({},n.getStateFromStores(),{arePostTTIModulesLoaded:!1,searchFrom:ae.getQueryArgs().search_from}),n.props.setIsSearchMode({isSearchMode:!!n.state.latestQuery}),n}return r.__extends(l,t),Object.defineProperty(l.prototype,"uploaderExperiments",{get:function(){return this.props["exp-uploader-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"uploaderPostTTIExperiments",{get:function(){return this.state.uploaderPostTTIExperiments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"searchBarExperiments",{get:function(){return this.props["exp-search-bar-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"searchResultsExperiments",{get:function(){return this.props["exp-search-results-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"browseExperiments",{get:function(){return this.props["exp-browse-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isInSinglePageSearchExperiment",{get:function(){return q.isInSinglePageSearchExperiment(this.searchBarExperiments)},enumerable:!0,configurable:!0}),l.prototype.componentWillMount=function(){var t,o=this;t=this.props["search-query"]?["FilesViewController"]:["FilesViewController","AppActionsView"],this.browseLogger=new h.PageletLogger("browse",t,!0,{view_type:this.props.viewType.toLowerCase()});var s=this.props,a=s.urlPrefix,i=s.user,l=s.viewer,c=this.props["search-query"],d=this.props["share-link"],u=!!this.props["open-preview"],_=this.getPathFromProps();c||d||u||ce(this.getUrlForFQPath(a,_));var f=l.get_users().map(function(e){return e.id});Q.UserLocalStorage.clearOtherUsers(f),this.browseBoltClient=new n.BrowseBoltClient(i.id);var m=new F.BrowsePrefetchLoader({user:i,path:_,fqPathsToSelect:this.props["select-fq-paths"]},{onPrefetchComplete:function(e){o.prefetchComplete=!0,o.handlePreviewAndShareModalsOnLoad(e.preview_file_info),Y.log_js_modules_fetched_data_required_for_tti(),o.markTTVIfNeeded()},onPrefetchError:function(){o.prefetchComplete=!0,o.props.setUrl({path:""}),o.navigateToPath({path:""})},onLoadComplete:function(){o.maybeShowPrepopulatedAddToCollectionModal(o.props.files)},onPostTTIPrefetchComplete:function(t){var s=t["exp-browse-post-tti-experiments"],a=t["exp-uploader-post-tti-experiments"],i=!!t["is-over-free-quota"],n=!!t["maybe-render-team-admin-modals"];s.expShouldShowNcctPaywall&&$.redirect("/ncct-trial-end"),n&&new Promise(function(t,r){e(["modules/clean/react/ncct/post_tti_ncct_modal"],t,r)}).then(r.__importStar).then(function(e){(0,e.postTTINCCTReminderModal)()}),o.setState({uploaderPostTTIExperiments:a,isOverFreeQuota:i}),o.props.setBrowsePostTTIExperiments({browsePostTTIExperiments:s})},onPostTTIPrefetchError:function(e){ee.reportException({err:e||new Error("failed to load post TTI experiments")})}},{onInitializeEverything:g.browseActions.initializeEverything,onLoad:g.browseActions.load,onAddFilesAndSetLoadingState:g.browseActions.addFilesAndSetLoadingState});m.isPrefetching()&&m.handlePrefetch(),this.searchBarExperiments.expSearchSuccessBanner&&(window.addEventListener("popstate",function(){x.resetSearchSuccessBannerSettings(),x.doSearchBarInteractionBroadcast(!1)}),p.default.deconstruct_url(document.referrer).qargs.search_session_id&&!x.getClickedOnSearchResultsPageItem()?x.setSearchSuccessBannerVisible():x.resetSearchSuccessBannerSettings());p.default.add_callback(a,this.handleFileLocationChange,!0),p.default.add_callback("/search",this._handleSearchLocationChange,!c),p.default.add_exit_callback("/search",this.handleSearchExit)},l.prototype.componentDidMount=function(){var t=this;this.mounted=!0;var s=this.getPathFromProps(),a=this.props.user,i=this.props["search-query"],n=this.props["share-link"],c=!!this.props["open-preview"];this.props["from-scl-sync-modal"]&&(a.is_cdm_member?ne(s):ie(s)),this.props["show-share-success-snackbar"]&&j.showInBandShareSuccessSnackbar(d.filename(s)),this.shouldShowUnsyncNotification()&&this.showUnsyncNotification(),!i&&n&&!c&&a.is_cdm_member&&le(s),this.toggleTimelineIfNecessary(),this.markTTVIfNeeded(),l.mountFileViewerTarget(),Y.waitForTTI().then(function(){t.props["search-query"]||t.fetchAndStartBoltUpdates();var s=function(e){var r=e[0],s=(r[0],r[1],r[2].SharedWithStore),a=(r[3],r[4]),i=a.checkForMissingStarredData,n=a.StarredStore,l=(r[5],r[6],e[1]),c=(l[0],l[1],l[2].BloodhoundContactsV2),d=l[3].EmailVerification;if(l[4],l[5],l[6],t.mounted){var u=t.props,p=u.user,h=u.path,_=u.files,m=_.toArray();s.initializeWith({path:h,files:m}),i({items:m,user:p});var S=n.addListener(function(){t.setState({starredState:n.getLoadingStates()})});t.deferredCheckForMissingStarredData=function(){return o.defer(function(){i({items:t.props.files.toArray(),user:p})})},t.removeStarredStoreListener=function(){S()},c.getOrCreateForUser(p),t.setState({arePostTTIModulesLoaded:!0}),t.props["email-just-verified"]?d.getForRole(p.role).show_verified_modal():t.props["email-just-verified-and-changed"]?d.getForRole(p.role).show_verified_and_changed_modal():t.props["send-verification-email"]&&d.getForRole(p.role).show_sent_modal(),t.prefetchPreviewData(_.toArray(),p),t.props["should-open-extensions-edu-modal"]&&f.asyncShowExtensionsEduModal()}};s.perfName="browse_post_tti",Promise.all([Promise.all([new Promise(function(t,r){e(["modules/clean/react/file_viewer/controller"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/browse/file_actions"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/browse/shared_with"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/files_view/overflow_menu_with_star"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/starred/browse_exports"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/file_modal_controller"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/sharing/share_modal_util"],t,r)}).then(r.__importStar)]),Promise.all([new Promise(function(t,r){e(["modules/clean/sharing/ui_util"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/sharing/wizard/wizard_modals"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/contacts/bloodhound_contacts_v2"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/account/email"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/unity_browse_interface"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/unity/features"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/unity/check_file_cache"],t,r)}).then(r.__importStar)])]).then(s)})},l.prototype.componentWillUpdate=function(e,t){e.isSearchMode&&!this.props.isSearchMode?this.browseBoltClient.stopLiveUpdate():!e.isSearchMode&&this.props.isSearchMode&&this.fetchAndStartBoltUpdates(),e.files.equals(this.props.files)||o.defer(this.handleFileListUpdated)},l.prototype.componentDidUpdate=function(e){e.loadingState===L.LoadingState.LOADING_FIRST_PAGE&&this.props.loadingState!==e.loadingState&&this.markTTVIfNeeded(),this.deferredCheckForMissingStarredData&&e.files!==this.props.files&&this.deferredCheckForMissingStarredData()},l.prototype.componentWillUnmount=function(){this.removeStarredStoreListener&&this.removeStarredStoreListener(),window.removeEventListener("popstate",function(){x.resetSearchSuccessBannerSettings()}),l.unmountFileViewerTarget(),H.getSearchResultsStore().remove_change_listener(this.receiveStateFromStores),P.uploaderStore.remove_change_listener(this.receiveStateFromStores),window.removeEventListener(C.ALL_UPLOADS_COMPLETE_EVENT,this.onAllUploadsComplete),this.mounted=!1},Object.defineProperty(l.prototype,"browseContext",{get:function(){return this.props.isSearchMode?this.state.srpContext:this.props.brsContext},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"selection",{get:function(){return this.props.isSearchMode?this.state.srpSelection:this.props.brsSelection},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"selectedFiles",{get:function(){return this.props.isSearchMode?this.state.srpSelectedFiles:this.props.brsSelectedFiles},enumerable:!0,configurable:!0}),l.prototype.getStateFromStores=function(){var e=H.getSearchResultsStore(),t=e.latestQuery();return{isDraggingInternalFiles:I.FileUploaderController.isDraggingInternalFiles(),isDraggingExternalFiles:I.FileUploaderController.isDraggingExternalFiles(),isUploadModalOpen:I.FileUploaderController.isUploadModalOpen(),latestFileCategories:e.latestFileCategories(),srpContext:e.browseContext(),srpSelection:e.selection(),srpSelectedFiles:e.selectedFiles(),searchSessionId:e.searchSessionId(),latestQuery:t}},l.prototype.restoreUrlAfterFileViewClose=function(){var e,t=this.props.urlPrefix,r=this.getUrlForFQPath(t,this.props.path);e=this.props["open-preview"]?o.omit(ae.getQueryArgs(),T.BrowseQueryArg.preview,T.BrowseQueryArg.select):{},p.default.replace_state(r,e)},l.prototype.getUrlForFQPath=function(e,t){return e+("/"===t?"":se.URI.encode_parts(t))},l.prototype.fetchAndStartBoltUpdates=function(){this.browseBoltClient.isReady()?this.startBoltLiveUpdate():this.browseBoltClient.fetchInitialBoltData(this.startBoltLiveUpdate)},l.prototype.ensureTimer=function(e,t){if(this.ajaxRequestWebTimer&&this.ajaxRequestWebTimer.getContextName()!==e&&delete this.ajaxRequestWebTimer,this.ajaxRequestWebTimer)this.ajaxRequestWebTimer.restart();else{this.ajaxRequestWebTimer=Y.get_timer(e);var r={requireTTI:!0,requireTTV:!1};t&&(r.url=t),this.ajaxRequestWebTimer.initialize(r)}},l.prototype.navigateToPath=function(e){var t=e.path;this.browseLogger&&this.browseLogger.ttiLogged&&this.ensureTimer("browse_ajax","browse_ajax_nav"),g.browseActions.setPath({path:t,ajaxWebTimer:this.ajaxRequestWebTimer})},l.prototype.blurSearchBarIfInSinglePageSearch=function(){this.isInSinglePageSearchExperiment&&this.props.blurSearchBar()},l.prototype.onShowComment=function(e){this.ensureFullFileObjectPopulated(e,function(e){g.browseActions.navigateToFileOrFolder({file:e,shouldFocusComment:!0})})},l.prototype.onPrepareForSignature=function(e){this.ensureFullFileObjectPopulated(e,function(e){g.browseActions.navigateToFileOrFolder({file:e,shouldPrepareForSignature:!0})})},l.prototype.maybeShowPrepopulatedAddToCollectionModal=function(e){var t=ae.getQueryArgs();if(t.preselected_for_showcase){var r=t.preselected_for_showcase.split(".").map(function(e){return"id:"+e});R.showPrepopulatedAddToCollectionModal(r,this.props.user,e.toJS());var o=this.getPathFromProps(),s=this.getUrlForFQPath(this.props.urlPrefix,o);delete t[T.BrowseQueryArg.preselected_for_showcase],p.default.replace_state(s,t)}},l.prototype.shouldShowUnsyncNotification=function(){return this.props["should-show-unsync-notification"]},l.prototype.showUnsyncNotification=function(){M.Snackbar.show(s.default.createElement(M.Snackbar,{variant:"generic",title:re._("Do you also need this on your computer?",{comment:'\'"this" refers to the folder that the user is currently browsing. (limited space, please keep the phase short)'}),timeoutDelayMs:1e5,actionButtonText:re._("Learn more"),closeButtonText:re._("Close"),onActionClick:this.getLearnMoreLinkHandler}))},l.prototype.render=function(){
var e=this.state,t=e.isUploadModalOpen,r=e.starredState,o=e.arePostTTIModulesLoaded,a=e.isDraggingExternalFiles,i=e.isDraggingInternalFiles,n=e.isOverFreeQuota,l=e.searchSessionId,c=e.latestQuery,d=e.latestFileCategories,u=e.searchFrom,p=this.props,h=p.browsePostTTIExperiments,_=p.canDisplayFolderSizes,f=p.createNewFolderState,m=p.currentSort,S=p.fileRename,E=p.files,F=p.filesWithoutTeamFolders,T=p.hideTimeline,y=p.isQueryingFolderSizes,v=p.isSearchMode,b=p.isTextSelectable,R=p.isTimelineVisible,A=p.loadingState,C=p.paginatedTotalNumFiles,I=p.path,P=p.setSelection,O=p.shouldShowDeletedFiles,N=p.shouldShowPinnedTeamFolders,D=p.shouldShowSharedFolderInvites,L=p.showTimeline,x=p.teamFolders,M=p.user,U=p.viewType,B=p.viewTypeColumns,q=this,k=q.browseContext,V=q.selection,W=q.selectedFiles;return s.default.createElement(w.BrowseView,{autoTeamGroupId:this.props["auto-team-group-id"],ref:this.setBrowseViewRef,actionHandlers:this.actionHandlers,filesViewActionHandlers:this.filesViewActionHandlers,onNavigateToParentFolder:this.handleOnNavigateToParentFolder,onNavigateToPath:this.handleOnNavigateToPath,onNavigateToFileOrFolder:this.handleOnNavigateToFileOrFolder,onSearchBarResultOpen:this.handleSearchBarResultOpen,context:k,onSearchBarPathClicked:this.handleSearchBarPathClicked,createNewFolderState:f,currentSort:m,ensureFileViewerClosedIfNotPreviewing:this.ensureFileViewerClosedIfNotPreviewing,fileRename:S,files:E,filesWithoutTeamFolders:F,getIsFileJumping:this.getIsFileJumping,getFileByFullPath:this.getFileByFullPath,handleComponentTTI:this.handleComponentTTI,isDraggingExternalFiles:a,isDraggingInternalFiles:i,isFileViewerShown:this.fileViewerIsShown,isSearchMode:v,isTextSelectable:b,isTimelineVisible:R,isUploadModalOpen:t,loadingState:A,onSearch:this.handleSearch,path:I,selectedFiles:W,selection:V,shouldOpenUploadModal:this.props["should-open-upload-modal"],shouldShowDeletedFiles:O,shouldShowPinnedTeamFolders:N,shouldShowSharedFolderInvites:D,starredState:r,teamFolders:x,totalNumItems:C,uploadAjaxInterceptor:this.uploadAjaxInterceptor,user:M,viewType:U,canDisplayFolderSizes:_,columns:B[U],viewTypeColumns:B,arePostTTIModulesLoaded:o,isNoComment:this.props["is-no-comment"],isOverFreeQuota:n,isQueryingFolderSizes:y,nsId:this.props["ns-id"],uploaderExperiments:this.uploaderExperiments,uploaderPostTTIExperiments:this.uploaderPostTTIExperiments,searchBarExperiments:this.searchBarExperiments,searchResultsExperiments:this.searchResultsExperiments,browseExperiments:this.browseExperiments,browsePostTTIExperiments:h,searchSessionId:l,latestQuery:c,onSearchFiltersChanged:this.handleSearchFiltersChanged,appActionsStore:this.appActionsStore,fileCategories:d,isNautilusEnabled:!!this.props["nautilus-enabled-for-user"],isPaperEnabled:!!this.props["paper-enabled-for-user"],searchFrom:u,onShowTimeline:L,onHideTimeline:T,onSelectionChange:P,onSortFiles:g.browseActions.sortFiles,onSetUrl:this.props.setUrl})},l.mountFileViewerTarget=function(){var e=document.getElementById(T.BROWSE_FILE_VIEWER_ELEMENT_ID);e||(e=document.createElement("div"),e.id=T.BROWSE_FILE_VIEWER_ELEMENT_ID,document.body.insertBefore(e,document.body.children[0]))},l.unmountFileViewerTarget=function(){var e=document.getElementById(T.BROWSE_FILE_VIEWER_ELEMENT_ID);e&&document.body.removeChild(e)},l})(s.default.Component);t.BrowseController=ue}),define("modules/clean/react/browse/data/action_creators",["require","exports","tslib","external/immutable","external/lodash","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/history","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/data/helpers","modules/clean/react/browse/uri_helper","modules/clean/react/browse/data/selectors","modules/clean/react/browse/data/types","modules/clean/react/browse/models","modules/clean/react/file_uploader/constants","modules/clean/react/files_view/constants","modules/clean/react/files_view/types","modules/clean/react/selection","modules/clean/react/snackbar","modules/clean/search/constants","modules/clean/search/search_results/dispatcher","modules/clean/storage","modules/core/cookies","modules/core/exception","modules/core/i18n","modules/core/uri"],function(e,t,r,o,s,a,i,n,l,c,d,u,p,h,_,f,m,S,g,E,F,w,T,y,v,b,R,A){"use strict";function C(e,r,o,s){var a=o.mount_points,i=h.path(r()),n=u.getMountPointUpdateForCurrentPath(a,i,h.mountPoints(r())),l=n[0],c=n[1];l&&!c&&F.Snackbar.complete(R._("The folder was unshared."));var d=u.getPathForNewMountPoint(l,c,i);if(d)return void s({path:d});e(t.setMountPoints({mountPoints:a}))}function I(e,r,o,s,a){var l=o.added,c=o.moved,u=o.removed,p=h.path(r()),_=h.unsortedFiles(r()),m=h.folderSizes(r()),S=_.size;_=_.withMutations(function(e){m=m.withMutations(function(t){for(var r=function(e){return i.paths_are_equal(i.parent_dir(e.fq_path),p)},o=function(t){r(t)&&(e.set(t.fq_path,f.File.fromServerObject(t)),S+=1)},s=function(r,s){var a=e.get(r);if(!(a&&a.sjid>=s.sjid&&r===s.fq_path)){e.remove(r),S-=1,o(s);var i=t.get(r);i&&(t.remove(r),t.set(s.fq_path,i))}},a=function(r){e.remove(r),t.remove(r),S-=1},n=0,d=l;n<d.length;n++){var h=d[n];e.has(h.fq_path)?s(h.fq_path,h):o(h)}for(var _=0,m=c;_<m.length;_++){var g=m[_],E=g[0],h=g[1];e.has(E)?s(E,h):o(h)}for(var F=0,w=u;F<w.length;F++){var E=w[F];e.has(E)&&a(E)}})}),_.size!==S&&b.reportException({err:new Error("applyBoltUpdates ended up with unexpected number of items"),tags:["browse_file_collections_mismatch"],severity:b.SEVERITY.CRITICAL,exc_extra:{expected_unsorted_files_size:S,actual_unsorted_files_size:_.size,is_deleted_files_on:h.shouldShowDeletedFiles(r()),filesAdded:l,filesRemoved:u,filesMove:c}}),_!==h.unsortedFiles(r())&&(e(t.setUnsortedFiles({unsortedFiles:_})),n.Dispatcher.dispatch({type:d.SharedWithActionType.BROWSE_FILES_UPDATED,data:{parentPath:p,files:_.toArray()}})),m!==h.folderSizes(r())&&e(t.setFolderSizes({folderSizes:m})),x({unsortedFiles:_})(e,r,void 0)}var P=this;Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),a=r.__importStar(a),i=r.__importStar(i),l=r.__importDefault(l),c=r.__importStar(c),h=r.__importStar(h),w=r.__importStar(w);t.appInit=function(e){var t=e.experiments,o=e.shouldShowDeletedFiles,s=e.user,a=e.viewer;return function(e,i){e({type:_.ActionTypes.APP_INIT,payload:{experiments:t,shouldShowDeletedFiles:o,user:s,viewer:a}});var l=h.viewTypeColumns(i());S.AllViewTypes.forEach(function(e){var t=y.UserLocalStorage.get(s.id,d.COLUMNS_STORAGE_KEY+"_"+e);t&&(l=r.__assign({},l,(o={},o[e]=t,o)));var o}),e(L({viewTypeColumns:l}));var c=v.Cookies.read(d.BROWSE_SORT_COOKIE_NAME);if(c&&c.indexOf("|")>-1){var u=c.split("|",2),p={sortField:u[0],sortDirection:u[1]},f=h.sortOrder(i());p.sortDirection===f.sortDirection&&p.sortField===f.sortField||e(D({sortOrder:p}))}n.Dispatcher.dispatch({type:m.UploaderActionType.SET_USER,data:{user:s}})}},t.selectFilesByFqPath=function(e){var t=e.fqPathsToSelect;return{type:_.ActionTypes.SELECT_FILES_BY_FQ_PATH,payload:{fqPathsToSelect:t}}},t.setCanDisplayFolderSizes=function(e){var t=e.canDisplayFolderSizes;return{type:_.ActionTypes.SET_CAN_DISPLAY_FOLDER_SIZES,payload:{canDisplayFolderSizes:t}}},t.setClipboardFiles=function(e){var t=e.clipboardFiles;return{type:_.ActionTypes.SET_CLIPBOARD_FILES,payload:{clipboardFiles:t}}},t.copyFilesToClipboard=function(e){var r=e.files;return function(e,o){if(r.length){if(r.some(function(e){return e.isDeleted}))return void F.Snackbar.fail(R._("Deleted files cannot be added to the clipboard"));if(r.some(f.File.isTeamSharedFolder))return void F.Snackbar.fail(R._("Team Folders can’t be copied."));var s=R.ungettext("Added %(num_items)s item to clipboard","Added %(num_items)s items to clipboard",r.length).format({num_items:r.length});F.Snackbar.complete(s),e(t.setClipboardFiles({clipboardFiles:r}))}}},t.pasteFilesFromClipboard=function(e){var t=e.copyFiles;return function(e,r){t({user:h.user(r()),files:h.clipboardFiles(r()),newPath:h.path(r()),checkFSWs:!0,dataApi:c,onSuccess:function(e){var t=R.ungettext("Pasted %(num_items)s item from clipboard","Pasted %(num_items)s items from clipboard",e.length).format({num_items:e.length});F.Snackbar.complete(t)}})}},t.setContext=function(e){var t=e.context;return{type:_.ActionTypes.SET_CONTEXT,payload:{context:t}}},t.setBrowsePostTTIExperiments=function(e){var t=e.browsePostTTIExperiments;return{type:_.ActionTypes.SET_BROWSE_POST_TTI_EXPERIMENTS,payload:{browsePostTTIExperiments:t}}};var O=function(e){var t=e.fileJumpFilter;return{type:_.ActionTypes.SET_FILE_JUMP_FILTER,payload:{fileJumpFilter:t}}};t.addFileJumpKeyCode=function(e){var r=e.keyChar;return function(e,o){var s=h.fileJumpFilter(o())+r.toLowerCase();e(O({fileJumpFilter:s}));for(var a=null,i=h.fileJumpIndex(o()),n=0,l=i;n<l.length;n++){var c=l[n],d=c.fqPath;if(c.filename>=s){a=d;break}}null!=a&&e(t.selectFilesByFqPath({fqPathsToSelect:[a]}))}},t.resetFileJumpFilter=function(){return O({fileJumpFilter:""})},t.setFilePathsToSelectOnNextUpdate=function(e){var t=e.filePathsToSelectOnNextUpdate;return{type:_.ActionTypes.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,payload:{filePathsToSelectOnNextUpdate:t}}},t.showTimeline=function(){return{type:_.ActionTypes.SHOW_TIMELINE,payload:{}}},t.hideTimeline=function(){return{type:_.ActionTypes.HIDE_TIMELINE,payload:{}}},t.setFileRename=function(e){var t=e.file,r=e.renameState;return{type:_.ActionTypes.SET_FILE_RENAME,payload:{file:t,renameState:r}}};var N=function(e,t){T.SearchResultsDispatcher.dispatch({type:w.CHANGE_FILES_ACTION,data:{fileDeltas:[{before:e.fq_path,after:e.is_dir?t.set("icon",e.icon):t}]}})};t.renameFile=function(e){var s=e.file,i=e.name,n=e.isSearchMode;return function(e,l){return r.__awaiter(P,void 0,void 0,function(){var d,u,p,_,f,m;return r.__generator(this,function(r){switch(r.label){case 0:d=h.user(l()),e(t.setFileRename({file:s,renameState:g.RenameState.SAVING_INPUT})),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,c.renameFile({file:s,name:i,user:d})];case 2:return u=r.sent(),p=u.renamedFile,_=u.changesets,f=u.rollbackHints,a.notifyRenameSuccess(d,_,f,function(){n&&N(p,s),e(t.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:o.Set([s.fq_path])}))}),e(t.setFileRename({file:s,renameState:null})),n&&N(s,p),e(t.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:o.Set([p.fq_path])})),[3,4];case 3:return m=r.sent(),e(t.setFileRename({file:s,renameState:null})),[3,4];case 4:return[2]}})})}},t.setFolderSizes=function(e){var t=e.folderSizes;return{type:_.ActionTypes.SET_FOLDER_SIZES,payload:{folderSizes:t}}},t.setLoadingState=function(e){var t=e.loadingState,r=e.path;return{type:_.ActionTypes.SET_LOADING_STATE,payload:{loadingState:t,path:r}}},t.setMountPoints=function(e){var t=e.mountPoints;return{type:_.ActionTypes.SET_MOUNT_POINTS,payload:{mountPoints:t}}},t.setNewFolderCreationState=function(e){var t=e.newFolderCreationState;return{type:_.ActionTypes.SET_NEW_FOLDER_CREATION_STATE,payload:{newFolderCreationState:t}}},t.setPaginatedTotalNumFiles=function(e){var t=e.paginatedTotalNumFiles;return{type:_.ActionTypes.SET_PAGINATED_TOTAL_NUM_FILES,payload:{paginatedTotalNumFiles:t}}},t.setUrl=function(e){var o=e.path,a=void 0===o?"":o,i=e.qargs;return function(e,o){l.default.push_state(h.urlPrefix(o())+A.URI.encode_parts(a),s.omitBy(r.__assign({},s.pick(p.getQueryArgs(),["d"]),i),s.isUndefined)),e(t.setSelection({selection:E.createSelection()}))}},t.setPath=function(e){var t=e.path;return{type:_.ActionTypes.SET_PATH,payload:{path:t}}},t.setPathData=function(e){var r=e.path,s=e.files,a=e.paginatedTotalNumFiles,n=e.context;return function(e,l){if(i.paths_are_equal(r,h.path(l()))){var c=o.Map(s.map(function(e){return[e.fq_path,e]}));e(t.setContext({context:n})),e(t.setUnsortedFiles({unsortedFiles:c})),e(t.setPaginatedTotalNumFiles({paginatedTotalNumFiles:a})),e(t.clearSelection()),x({unsortedFiles:c})(e,l,void 0)}}},t.setSelection=function(e){var t=e.selection;return{type:_.ActionTypes.SET_SELECTION,payload:{selection:t}}},t.clearSelection=function(){return t.setSelection({selection:E.createSelection()})},t.setShouldShowDeletedFiles=function(e){var t=e.shouldShowDeletedFiles;return{type:_.ActionTypes.SET_SHOULD_SHOW_DELETED_FILES,payload:{shouldShowDeletedFiles:t}}};var D=function(e){var t=e.sortOrder;return{type:_.ActionTypes.SET_SORT_ORDER,payload:{sortOrder:t}}};t.setAndStoreSortOrder=function(e){var t=e.sortOrder;return function(e,r){v.Cookies.delete(d.BROWSE_SORT_COOKIE_NAME);var o=t.sortField+"|"+t.sortDirection;v.Cookies.create(d.BROWSE_SORT_COOKIE_NAME,o,1095),e(D({sortOrder:t}))}},t.setUnsortedFiles=function(e){var t=e.unsortedFiles;return{type:_.ActionTypes.SET_UNSORTED_FILES,payload:{unsortedFiles:t}}};var L=function(e){var t=e.viewTypeColumns;return{type:_.ActionTypes.SET_VIEW_TYPE_COLUMNS,payload:{viewTypeColumns:t}}};t.setAndStoreViewTypeColumns=function(e){var t=e.columns,o=e.viewType;return function(e,s){var a=h.user(s()).id;y.UserLocalStorage.set(a,d.COLUMNS_STORAGE_KEY+"_"+o,t),e(L({viewTypeColumns:r.__assign({},h.viewTypeColumns(s()),(i={},i[o]=t,i))}));var i}},t.requestFolderSizes=function(e){var t=e.fqPath;return{type:_.ActionTypes.REQUEST_FOLDER_SIZES,payload:{fqPath:t}}},t.setFolderSizesPending=function(e){var t=e.fetchFolderSizesResp;return{type:_.ActionTypes.SET_FOLDER_SIZES_PENDING,payload:{fetchFolderSizesResp:t}}},t.completeFolderSizes=function(e){var t=e.fetchFolderSizeState;return{type:_.ActionTypes.COMPLETE_FOLDER_SIZES,payload:{fetchFolderSizeState:t}}},t.setFetchFolderSizeState=function(e){var r=e.files,o=e.state;return function(e,s){var a=h.browsePostTTIExperiments(s());if(a&&a.expFolderCalcSize&&"AUTO"===a.expFolderCalcSize){for(var i={sizes_dict:[],queue:[]},n=0,l=r;n<l.length;n++){var c=l[n];c.is_dir&&c.bytes>=0&&!f.File.isNoAccessSharedFolder(c)&&(i.sizes_dict.push({fq_path:c.fq_path,size:c.bytes}),e(t.requestFolderSizes({fqPath:c.fq_path})))}e(t.setFolderSizesPending({fetchFolderSizesResp:i})),e(t.completeFolderSizes({fetchFolderSizeState:o}))}}},t.applyBoltUpdates=function(e){var r=e.updates,o=e.setPath,s=e.fluxDispatch,a=e.fluxStore;return function(e,i){var n=r.parent_changes,l=h.user(i());if(n&&n.change_to_fq_path)return u.showUserNotificationForPathChange(l,n),void t.setUrl({path:n.change_to_fq_path})(e,i,void 0);C(e,i,r,o),I(e,i,r,s,a)}};var x=function(e){var r=e.unsortedFiles;return function(e,s){var a=h.filePathsToSelectOnNextUpdate(s()).filter(function(e){return r.has(e)}).toArray();0!==a.length&&(e(t.selectFilesByFqPath({fqPathsToSelect:a})),a.length===h.filePathsToSelectOnNextUpdate(s()).size&&e(t.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:o.Set()})))}};t.setIsSearchMode=function(e){var t=e.isSearchMode;return{type:_.ActionTypes.SET_IS_SEARCH_MODE,payload:{isSearchMode:t}}},t.appendFiles=function(e){var r=e.path,s=e.files;return function(e,a){if(i.paths_are_equal(r,h.path(a()))){var n=h.unsortedFiles(a()).size,l=h.unsortedFiles(a()).merge(o.Map(s.map(function(e){return[e.fq_path,e]})));e(t.setUnsortedFiles({unsortedFiles:l})),x({unsortedFiles:l})(e,a,void 0),l.size!==n+s.length&&b.reportException({err:new Error("appendFiles ended up with unexpected number of files."),tags:["browse_file_collections_mismatch"],severity:b.SEVERITY.CRITICAL,exc_extra:{previous_unsorted_files_size:n,incoming_files_size:s.length,updated_unsorted_files_size:l.size,is_deleted_files_on:h.shouldShowDeletedFiles(a())}})}}},t.clearFiles=function(e){var r=e.path,s=e.context;return function(e,a){i.paths_are_equal(r,h.path(a()))&&(e(t.setUnsortedFiles({unsortedFiles:o.Map()})),e(t.setSelection({selection:E.createSelection()})),e(t.setPaginatedTotalNumFiles({paginatedTotalNumFiles:0})),e(t.setContext({context:s})))}}}),define("modules/clean/react/browse/data/helpers",["require","exports","tslib","external/lodash","modules/clean/filepath","modules/clean/react/snackbar","modules/core/i18n"],function(e,t,r,o,s,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),t.showUserNotificationForPathChange=function(e,t){function r(e){return o.escape(s.filename(e))}function n(e){a.Snackbar.complete(e)}function l(e){a.Snackbar.fail(e)}switch(null!=t.change_type?t.change_type.toLowerCase():null){case"moved":n(i._("This folder has been moved"));break;case"renamed":n(i._("This folder has been renamed to “%(folder_name)s”").format({folder_name:r(t.change_to_fq_path)}));break;case"deleted":l(i._("The folder “%(folder_name)s” has been deleted").format({folder_name:r(t.old_fq_path)}))}},t.getMountPointUpdateForCurrentPath=function(e,t,r){var s,a,i=function(e){return t===e};return r&&r.find(i)?(a=r.find(i)||null,s=e[r.findKey(i)]||null):(a=null,s=o.find(e,i)||null),[a,s]},t.getPathForNewMountPoint=function(e,t,r){return e&&!t?r:e&&t?s.paths_are_equal(e,t)?null:t:!e&&t?r:null}}),define("modules/clean/react/browse/data/reducer",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/react/browse/data/types","modules/clean/react/browse/models","modules/clean/react/files_view/constants","modules/clean/react/files_view/types","modules/clean/react/selection","modules/core/exception"],function(e,t,r,o,s,a,i,n,l,c,d){"use strict";function u(e,t){var o=t.payload,s=o.experiments,a=o.shouldShowDeletedFiles,i=o.user,n=o.viewer;return d.assert(null===e.user,"Cannot reinitialize Browse store; changing invariants such as `user` is untested"),r.__assign({},e,{experiments:s,shouldShowDeletedFiles:a,user:i,viewer:n})}function p(e,t){var s=t.payload.fqPathsToSelect,a=s.map(function(e){return e.toLowerCase()}),i=e.unsortedFiles.toList().filter(function(e){return a.includes(e.fq_path.toLowerCase())}),n=i.map(function(e){return e.fq_path}),l=o.OrderedSet(n),c=n.size?n.get(0):null;return r.__assign({},e,{selection:e.selection.set("selected",l).set("anchor",c)})}function h(e,t){var o=t.payload.canDisplayFolderSizes;return r.__assign({},e,{canDisplayFolderSizes:o})}function _(e,t){var o=t.payload.clipboardFiles;return r.__assign({},e,{clipboardFiles:o})}function f(e,t){var o=t.payload.context;return r.__assign({},e,{context:o})}function m(e,t){var o=t.payload.fileJumpFilter;return r.__assign({},e,{fileJumpFilter:o})}function S(e,t){var o=t.payload.filePathsToSelectOnNextUpdate;return r.__assign({},e,{filePathsToSelectOnNextUpdate:o})}function g(e,t){var o=t.payload,s=o.file,a=o.renameState;return a?r.__assign({},e,{fileRename:{file:s,state:a}}):r.__assign({},e,{fileRename:null})}function E(e,t){var o=t.payload.folderSizes;return r.__assign({},e,{folderSizes:o})}function F(e,t){var a=t.payload,i=a.loadingState,n=a.path;return s.paths_are_equal(n,e.path)?i===l.LoadingState.LOADED?r.__assign({},e,{loadingState:i,filePathsToSelectOnNextUpdate:o.Set()}):r.__assign({},e,{loadingState:i}):e}function w(e,t){var s=t.payload.mountPoints;return r.__assign({},e,{mountPoints:o.Map(s)})}function T(e,t){var o=t.payload.newFolderCreationState;return r.__assign({},e,{newFolderCreationState:o})}function y(e,t){var o=t.payload.paginatedTotalNumFiles;return r.__assign({},e,{paginatedTotalNumFiles:o})}function v(e,t){var o=t.payload.path;return r.__assign({},e,{path:o})}function b(e,t){var o=t.payload.selection;return r.__assign({},e,{selection:o})}function R(e,t){var o=t.payload.shouldShowDeletedFiles;return r.__assign({},e,{shouldShowDeletedFiles:o})}function A(e,t){var o=t.payload.sortOrder;return r.__assign({},e,{sortOrder:o})}function C(e,t){var o=t.payload.unsortedFiles;return r.__assign({},e,{unsortedFiles:o})}function I(e,t){var o=t.payload.browsePostTTIExperiments;return r.__assign({},e,{browsePostTTIExperiments:o})}function P(e,t){var o=t.payload.viewTypeColumns;return r.__assign({},e,{viewTypeColumns:o})}function O(e,t){var o=t.payload.fqPath;if(e.isQueryingFolderSizes)return e;var s=e.folderSizes.withMutations(function(e){e.set(o,{size:0,state:l.FetchFolderSizeState.LOADING})});return r.__assign({},e,{folderSizes:s,isQueryingFolderSizes:!0})}function N(e,t){var o=t.payload.fetchFolderSizesResp,s=e.currentFolderSizesQuery,a=e.folderSizes.withMutations(function(t){for(var r=function(r){t.update(r.fq_path,{size:0,state:l.FetchFolderSizeState.LOADING},function(t){return{size:!e.browsePostTTIExperiments||"CTX"!==e.browsePostTTIExperiments.expFolderCalcSize&&"AUTO"!==e.browsePostTTIExperiments.expFolderCalcSize?t.size+r.size:r.size,state:l.FetchFolderSizeState.LOADING}}),s=s.withMutations(function(e){return e.add(r.fq_path)})},a=0,i=o.sizes_dict;a<i.length;a++){r(i[a])}});return r.__assign({},e,{currentFolderSizesQuery:s,folderSizes:a})}function D(e,t){var s=t.payload.fetchFolderSizeState,a=e.folderSizes.withMutations(function(t){e.currentFolderSizesQuery.forEach(function(r){var o=e.folderSizes.get(r);o&&t.update(r,function(){return{size:o.size,state:s}})})});return r.__assign({},e,{currentFolderSizesQuery:o.Set(),folderSizes:a,isQueryingFolderSizes:!1})}function L(e,t){return r.__assign({},e,{isTimelineVisible:!0})}function x(e,t){return r.__assign({},e,{isTimelineVisible:!1})}function M(e,t){var o=t.payload.isSearchMode;return r.__assign({},e,{isSearchMode:o})}function U(e,r){switch(void 0===e&&(e=t.defaultBrowseState),r.type){case a.ActionTypes.APP_INIT:return u(e,r);case a.ActionTypes.RESET_TO_DEFAULT_FOR_TESTS_ONLY:return t.defaultBrowseState;case a.ActionTypes.SELECT_FILES_BY_FQ_PATH:return p(e,r);case a.ActionTypes.SET_CAN_DISPLAY_FOLDER_SIZES:return h(e,r);case a.ActionTypes.SET_CLIPBOARD_FILES:return _(e,r);case a.ActionTypes.SET_CONTEXT:return f(e,r);case a.ActionTypes.SET_FILE_JUMP_FILTER:return m(e,r);case a.ActionTypes.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE:return S(e,r);case a.ActionTypes.SET_FILE_RENAME:return g(e,r);case a.ActionTypes.SET_FOLDER_SIZES:return E(e,r);case a.ActionTypes.SET_LOADING_STATE:return F(e,r);case a.ActionTypes.SET_MOUNT_POINTS:return w(e,r);case a.ActionTypes.SET_NEW_FOLDER_CREATION_STATE:return T(e,r);case a.ActionTypes.SET_PAGINATED_TOTAL_NUM_FILES:return y(e,r);case a.ActionTypes.SET_PATH:return v(e,r);case a.ActionTypes.SET_SELECTION:return b(e,r);case a.ActionTypes.SET_SHOULD_SHOW_DELETED_FILES:return R(e,r);case a.ActionTypes.SET_SORT_ORDER:return A(e,r);case a.ActionTypes.SET_UNSORTED_FILES:return C(e,r);case a.ActionTypes.SHOW_TIMELINE:return L(e,r);case a.ActionTypes.HIDE_TIMELINE:return x(e,r);case a.ActionTypes.SET_VIEW_TYPE_COLUMNS:return P(e,r);case a.ActionTypes.REQUEST_FOLDER_SIZES:return O(e,r);case a.ActionTypes.SET_FOLDER_SIZES_PENDING:return N(e,r);case a.ActionTypes.COMPLETE_FOLDER_SIZES:return D(e,r);case a.ActionTypes.SET_BROWSE_POST_TTI_EXPERIMENTS:return I(e,r);case a.ActionTypes.SET_IS_SEARCH_MODE:return M(e,r)}return e}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),t.defaultBrowseState={canDisplayFolderSizes:!1,clipboardFiles:[],context:new i.BrowseContext,experiments:{},browsePostTTIExperiments:{},fileJumpFilter:"",filePathsToSelectOnNextUpdate:o.Set(),fileRename:null,folderSizes:o.Map(),isTimelineVisible:!1,loadingState:l.LoadingState.LOADING_FIRST_PAGE,mountPoints:null,newFolderCreationState:l.NewFolderCreationState.CREATE_FOLDER_INACTIVE,paginatedTotalNumFiles:0,path:"",selection:c.createSelection(),shouldShowDeletedFiles:!1,sortOrder:{sortField:l.SortField.FILENAME,sortDirection:l.SortDirection.ASCENDING},user:null,unsortedFiles:o.Map(),viewer:null,viewTypeColumns:(B={},B[l.ViewType.List]=n.LIST_VIEW_COLUMNS,B[l.ViewType.Grid]=n.GRID_VIEW_COLUMNS,B[l.ViewType.LargeGrid]=n.GRID_VIEW_COLUMNS,B),currentFolderSizesQuery:o.Set(),isQueryingFolderSizes:!1,isSearchMode:!1},t.browseReducer=U;var B}),define("modules/clean/react/browse/data/selectors",["require","exports","tslib","external/immutable","external/reselect","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/browse/data/reducer","modules/clean/react/browse/uri_helper","modules/clean/react/browse/util","modules/clean/react/files_view/types","modules/clean/redux/selectors","modules/clean/redux/types","modules/core/browser_detection","modules/core/exception","modules/clean/react/files_view/data/selectors"],function(e,t,r,o,s,a,i,n,l,c,d,u,p,h,_,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),a=r.__importStar(a),h=r.__importStar(h);var m=function(e){return u.getStateAtNamespace(e,p.BROWSE_NAMESPACE_KEY)||n.defaultBrowseState};t.canDisplayFolderSizes=function(e){return m(e).canDisplayFolderSizes},t.clipboardFiles=function(e){return m(e).clipboardFiles},t.context=function(e){return m(e).context},t.experiments=function(e){return m(e).experiments},t.postTTIExperiments=function(e){return m(e).browsePostTTIExperiments},t.fileJumpFilter=function(e){return m(e).fileJumpFilter},t.filePathsToSelectOnNextUpdate=function(e){return m(e).filePathsToSelectOnNextUpdate},t.fileRename=function(e){return m(e).fileRename},t.folderSizes=function(e){return m(e).folderSizes},t.isFileJumping=function(e){return m(e).fileJumpFilter.length>0},t.isQueryingFolderSizes=function(e){return m(e).isQueryingFolderSizes},t.loadingState=function(e){return m(e).loadingState},t.mountPoints=function(e){return m(e).mountPoints},t.newFolderCreationState=function(e){return m(e).newFolderCreationState},t.paginatedTotalNumFiles=function(e){return t.loadingState(e)===d.LoadingState.LOADED?t.sortedFiles(e).count():m(e).paginatedTotalNumFiles},t.path=function(e){return m(e).path},t.selection=function(e){return m(e).selection},t.shouldShowDeletedFiles=function(e){return m(e).shouldShowDeletedFiles},t.sortOrder=function(e){return m(e).sortOrder},t.unsortedFiles=function(e){return m(e).unsortedFiles},t.user=function(e){var t=m(e).user;return _.assert(null!=t,"Browse store `user` accessed before APP_INIT action"),t},t.viewer=function(e){var t=m(e).viewer;return _.assert(null!=t,"Browse store `viewer` accessed before APP_INIT action"),t},t.viewTypeColumns=function(e){return m(e).viewTypeColumns},t.isTimelineVisible=function(e){return m(e).isTimelineVisible},t.browsePostTTIExperiments=function(e){return m(e).browsePostTTIExperiments||{}},t.fileJumpIndex=s.createSelector(t.unsortedFiles,function(e){return e.keySeq().toArray().map(function(e){return{filename:a.filename(e).toLowerCase(),fqPath:e}}).sort(function(e,t){return e.filename<t.filename?-1:e.filename>t.filename?1:0})}),t.sortedFiles=s.createSelector(t.unsortedFiles,t.sortOrder,t.folderSizes,function(e,t,r){return c.sortFiles(e.toList(),t,r,h.mac)}),t.selectedFiles=s.createSelector(t.sortedFiles,t.selection,function(e,t){if(t.selected.isEmpty()||e.isEmpty())return o.OrderedMap();var r=e.filter(function(e){return t.selected.has(e.fq_path)});return o.OrderedMap(r.map(function(e){return[e.fq_path,e]}))}),t.urlPrefix=s.createSelector(t.user,t.viewer,function(e,t){return l.browse_root(t,e)}),t.teamFolders=s.createSelector(t.unsortedFiles,t.folderSizes,function(e,t){var r={sortField:d.SortField.FILENAME,sortDirection:d.SortDirection.ASCENDING};return c.sortFiles(e.toList().filter(function(e){return e.type===i.FileTypes.TEAM_SHARED_FOLDER}),r,t,h.mac)}),t.sortedFilesWithFolderSizes=s.createSelector(t.sortedFiles,t.folderSizes,function(e,t){return e.map(function(e){var r=t.get(e.fq_path);return r?e.updateSize(r.size,r.state):e})}),t.unsortedFilesWithFolderSizes=s.createSelector(t.unsortedFiles,t.folderSizes,function(e,t){return e.withMutations(function(r){t.forEach(function(t,o){var s=e.get(o);if(s&&t){var a=s.updateSize(t.size,t.state);r.set(o,a)}})})}),t.sortedFilesWithFoldersSizesWithoutTeamFolders=s.createSelector(t.sortedFilesWithFolderSizes,function(e){return e.filter(function(e){return e.type!==i.FileTypes.TEAM_SHARED_FOLDER})}),t.shouldShowPinnedTeamFolders=s.createSelector(t.context,t.loadingState,t.path,t.teamFolders,f.viewType,function(e,t,r,o,s){return e.showPinnedTeamFolder&&!o.isEmpty()&&a.paths_are_equal(r,"/")&&s===d.ViewType.List&&(t===d.LoadingState.LOADED||t===d.LoadingState.LOADING_REMAINING_PAGES)}),t.isSearchMode=function(e){return m(e).isSearchMode},t.shouldShowSharedFolderInvites=s.createSelector(t.browsePostTTIExperiments,t.path,function(e,t){return!!e.expShowSharedFolderInvites&&a.paths_are_equal(t,"/")})}),define("modules/clean/react/browse/data/store",["require","exports","modules/clean/redux/types","modules/clean/react/browse/data/reducer","modules/clean/redux/store"],function(e,t,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a;t.getStoreForBrowse=function(){return a||(a=s.getStoreAndRegisterReducers((e={},e[r.BROWSE_NAMESPACE_KEY]=o.browseReducer,e))),a;var e}}),define("modules/clean/react/browse/dispatcher",["require","exports","tslib","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/react/browse/store"],function(e,t,r,o,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.BrowseDispatcher={dispatch:function(e){o.assert(a.browseStoreInstantiated(),"Must call getBrowseStore() before a dispatch"),s.Dispatcher.dispatch(e)}}}),define("modules/clean/react/browse/global_actions",["require","exports","tslib","external/lodash","react","modules/clean/analytics","modules/clean/cloud_docs/constants","modules/clean/cloud_docs/new_file_menu","modules/clean/filepath","modules/clean/react/browse/action_logger","modules/clean/react/async_onboarding_move_modal","modules/clean/react/browse/actions","modules/clean/react/browse/data/action_creators","modules/clean/react/browse/data/store","modules/clean/react/browse/nav_actions","modules/clean/react/file_uploader/action_logger","modules/clean/react/modal","modules/clean/sharing/access_level","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/viewer","modules/core/browser","modules/core/browser_detection","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/user_education/user_education_client","modules/clean/web_user_action_events"],function(e,t,r,o,s,a,i,n,l,c,d,u,p,h,_,f,m,S,g,E,F,w,T,y,v,b,R,A){"use strict";function C(t){var r=t.arePostTTIModulesLoaded,l=t.context,c=t.user,u=t.viewType,p=t.showDeletedFiles,h=t.onUpload,_=void 0===h?o.noop:h,S=t.isNoComment,E=void 0!==S&&S,w=t.autoTeamGroupId,v=(t.browseExperiments,t.browsePostTTIExperiments),b=l.isCurrentlyInRoot,C=!l.canViewContainingNSMembers,P=l.isCurrentPathWriteable(),O=T.is_input_webkitdirectory_supported(),N={className:"action-upload",label:D(I.UploadFiles),popoverLabel:D(I.Files),iconName:O?"upload-file":"upload",performAction:function(){return _(!1)},disabled:!P},W=O?{className:"action-upload",label:D(I.UploadFolder),popoverLabel:D(I.Folder),iconName:"upload-folder",performAction:function(){return _(!0)},disabled:!P}:void 0,H=!l.isInsideSandboxFolder,G=v.expTimeline,z=v.expEnableCloudDocsPaperCreate,j=v.expEnableCloudDocsGddCreate,Q=function(){return s.default.createElement(n.NewFileMenu,{key:"new-file-menu",user:c,source:i.NewFileMenuFromType.BROWSE,path:l.currentFQPath,disabled:!P,showGdd:!!j,showPaper:!!z,primaryButton:!1})},K=function(){return s.default.createElement(n.NewFileMenu,{key:"new-file-menu",user:c,source:i.NewFileMenuFromType.BROWSE,path:l.currentFQPath,disabled:!P,showGdd:!!j,showPaper:!!z,primaryButton:!0})},J=[];if(l.isInsideTeamFolderTree||!l.isInsideDeletedSharedFolder&&!l.isInsideDeletedNestedSharedFolder)if(l.isInsideDeletedFolder)J.push({label:D(I.RestoreFolder),iconName:"restore",className:"action-restore",performAction:B(c,u,l),disabled:!P});else{var Y={label:D(I.NewFolder),iconName:"new-folder",performAction:L(c,u,l,w,v.expSubgrowthProOQNewFolder,v.expNewFolderModal),disabled:!P,className:"action-new-folder"},X={label:D(b?I.NewSharedFolder:I.ShareFolder),iconName:"new-shared-folder",performAction:M(c,l,v.expSubgrowthProOQNewFolder),disabled:C,className:"action-share-folder"},Z={label:D(I.NewTeamFolder),iconName:"new-team-folder",performAction:k(c,l),disabled:!1,className:"action-team-folder"};if(c.is_cdm_member&&"/"===l.currentFQPath){R.UEClient.registerBulkCallbackForEducationStep([{
moduleName:"trial_admin_setup_team_space",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_v2",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_mobile",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_mobile_v2",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_folder_structure",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_folder_structure_v2",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_free_order",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_free_order_v2",stepName:"team_folder_modal"}],Y.performAction);var $=function(e){a.TeamsWebActionsLogger.log(e),window.setTimeout(function(){R.UEClient.sendEvent("SetStructureModal","Close")},2500),m.Modal.close()};R.UEClient.registerBulkCallbackForEducationStep([{moduleName:"trial_admin_shared_workspace",stepName:"set_structure_modal"},{moduleName:"trial_admin_shared_workspace_v2",stepName:"set_structure_modal"}],function(){var e={user:c,teamName:F.Viewer.get_viewer().team_name,onSuccess:function(){return $("uj_ss_modal_success")},onError:function(){return $("uj_ss_modal_error")},onCancel:function(){return $("uj_ss_modal_cancel")}};d.showOnboardingMoveDialog(e)}),J.push(K),J.push(N),O&&J.push(W),J.push(Y)}else b?(J.push(K),J.push(N),O&&J.push(W),!c.is_cdm_member&&g.GoldenGate.hasContentManagerAndSuperAdmin(c.id)&&J.push(Z),J.push(X,Y)):(H?J.push(X):J.push(K),J.push(N),O&&J.push(W),J.push(Y),H&&J.push(Q));E||J.push({label:D(p?I.HideDeletedFiles:I.ShowDeletedFiles),iconName:p?"hide":"show-deleted-files",performAction:U(c,u,p),disabled:C,className:"action-deleted-files"}),!F.Viewer.get_viewer().is_assume_user_session&&(g.GoldenGate.hasContentManagerAndSuperAdmin(c.id)&&g.GoldenGate.hasNewOwnershipModel(c.id)&&l.isInsideTeamFolderTree||!c.is_cdm_member&&g.GoldenGate.hasContentManagerAndSuperAdmin(c.id)&&l.isCurrentlyInRoot)&&J.push({label:D(I.ManageAsAdmin),iconName:"settings-gear",performAction:k(c,l)}),G&&J.push({label:D(I.FolderHistory),iconName:"view-folder-history",performAction:x(c,l)})}else J.push({label:D(I.ReAddSharedFolder),iconName:"restore",performAction:q(c,l),disabled:!P});if(W&&J[0]===N){y.assert(J[1]===W,"`uploadFolderItem` does not immediately follow `uploadFilesItem`");var ee={className:"action-upload",label:D(I.Upload),iconName:"upload",performAction:function(){return f.logUploadAction(c.id,A.WebUserActionLogEvent.UPLOAD_CLICK)},disabled:!P,subItems:[N,W]};J.splice(0,2,ee)}if(r){var te=e("modules/clean/unity/features").default,re=v.expSubgrowthBizTeamsTriggersClientLinkWork||"";["V1","V2"].includes(re)&&null!=te&&c.is_team&&J.push({iconName:"monitor",label:D(I.ShowLocalCopy),performAction:V(c,l)})}return J}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importDefault(s),l=r.__importStar(l),p=r.__importStar(p),f=r.__importStar(f),w=r.__importStar(w),T=r.__importStar(T);var I;(function(e){e[e.UploadFiles=1]="UploadFiles",e[e.UploadFolder=2]="UploadFolder",e[e.Upload=3]="Upload",e[e.Files=4]="Files",e[e.Folder=5]="Folder",e[e.NewPaperDoc=6]="NewPaperDoc",e[e.NewFolder=7]="NewFolder",e[e.RestoreFolder=8]="RestoreFolder",e[e.ReAddSharedFolder=9]="ReAddSharedFolder",e[e.ShowDeletedFiles=10]="ShowDeletedFiles",e[e.HideDeletedFiles=11]="HideDeletedFiles",e[e.NewSharedFolder=12]="NewSharedFolder",e[e.ShareFolder=13]="ShareFolder",e[e.ManageAsAdmin=14]="ManageAsAdmin",e[e.NewTeamFolder=15]="NewTeamFolder",e[e.ShowLocalCopy=16]="ShowLocalCopy",e[e.FolderHistory=17]="FolderHistory"})(I||(I={}));var P={},O=function(){return T.mac?v._("Show in Finder"):T.windows?v._("Show in Explorer"):v._("Show local copy")},N=function(e){switch(e){case I.UploadFiles:return v._("Upload files");case I.UploadFolder:return v._("Upload folder");case I.Upload:return v._("Upload");case I.FolderHistory:return v._("Folder history");case I.Files:return v._("Files");case I.Folder:return v._("Folder");case I.NewPaperDoc:return v._("New Paper Document");case I.NewFolder:return v._("New folder");case I.RestoreFolder:return v._("Restore folder");case I.ReAddSharedFolder:return v._("Re-add shared folder");case I.ShowDeletedFiles:return v._("Show deleted files");case I.HideDeletedFiles:return v._("Hide deleted files");case I.NewSharedFolder:return v._("New shared folder");case I.ShareFolder:return v._("Share folder");case I.ManageAsAdmin:return v._("View in admin console");case I.NewTeamFolder:return v._("New team folder");case I.ShowLocalCopy:return O()}},D=function(e){return e in P||(P[e]=N(e)),P[e]},L=function(t,o,s,a,i,n){return function(){if("V1"===i)new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.showSubgrowthProOQNewFolderModal({oqa:"wb_oq_ad_fo_fi"})});else{var d=s.currentNSID,p=s.currentFQPath;if(c.logCreateFolder({uid:t.id,view_type:o,file_nsid:d,file_path:p,file_name:l.filename(p)}),t.is_cdm_member&&"/"===p){y.assert(!!a,"All CDM Users should have an auto team group in their team");var h=function(e){b.Notify.error(e?e:v._("There was a problem completing this request.")),u.browseActions.cancelCreateFolder()},f=function(e){var t=e.user,r=e.folderName,o=e.fqPath;u.browseActions.createFolderComplete({user:t,folderName:r,changesets:null}),u.browseActions.selectFilesByFqPath({fqPathsToSelect:[o]}),n&&u.browseActions.handleNewFolderRedirectOnSuccess(o)};g.asyncShowAppropriateNewFolderModalForCdmUser({user:t,context:s,autoTeamGroupId:a,showFileSystemWarningsModal:void 0,onPending:u.browseActions.createFolderPending,onComplete:f,onCancel:h,autoTeamGroupDefaultAccessLevel:S.ACCESS_LEVEL.WRITER,setPath:_.browseNavActions.setPath,setUrl:_.browseNavActions.setUrl})}else if(n){var m=function(e){var r=e.folderName,o=e.isConfidential;u.browseActions.createFolderInNewFolderModal({folderName:r,isConfidential:o,user:t,context:s})};g.asyncShowCdmNewFolderModal(m,t,s,!1,!1,!0)}else u.browseActions.nameNewFolder();"CONTROL"===i&&new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.logExposureSubgrowthProOQNewFolderModal("CONTROL")})}}},x=function(e,t){return function(){h.getStoreForBrowse().dispatch(p.showTimeline())}},M=function(t,o,s){return function(){"V1"===s?new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.showSubgrowthProOQNewFolderModal({oqa:"wb_oq_ad_shfo_fi"})}):o.isCurrentlyInRoot?g.asyncShowShareAFolderWizardModal(t):g.asyncShowShareModal(t,o,{origin:E.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS},_.browseNavActions.setPath,_.browseNavActions.setUrl),"CONTROL"===s&&new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.logExposureSubgrowthProOQNewFolderModal("CONTROL")})}},U=function(e,t,r){return function(){c.logToggleDeletedFiles({uid:e.id,show_deleted_files:!r,view_type:t}),u.browseActions.setShouldShowDeletedFiles({shouldShowDeletedFiles:!r})}},B=function(e,t,r){return function(){var o=r.currentNSID,s=r.currentFQPath;c.logRestore({uid:e.id,view_type:t,file_nsid:o,file_path:s,file_name:l.filename(s),num_files_selected:0,num_folders_selected:1}),u.browseActions.doRestoreFilesWithUnifiedTrashModal({})}},q=function(e,t){return function(){var r=t.currentFQPath.toLowerCase(),o=t.inactiveNSIDByFQPath[r],s=t.isInsideDeletedNestedSharedFolder;o&&g.asyncMountSharedFolder(o,e.role,E.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS,!1,null,s)}},k=function(e,t){return function(){g.asyncGoToContentManagerForPath({isLimitedTeam:F.Viewer.get_viewer().team_is_limited,containingFolder:t.currentFQPath,isCDM:e.is_cdm_member})}},V=function(e,t){return function(){var r=t.currentNSID,o=t.currentNSPath,s=F.Viewer.get_viewer().team_id,a=w.get_uri().path;c.logOpenLocalCopyAction({event_name:"view_in_dropbox_link_clicked",team_id:s,url:a}),u.browseActions.openLocalCopy({nsId:r,nsPath:o,userId:e.id,onSuccess:function(){c.logOpenLocalCopyAction({event_name:"view_in_dropbox_client_open",team_id:s,url:a})},onError:function(e){c.logOpenLocalCopyAction({error_message:e,event_name:"view_in_dropbox_link_error",team_id:s,url:a}),b.Notify.error(v._("Please make sure you are logged into the same account on your Dropbox desktop app."))}})}};t.getGlobalActions=C}),define("modules/clean/react/browse/nav_actions",["require","exports","tslib","modules/clean/pagination_manager","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/data/action_creators","modules/clean/react/browse/data/store","modules/clean/react/browse/dispatcher","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/files_view/types","modules/core/browser_detection","modules/clean/flux/dispatcher"],function(e,t,r,o,s,a,i,n,l,c,d,u,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),i=r.__importStar(i),p=r.__importStar(p);var _=(function(){function e(e){var t=this;this.dataApi=e,this.setPath=function(e){var r=e.path,s=e.ajaxWebTimer,n=d.getBrowseStore(),h=n.user().id;l.BrowseDispatcher.dispatch({type:a.DEPRECATED__BrowseActionType.SET_PATH,data:{path:r}}),t.setLoadingState({loadingState:u.LoadingState.LOADING_FIRST_PAGE,path:r});var _=function(e){var r=e.path,a=e.data,n=e.xhr;if(s){var l=n.getResponseHeader("x-dropbox-request-id");s.end(l?l:void 0)}t.reduxStore.dispatch(i.setMountPoints({mountPoints:a.ns_id_to_mount_point}));var d=c.BrowseContext.fromServerObject(a);if(a.paginated){t.clear({path:r,context:d});var p=a.first_page.total_num_items;o.PaginationManager.create({firstPage:a.first_page,keyName:"sjid",ajaxURL:"/browse_get_next",userID:h,newDataAvailableCallback:function(e,o){var s=e.areAllItemsReady()?u.LoadingState.LOADED:u.LoadingState.LOADING_REMAINING_PAGES;t.addFilesAndSetLoadingState({path:r,files:o,paginatedTotalNumFiles:p,loadingState:s}),e.areAllItemsReady()&&e.stopAutoFetching()}}).startAutoFetching()}else{var _=a.file_info,f=_?_.length:0;t.load({path:r,files:_,paginatedTotalNumFiles:f,context:d})}};t.dataApi.loadPath({sortLabel:n.sortLabel(),sortIsAscending:n.sortIsAscending(),path:r,userId:h,sortFoldersFirst:!p.mac,includeDeletedFiles:n.shouldShowDeletedFiles(),onSuccess:_,onError:function(){"/"!==r&&t.setPath({path:"/"})}})},this.reduxStore=n.getStoreForBrowse()}return e.prototype.setUrl=function(e){var t=e.path,r=e.qargs;n.getStoreForBrowse().dispatch(i.setUrl({path:t,qargs:r}))},e.prototype.setLoadingState=function(e){var t=e.loadingState,r=e.path;l.BrowseDispatcher.dispatch({type:a.DEPRECATED__BrowseActionType.SET_LOADING_STATE,data:{loadingState:t,path:r}})},e.prototype.load=function(e){var t=e.path,r=e.files,o=e.paginatedTotalNumFiles,s=e.context;l.BrowseDispatcher.dispatch({type:a.DEPRECATED__BrowseActionType.LOAD_PATH,data:{path:t,files:r,paginatedTotalNumFiles:o,context:s}}),h.Dispatcher.dispatch({type:a.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:t,files:r}})},e.prototype.clear=function(e){var t=e.path,r=e.context;l.BrowseDispatcher.dispatch({type:a.DEPRECATED__BrowseActionType.CLEAR_FILES,data:{path:t,context:r}})},e.prototype.addFilesAndSetLoadingState=function(e){var t=e.path,r=e.loadingState,o=e.files,s=e.paginatedTotalNumFiles;l.BrowseDispatcher.dispatch({type:a.DEPRECATED__BrowseActionType.ADD_FILES_AND_SET_LOADING_STATE,data:{path:t,loadingState:r,files:o,paginatedTotalNumFiles:s}}),h.Dispatcher.dispatch({type:a.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:t,files:o}})},e.prototype.setDataApi=function(e){this.dataApi=e},e})();t.BrowseNavActions=_,t.browseNavActions=new _(s)}),define("modules/clean/react/browse/professional_collection_actions",["require","exports","tslib","external/lodash","modules/core/exception"],function(e,t,r,o,s){"use strict";function a(t,a,i){var n=o.keyBy(i,"file_id");if(!o.every(t,function(e){return!!n[e]}))return void s.reportException({err:new Error("Could not find specified files to add to Showcase")});var l=t.map(function(e){var t=n[e];return{ns_id:t.ns_id,ns_path:t.ns_path,fq_path:t.fq_path}});new Promise(function(t,r){e(["modules/clean/react/professional_collection/add_to_collection_modal_controller"],t,r)}).then(r.__importStar).then(function(e){(0,e.showAddToCollectionModal)(l,a)})}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.showPrepopulatedAddToCollectionModal=a}),define("modules/clean/react/browse/sidebar",["require","exports","tslib","react","modules/clean/search/search_results/sidebar_view","modules/clean/react/browse/sidebar_view"],function(e,t,r,o,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),t.BrowseSidebar=function(e){var t=e.autoTeamGroupId,i=e.arePostTTIModulesLoaded,n=e.canDisplayFolderSizes,l=e.context,c=e.handleComponentTTI,d=e.isNoComment,u=e.isSearchMode,p=e.isTimelineVisible,h=e.selectedFiles,_=e.shouldShowDeletedFiles,f=e.starredState,m=e.user,S=e.viewType,g=e.uploaderExperiments,E=e.uploaderPostTTIExperiments,F=e.browseExperiments,w=e.browsePostTTIExperiments,T=e.uploadAjaxInterceptor,y=e.searchBarExperiments,v=e.actionHandlers,b=e.path,R=e.onSearch,A=e.onUploadButtonClick,C=e.onGetFileActionsForFiles,I=e.responsive,P=e.onSearchFiltersChanged,O=e.fileCategories,N=e.isNautilusEnabled,D=e.isPaperEnabled,L={user:m,selectedFiles:h,arePostTTIModulesLoaded:i,context:l,viewType:S,shouldShowDeletedFiles:_,responsive:I};return u?o.default.createElement(s.SearchResultsSidebarView,r.__assign({},L,{path:b,actionHandlers:v,searchBarExperiments:y,onSearch:R,onSearchFiltersChanged:P,fileCategories:O,isNautilusEnabled:N,isPaperEnabled:D})):o.default.createElement(a.BrowseSidebarView,r.__assign({},L,{isTimelineVisible:p,autoTeamGroupId:t,canDisplayFolderSizes:n,uploaderExperiments:g,uploaderPostTTIExperiments:E,browseExperiments:F,browsePostTTIExperiments:w,handleComponentTTI:c,onUploadButtonClick:A,isNoComment:d,onGetFileActionsForFiles:C,starredState:f,uploadAjaxInterceptor:T}))}}),define("modules/clean/react/browse/sidebar_view",["require","exports","tslib","react","modules/clean/react/app_actions_view","modules/clean/react/browse/global_actions","modules/clean/react/browse/util","modules/clean/react/file_uploader/file_uploader","modules/core/i18n"],function(e,t,r,o,s,a,i,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o);var c=(function(t){function c(e){var r=t.call(this,e)||this;return r.state={appActionsProps:r.getCurrentAppActionsProps(r.props)},r}return r.__extends(c,t),c.prototype.componentWillReceiveProps=function(e){e.selectedFiles===this.props.selectedFiles&&e.context===this.props.context&&e.user===this.props.user&&e.shouldShowDeletedFiles===this.props.shouldShowDeletedFiles&&e.isNoComment===this.props.isNoComment&&e.arePostTTIModulesLoaded===this.props.arePostTTIModulesLoaded&&e.viewType===this.props.viewType&&e.starredState===this.props.starredState&&e.canDisplayFolderSizes===this.props.canDisplayFolderSizes&&e.uploadAjaxInterceptor===this.props.uploadAjaxInterceptor&&e.responsive.isMatchedMedium===this.props.responsive.isMatchedMedium&&e.responsive.isMatchedLarge===this.props.responsive.isMatchedLarge&&e.uploaderExperiments===this.props.uploaderExperiments&&e.uploaderPostTTIExperiments===this.props.uploaderPostTTIExperiments&&e.browseExperiments===this.props.browseExperiments&&e.browsePostTTIExperiments===this.props.browsePostTTIExperiments||this.setState({appActionsProps:this.getCurrentAppActionsProps(e)})},c.prototype.renderSingleSelectionAudienceBox=function(t){var r=t.selectedFiles,s=t.arePostTTIModulesLoaded,a=t.context,i=t.user,n=r.first();if(s){var l=e("modules/clean/react/browse/shared_with").SharedWithController;return o.default.createElement(l,{file:n,browseContext:a,user:i,isInAudienceBox:!0})}return null},c.prototype.getCurrentAppActionsProps=function(t){function r(e){return"function"==typeof e?e:{displayName:e.label,popoverMenuName:e.popoverLabel,iconName:e.iconName,handleClick:e.performAction,disabled:e.disabled,className:e.className,badge:e.badge}}var s,n=t.selectedFiles,c=t.autoTeamGroupId,d=t.context,u=t.canDisplayFolderSizes,p=t.onGetFileActionsForFiles,h=t.user,_=t.viewType,f=t.shouldShowDeletedFiles,m=t.onUploadButtonClick,S=t.isNoComment,g=t.browseExperiments,E=t.browsePostTTIExperiments,F=t.arePostTTIModulesLoaded,w=t.handleComponentTTI,T=t.responsive,y=i.getSelectedFilesText(n,d),v=n.count(),b=o.default.createElement("div",null);if(v>0)s=p(n,u,T,!0,!0),1===v&&(b=this.renderSingleSelectionAudienceBox(t));else if(s=a.getGlobalActions({arePostTTIModulesLoaded:F,context:d,user:h,viewType:_,showDeletedFiles:f,onUpload:m,isNoComment:S,autoTeamGroupId:c,browseExperiments:g,browsePostTTIExperiments:E}),F){var R=e("modules/clean/react/browse/shared_with").SharedWithController;b=o.default.createElement(R,{browseContext:d,user:h,isInAudienceBox:!0})}var A,C=s[0];if(C)if("function"==typeof C)A=C;else{var I=void 0;C.subItems&&(I=C.subItems.map(r)),A={displayName:C.label,iconName:C.iconName,handleClick:C.performAction,disabled:C.disabled,className:C.className,subItems:I}}var P=s.slice(1).map(r);return t.isNoComment&&(b=o.default.createElement("div",null)),{headerText:y,popoverTriggerLabel:l._("Actions"),primaryMenuItem:A,primarySubnode:b,secondaryMenuItems:P,handleComponentTTI:w}},c.prototype.maybeRenderBrowseFileUploader=function(){var e=this.props,t=e.context,r=e.viewType,s=e.uploadAjaxInterceptor,a=e.uploaderExperiments,i=e.uploaderPostTTIExperiments;return null!=t.currentFQPath?o.default.createElement(n.FileUploaderController,{key:"file-uploader-controller",ref:"fileUploader",loadOnRender:!1,needToSetStoreValues:!1,ajaxInterceptor:s,uploaderExperiments:a,uploaderPostTTIExperiments:i,browseViewType:r}):null},c.prototype.render=function(){return o.default.createElement("div",{className:"maestro-browse-action-sidebar"},this.maybeRenderBrowseFileUploader(),o.default.createElement(s.AppActionsView,r.__assign({},this.state.appActionsProps,{responsive:this.props.responsive})))},c})(o.default.PureComponent);t.BrowseSidebarView=c}),define("modules/clean/react/browse/store",["require","exports","tslib","modules/clean/filepath","external/immutable","modules/clean/react/browse/data/action_creators","modules/clean/react/browse/data/selectors","modules/clean/react/browse/data/store","modules/clean/react/browse/models","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/files_view/constants","modules/clean/react/files_view/types"],function(e,t,r,o,s,a,i,n,l,c,d,u,p){"use strict";function h(){return null===m&&(m=new f),m}function _(){return null!==m}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),a=r.__importStar(a),i=r.__importStar(i),n=r.__importStar(n);var f=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._init=function(){this._reduxStore=n.getStoreForBrowse()},t.prototype.sortedFiles=function(){return i.sortedFiles(this._reduxStore.getState())},t.prototype.files=function(){return i.sortedFilesWithFolderSizes(this._reduxStore.getState())},t.prototype.filesMap=function(){return i.unsortedFilesWithFolderSizes(this._reduxStore.getState())},t.prototype.teamFolders=function(){return i.teamFolders(this._reduxStore.getState())},t.prototype.path=function(){return i.path(this._reduxStore.getState())},t.prototype.user=function(){return i.user(this._reduxStore.getState())},t.prototype.viewer=function(){return i.viewer(this._reduxStore.getState())},t.prototype.urlPrefix=function(){return i.urlPrefix(this._reduxStore.getState())},t.prototype.selection=function(){return i.selection(this._reduxStore.getState())},t.prototype.paginatedTotalNumFiles=function(){return i.paginatedTotalNumFiles(this._reduxStore.getState())},t.prototype.selectedFiles=function(){return i.selectedFiles(this._reduxStore.getState())},t.prototype.loadingState=function(){return i.loadingState(this._reduxStore.getState())},t.prototype.context=function(){return i.context(this._reduxStore.getState())},t.prototype.shouldShowDeletedFiles=function(){return i.shouldShowDeletedFiles(this._reduxStore.getState())},t.prototype.isTimelineVisible=function(){return i.isTimelineVisible(this._reduxStore.getState())},t.prototype.currentSort=function(){return i.sortOrder(this._reduxStore.getState())},t.prototype.sortIsAscending=function(){return this.currentSort().sortDirection===p.SortDirection.ASCENDING},t.prototype.sortLabel=function(){return u.SortIsFilename.includes(this.currentSort().sortField)?p.SortLabel.FILENAME:this.currentSort().sortField===p.SortField.MODIFIED?p.SortLabel.MODIFIED:p.SortLabel.SIZE},t.prototype.viewTypeColumns=function(){return i.viewTypeColumns(this._reduxStore.getState())},t.prototype.getIndexOfFile=function(e){return this.sortedFiles().findIndex(function(t){return t.sjid===e.sjid&&t.ns_id===e.ns_id})},t.prototype.getFileByFilename=function(e){return this.sortedFiles().find(function(t){return o.filename(t.fq_path)===e})||null},t.prototype.clipboardFiles=function(){return i.clipboardFiles(this._reduxStore.getState())},t.prototype.newFolderCreationState=function(){return i.newFolderCreationState(this._reduxStore.getState())},t.prototype.isFileJumping=function(){return i.isFileJumping(this._reduxStore.getState())},t.prototype.canDisplayFolderSizes=function(){return i.canDisplayFolderSizes(this._reduxStore.getState())},t.prototype.isQueryingFolderSizes=function(){return i.isQueryingFolderSizes(this._reduxStore.getState())},t.prototype.experiments=function(){return i.experiments(this._reduxStore.getState())},t.prototype.browsePostTTIExperiments=function(){return i.browsePostTTIExperiments(this._reduxStore.getState())},t.prototype.filePathsToSelectOnNextUpdate=function(){return i.filePathsToSelectOnNextUpdate(this._reduxStore.getState())},t.prototype.folderSizes=function(){return i.folderSizes(this._reduxStore.getState())},t.prototype.initializeEverything=function(e){var t=e.path,r=e.files,o=e.paginatedTotalNumFiles,i=e.context,n=e.mountPoints,l=e.fqPathsToSelect,c=e.loadingState,d=e.teamFolders;this.setPath({path:t}),this.appendFiles({path:t,files:r.concat(d),paginatedTotalNumFiles:o},!1),this._reduxStore.dispatch(a.setMountPoints({mountPoints:n})),this.setLoadingState({path:t,loadingState:c}),c===p.LoadingState.LOADED?this._reduxStore.dispatch(a.selectFilesByFqPath({fqPathsToSelect:l})):this._reduxStore.dispatch(a.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:s.Set(l)})),this._reduxStore.dispatch(a.setContext({context:i})),this.emit_change()},t.prototype.setPathData=function(e,t){var r=e.path,o=e.files,s=e.paginatedTotalNumFiles,i=e.context;void 0===t&&(t=!0),this._reduxStore.dispatch(a.setPathData({path:r,files:o.map(function(e){return e instanceof l.File?e:l.File.fromServerObject(e)}),paginatedTotalNumFiles:s,context:i})),t&&this.emit_change()},t.prototype.clearFiles=function(e){var t=e.path,r=e.context;this._reduxStore.dispatch(a.clearFiles({path:t,context:r})),this.emit_change()},t.prototype.setFetchFolderSizeState=function(e,t,r){var o=e.files;void 0===t&&(t=p.FetchFolderSizeState.COMPLETE),void 0===r&&(r=!0),this._reduxStore.dispatch(a.setFetchFolderSizeState({files:o.map(function(e){return e instanceof l.File?e:l.File.fromServerObject(e)}),state:t})),r&&this.emit_change()},t.prototype.appendFiles=function(e,t){var r=e.path,o=e.files,s=e.paginatedTotalNumFiles;void 0===t&&(t=!0),this._reduxStore.dispatch(a.appendFiles({path:r,files:o.map(function(e){return e instanceof l.File?e:l.File.fromServerObject(e)})})),this.filePathsToSelectOnNextUpdate().count()&&this._reduxStore.dispatch(a.selectFilesByFqPath({fqPathsToSelect:this.filePathsToSelectOnNextUpdate().toArray()})),this._reduxStore.dispatch(a.setPaginatedTotalNumFiles({paginatedTotalNumFiles:s})),t&&this.emit_change()},t.prototype.setPath=function(e){var t=e.path;this._reduxStore.dispatch(a.setPath({path:t})),this.emit_change()},t.prototype.setLoadingState=function(e){var t=e.path,r=e.loadingState;this._reduxStore.dispatch(a.setLoadingState({loadingState:r,path:t})),this.emit_change()},t.prototype.selectFilesAfterUpload=function(e){var t=this,r=e.fqPathsToSelect;r.every(function(e){return t.filesMap().has(e)})?(this._reduxStore.dispatch(a.selectFilesByFqPath({fqPathsToSelect:r})),this.emit_change()):this._reduxStore.dispatch(a.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:s.Set(r)}))},t.prototype.sortFiles=function(e){this._reduxStore.dispatch(a.setAndStoreSortOrder({sortOrder:e})),this.emit_change()},t.prototype._new_payload=function(e){var t=e.action;switch(t.type){case d.DEPRECATED__BrowseActionType.INITIALIZE_EVERYTHING:this.initializeEverything(t.data);break;case d.DEPRECATED__BrowseActionType.LOAD_PATH:this.setPathData(t.data,!1),this.setFetchFolderSizeState(t.data,p.FetchFolderSizeState.COMPLETE,!1),this.setLoadingState({path:t.data.path,loadingState:p.LoadingState.LOADED});break;case d.DEPRECATED__BrowseActionType.CLEAR_FILES:this.clearFiles(t.data);break;case d.DEPRECATED__BrowseActionType.ADD_FILES_AND_SET_LOADING_STATE:this.appendFiles(t.data,!1),this.setLoadingState(t.data);break;case d.DEPRECATED__BrowseActionType.SET_PATH:this.setPath(t.data);break;case d.DEPRECATED_PRIVATE__BrowseActionType.SELECT_FILES_AFTER_UPLOAD:this.selectFilesAfterUpload(t.data);break;case d.DEPRECATED__BrowseActionType.SET_LOADING_STATE:this.setLoadingState(t.data);break;case d.DEPRECATED__BrowseActionType.SORT_FILES:this.sortFiles(t.data)}},t})(c.Store);t.BrowseStore=f;var m=null;t.getBrowseStore=h,t.browseStoreInstantiated=_}),define("modules/clean/react/browse/title",["require","exports","tslib","react","modules/core/i18n","modules/clean/browse_uri_interface","modules/clean/filepath","modules/clean/react/file_uploader/file_uploader","modules/clean/viewer","modules/clean/react/maestro/header","modules/clean/react/path_breadcrumbs"],function(e,t,r,o,s,a,i,n,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),i=r.__importStar(i);var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleGetUrlForPath=function(e){return a.browse_uri_for_fq_path(t.props.user,e).toString()},t}return r.__extends(t,e),t.setPageTitle=function(e){e&&(document.title=s._("%(folder_name)s - Dropbox").format({folder_name:i.filename(e,s._("Files"))}))},t.prototype.componentDidMount=function(){t.setPageTitle(this.props.path)},t.prototype.componentWillReceiveProps=function(e){e.path!==this.props.path&&t.setPageTitle(e.path)},t.prototype.render=function(){var e=this.props,t=e.path,r=e.user,a=e.isDraggingInternalFiles,u=e.isDraggingExternalFiles,p=e.isUploadModalOpen,h=e.isSearchMode,_=e.onSetUrl;if(h)return o.default.createElement(c.MaestroHeaderTitle,null,s._("Search results"));var f=i.filename("",l.Viewer.get_root_name(r)),m="work"===r.role?s._("Work"):s._("Personal");return o.default.createElement(d.PathBreadcrumbs,{path:t,isDraggingInternalFiles:a,setFileUploaderPath:n.FileUploaderController.setPathAndPermissions,getUrlForPath:this.handleGetUrlForPath,firstBreadcrumbName:f,firstBreadcrumbAlt:m,shouldHighlightDropTargets:a||u&&!p,setUrl:_})},t})(o.default.PureComponent);t.BrowseTitle=u}),define("modules/clean/react/browse/web_team_sharing_experiment",["require","exports","tslib","react","modules/clean/react/file_uploader/constants","modules/clean/react/async_fileops_modals","modules/clean/analytics","external/immutable","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],function(e,t,r,o,s,a,i,n,l,c){"use strict";var d=this;Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),a=r.__importStar(a),n=r.__importStar(n);var u=l.Loadable({loader:function(){return r.__awaiter(d,void 0,void 0,function(){var t;return r.__generator(this,function(o){switch(o.label){case 0:return[4,c.waitForTTI()];case 1:return o.sent(),[4,new Promise(function(t,r){e(["modules/clean/react/web_team_sharing_modal"],t,r)}).then(r.__importStar)];case 2:return t=o.sent().WebTeamSharingModal,[2,t]}})})}}),p=(function(t){function l(e){var r=t.call(this,e)||this;return r.removeUploadListener=function(){window.removeEventListener(s.ALL_UPLOADS_COMPLETE_EVENT,r.handleUploadsComplete)},r.closeTeamSharingModal=function(){return r.setState({isWebTeamSharingModalOpen:!1})},r.openFileMoveDialog=function(){r.closeTeamSharingModal(),i.TeamsWebActionsLogger.log("post_m1_sharing_modal_clicked"),a.showMove({files:r.props.selectedFiles.toArray(),path:r.props.context.currentFQPath,user:r.props.user})},r.state={isWebTeamSharingModalOpen:!1,uploadedFiles:[],expWebSharingActive:!1},r}return r.__extends(l,t),l.prototype.componentWillReceiveProps=function(t){return r.__awaiter(this,void 0,void 0,function(){var o,a,i,n=this;return r.__generator(this,function(l){switch(l.label){case 0:return!t.browsePostTTIExperiments.expBizAddFilesTeamFolderRwls||this.handleUploadsComplete?[3,2]:[4,new Promise(function(t,r){e(["modules/clean/growth/experiments/web_sharing_helper"],t,r)}).then(r.__importStar)];case 1:o=l.sent(),a=o.logExposure,i=o.shouldShowModal,this.handleUploadsComplete=function(e){if(i(n.props.user,n.props.path)){a();var t=e.detail.files;n.setState({isWebTeamSharingModalOpen:!0,uploadedFiles:t,expWebSharingActive:!0})}},window.addEventListener(s.ALL_UPLOADS_COMPLETE_EVENT,this.handleUploadsComplete),l.label=2;case 2:return[2]}})})},l.prototype.componentWillUnmount=function(){this.handleUploadsComplete&&this.removeUploadListener()},l.prototype.render=function(){return this.state.expWebSharingActive?o.default.createElement(u,{context:this.props.context,files:this.state.uploadedFiles,handleModalClose:this.closeTeamSharingModal,handleAction:this.openFileMoveDialog,open:this.state.isWebTeamSharingModalOpen,user:this.props.user}):null},l.defaultProps={selectedFiles:n.OrderedMap()},l})(o.default.PureComponent);t.WebTeamSharingModalExperiment=p}),define("modules/clean/react/file_uploader/action_logger",["require","exports","tslib","modules/clean/filepath","modules/clean/web_upload_action_logger","modules/clean/web_user_action_logger","modules/clean/web_user_action_events"],function(e,t,r,o,s,a,i){"use strict";function n(e){return e&&!!e.uploadId}function l(e){return e&&!!e.batchId}function c(e){return e===i.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK||e===i.WebUserActionLogEvent.ADD_MORE_FILES_CLICK||e===i.WebUserActionLogEvent.VIEW_DETAILS_CLICK||e===i.WebUserActionLogEvent.CLOSE_MODAL_CLICK||e===i.WebUserActionLogEvent.DISMISS_INLINE_STATUS||e===i.WebUserActionLogEvent.UPLOAD_CLICK||e===i.WebUserActionLogEvent.UPLOAD_FILES_CLICK||e===i.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK||e===i.WebUserActionLogEvent.CANCEL_UPLOAD_CLICK}function d(e,t,i,d,u,p,h){var _={num_files:p,num_dirs:h,chooser_type:d,upload_method:u};if(n(i)){var f=i;_=r.__assign({},_,{upload_id:f.uploadId,file_size:f.size,file_extension:o.file_extension(f.name),failure_reason:f.errorType,batch_id:f.batchId})}else if(l(i)){var f=i;_=r.__assign({},_,{file_size:f.size,file_extension:o.file_extension(f.name),batch_id:f.batchId})}c(t)?a.WebUserActionLog.log(e,t,_):(t=t,_.client_timestamp=Math.round(Date.now()/1e3),s.WebUploadActionLog.log(e,t,_))}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.logUploadAction=d}),define("modules/clean/react/file_uploader/constants",["require","exports","tslib","external/immutable"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);(function(e){e.SET_PATH="UPLOADER_SET_PATH",e.SET_FOLDER_NS_ID="UPLOADER_SET_FOLDER_NS_ID",e.SET_USER="UPLOADER_SET_USER",e.SET_NUM_DRAGGING_FILES="SET_NUM_DRAGGING_FILES",e.QUEUE_UPLOADS="QUEUE_UPLOADS",e.START_UPLOAD="START_UPLOAD",e.COMPLETE_UPLOAD="COMPLETE_UPLOAD",e.CANCEL_UPLOADS="CANCEL_UPLOADS",e.SET_CURRENT_UPLOAD_PROGRESS="SET_CURRENT_UPLOAD_PROGRESS",
e.UPLOAD_ERROR="UPLOAD_ERROR",e.SET_IS_UPLOAD_MODAL_OPEN="SET_IS_UPLOAD_MODAL_OPEN",e.SET_INLINE_STATUS_SHOULD_BE_DISMISSED="SET_INLINE_STATUS_SHOULD_BE_DISMISSED",e.ADD_NEW_FAILED_FILE="ADD_NEW_FAILED_FILE",e.CONFIRM_FSW="CONFIRM_FSW",e.ADD_FILES_TO_PLU="ADD_FILES_TO_PLU",e.ADD_DIRECTORIES_TO_PLU="ADD_DIRECTORIES_TO_PLU",e.REMOVE_FILES="REMOVE_FILES"})(t.UploaderActionType||(t.UploaderActionType={}));var s;(function(e){e.PENDING="PENDING",e.UPLOADING="UPLOADING",e.COMPLETE="COMPLETE",e.CANCELLED="CANCELLED",e.FAILED="FAILED"})(s=t.FileStatusType||(t.FileStatusType={}));var a;(function(e){e.FILE_SIZE_ERROR="FILE_SIZE_ERROR",e.HTTP_ERROR="HTTP_ERROR",e.CONNECTION_ERROR="CONNECTION_ERROR",e.OVER_QUOTA_ERROR="OVER_QUOTA_ERROR",e.LOCKED_TEAM_ERROR="LOCKED_TEAM_ERROR",e.IGNORED="IGNORED",e.EMPTY_OR_FOLDER="EMPTY_OR_FOLDER",e.FOLDER_SAFARI="FOLDER_SAFARI",e.PACKAGE_FILE="PACKAGE_FILE",e.GENERIC="GENERIC",e.BLOCKS_MISSING_ERROR="BLOCKS_MISSING_ERROR",e.COMMIT_HTTP_ERROR="COMMIT_HTTP_ERROR",e.UPLOAD_BLOCK_ERROR="UPLOAD_BLOCK_ERROR",e.CHUNKS_NOT_ENABLED_ERROR="CHUNKS_NOT_ENABLED_ERROR",e.SERVER_RESPONSE_ERROR="SERVER_RESPONSE_ERROR",e.SERVER_TOKEN_EMPTY_ERROR="SERVER_TOKEN_EMPTY_ERROR",e.SERVER_TOKENS_MISSING_ERROR="SERVER_TOKENS_MISSING_ERROR",e.SERVER_HASH_RESPONSE_ERROR="SERVER_HASH_RESPONSE_ERROR",e.BLOCK_RUNTIME_ID_MISSING_ERROR="BLOCK_RUNTIME_ID_MISSING",e.CLIENT_HASH_EMPTY_ERROR="CLIENT_HASH_EMPTY_ERROR",e.SERVER_HASH_EMPTY_ERROR="SERVER_HASH_EMPTY_ERROR",e.HASHES_NOT_EQUAL_ERROR="HASHES_NOT_EQUAL_ERROR",e.BLOCK_INDEX_ERROR="BLOCK_INDEX_ERROR",e.BLOCK_EMPTY_ERROR="BLOCK_EMPTY_ERROR",e.BLOB_EMPTY_ERROR="BLOB_EMPTY_ERROR",e.BLOB_MISSING_ERROR="BLOB_MISSING_ERROR",e.CLIENT_HASH_DIGEST_ERROR="CLIENT_HASH_DIGEST_ERROR",e.FILE_READER_NULL_RESULT_ERROR="FILE_READER_NULL_RESULT_ERROR",e.COMMIT_READINESS_ERROR="COMMIT_READINESS_ERROR",e.UPLOAD_PRECHECK_ERROR="UPLOAD_PRECHECK_ERROR",e.UPLOAD_PRECHECK_INVALID_CHAR_ERROR="UPLOAD_PRECHECK_INVALID_CHAR_ERROR"})(a=t.UploadErrorType||(t.UploadErrorType={}));(function(e){e.NONE="NONE",e.BASIC_OVER_QUOTA="BASIC_OVER_QUOTA",e.BASIC_NEAR_QUOTA="BASIC_NEAR_QUOTA",e.LIMITED_TEAM_USER_OVER_QUOTA="LIMITED_TEAM_USER_OVER_QUOTA",e.LIMITED_TEAM_TSD_OVER_QUOTA="LIMITED_TEAM_TSD_OVER_QUOTA",e.LOCKED_TEAM_USER_OVER_QUOTA="LOCKED_TEAM_USER_OVER_QUOTA"})(t.OverQuotaStatusType||(t.OverQuotaStatusType={}));var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t})(o.Record({uploadId:void 0,dest:"",ns_id:null,ns_path:null,userId:null,name:"",size:0,percentUploaded:0,status:s.PENDING,errorType:a.GENERIC,errorMessage:"",batchId:void 0},"FileUpload"));t.FileUpload=i,t.UPLOAD_BEGIN_EVENT="dbxUploadBegin",t.UPLOAD_CANCEL_EVENT="dbxUploadCancel",t.UPLOAD_COMPLETE_EVENT="dbxUploadComplete",t.ALL_UPLOADS_COMPLETE_EVENT="dbxAllUploadsComplete",t.UPLOAD_ERROR_EVENT="dbxUploadError";(function(e){e[e["4mb"]=0]="4mb",e[e["8mb"]=1]="8mb"})(t.ValidChunkSizeStrings||(t.ValidChunkSizeStrings={}))}),define("modules/clean/react/file_uploader/store",["require","exports","tslib","external/immutable","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/utils","modules/core/exception"],function(e,t,r,o,s,a,i,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._init=function(){this._path="/",this._hasPermissionToUploadToFolder=!0,this._folderNsId=null,this._user=null,this._fileList=o.OrderedMap(),this._currentUploadId=null,this._numDraggingFiles=0,this._isInternalTransfer=!1,this._isUploadModalOpen=!1,this._inlineStatusShouldBeDismissed=!1,this._numSecondsLeft=0,this._confirmedFSWs=[],this._confirmedFSWBatchIds=[]},t.prototype.fileList=function(){return this._fileList},t.prototype.currentUpload=function(){var e=this._currentUploadId;if(!e)return null;var t=this._fileList.get(e);return t?t:null},t.prototype.uploadById=function(e){var t;return e&&(t=this._fileList.get(e)),t||void 0},t.prototype.numSecondsLeft=function(){return this._numSecondsLeft},t.prototype.isUploadCancelled=function(e){var t=this._fileList.get(e);return!!t&&t.status===i.FileStatusType.CANCELLED},t.prototype.inlineStatusShouldBeDismissed=function(){return this._inlineStatusShouldBeDismissed},t.prototype.path=function(){return this._path},t.prototype.folderNsId=function(){return this._folderNsId},t.prototype.hasPermissionToUploadToFolder=function(){return this._hasPermissionToUploadToFolder},t.prototype.user=function(){return this._user},t.prototype.nextUpload=function(){return this._fileList.find(function(e){return e.status===i.FileStatusType.PENDING})},t.prototype.numDraggingFiles=function(){return this._numDraggingFiles},t.prototype.isInternalTransfer=function(){return this._isInternalTransfer},t.prototype.isUploadModalOpen=function(){return this._isUploadModalOpen},t.prototype.confirmedFSWs=function(){return this._confirmedFSWs},t.prototype.confirmedFSWBatchIds=function(){return this._confirmedFSWBatchIds},t.prototype.setUser=function(e){var t=e.user;this._user=t,this.emit_change()},t.prototype.setPathData=function(e){var t=e.path,r=e.context;this._path=t,this._hasPermissionToUploadToFolder=r.isCurrentPathWriteable(),this.emit_change()},t.prototype.setPath=function(e){var t=e.path,r=e.hasPermissionToUploadToFolder,o=void 0===r||r;this._path=t,this._hasPermissionToUploadToFolder=o,this._confirmedFSWs=[],this.emit_change()},t.prototype.setFolderNsId=function(e){var t=e.folderNsId;this._folderNsId=t},t.prototype.initializeEverything=function(e){var t=e.path,r=e.context;this._path=t,this._hasPermissionToUploadToFolder=r.isCurrentPathWriteable(),this.emit_change()},t.prototype.queueUploads=function(e){for(var t=e.files,r={},o=0,s=t;o<s.length;o++){var a=s[o];r[a.uploadId]=a}this._fileList=this._fileList.merge(r),this.emit_change()},t.prototype.startUpload=function(e){var t=e.file;l.assert(null==this.currentUpload(),"can't start an unload while one is ongoing"),l.assert(null!=t,"missing file to upload"),l.assert(this._fileList.get(t.uploadId)===t,"failed to find file in file list"),this._fileList.get(t.uploadId)&&(this._fileList=this._fileList.update(t.uploadId,function(e){return e.set("status",i.FileStatusType.UPLOADING)}),this._currentUploadId=t.uploadId),this.emit_change()},t.prototype.completeUpload=function(e){var t=e.uploadId,r=this._fileList.get(t);r&&(t===this._currentUploadId&&r.status===i.FileStatusType.UPLOADING||l.reportStack("Tried to mark a file upload that is not currently uploading as complete",{exc_extra:{file:r.toString(),fileListLength:this._fileList.count(),uploadId:t,currentUploadId:this._currentUploadId}}),this._fileList=this._fileList.update(t,function(e){return e.set("status",i.FileStatusType.COMPLETE)})),this._currentUploadId=null,this.emit_change()},t.prototype.cancelUploads=function(e){for(var t=e.files,r=0,o=t;r<o.length;r++){var s=o[r];this._fileList=this._fileList.update(s.uploadId,function(e){return e.status===i.FileStatusType.PENDING||e.status===i.FileStatusType.UPLOADING?e.set("status",i.FileStatusType.CANCELLED):e}),s.uploadId===this._currentUploadId&&(this._currentUploadId=null)}this.emit_change()},t.prototype.setCurrentUploadProgress=function(e){var t=e.percentComplete,r=e.numSecondsLeft,o=this._currentUploadId;o&&(this._fileList=this._fileList.update(o,function(e){return e.set("percentUploaded",t)}),void 0!==r&&(this._numSecondsLeft=r)),this.emit_change()},t.prototype.handleUploadError=function(e){var t=e.uploadId,r=e.errorType,o=e.errorMessage,s=this._fileList.get(t);s&&(s.uploadId!==this._currentUploadId&&l.reportStack("Error reported for file upload that is not the current upload",{exc_extra:{file:s.toString(),fileListLength:this._fileList.count(),errorType:r,errorMessage:o}}),this._fileList=this._fileList.update(s.uploadId,function(e){return e.set("status",i.FileStatusType.FAILED).set("errorType",r).set("errorMessage",o)})),this._currentUploadId=null,this.emit_change()},t.prototype.setNumDraggingFiles=function(e){var t=e.numDraggingFiles,r=e.isInternalTransfer,o=void 0!==r&&r;this._numDraggingFiles=t,this._isInternalTransfer=o,this.emit_change()},t.prototype.setIsUploadModalOpen=function(e){var t=e.isUploadModalOpen;this._isUploadModalOpen=t,this.emit_change()},t.prototype.setInlineStatusShouldBeDismissed=function(e){var t=e.inlineStatusShouldBeDismissed;this._inlineStatusShouldBeDismissed=t,this.emit_change()},t.prototype.addNewFailedFile=function(e){var t=e.file,r=e.errorType,o=e.errorMessage;null==t.uploadId&&(t=t.set("uploadId",n.generateUploadId())),t=t.set("status",i.FileStatusType.FAILED).set("errorType",r).set("errorMessage",o),this._fileList=this._fileList.set(t.uploadId,t),this.emit_change()},t.prototype.confirmFSW=function(e){var t=this,r=e.fswIds,o=e.batchId;r.forEach(function(e){t._confirmedFSWs.includes(e)||t._confirmedFSWs.push(e)}),this._confirmedFSWBatchIds.includes(o)||this._confirmedFSWBatchIds.push(o)},t.prototype._new_payload=function(e){var t=e.action;switch(t.type){case a.DEPRECATED__BrowseActionType.INITIALIZE_EVERYTHING:this.initializeEverything(t.data);break;case i.UploaderActionType.SET_USER:this.setUser(t.data);break;case a.DEPRECATED__BrowseActionType.LOAD_PATH:this.setPathData(t.data);break;case i.UploaderActionType.SET_PATH:this.setPath(t.data);break;case i.UploaderActionType.SET_FOLDER_NS_ID:this.setFolderNsId(t.data);break;case i.UploaderActionType.QUEUE_UPLOADS:this.queueUploads(t.data);break;case i.UploaderActionType.START_UPLOAD:this.startUpload(t.data);break;case i.UploaderActionType.COMPLETE_UPLOAD:this.completeUpload(t.data);break;case i.UploaderActionType.CANCEL_UPLOADS:this.cancelUploads(t.data);break;case i.UploaderActionType.SET_CURRENT_UPLOAD_PROGRESS:this.setCurrentUploadProgress(t.data);break;case i.UploaderActionType.UPLOAD_ERROR:this.handleUploadError(t.data);break;case i.UploaderActionType.SET_NUM_DRAGGING_FILES:this.setNumDraggingFiles(t.data);break;case i.UploaderActionType.SET_IS_UPLOAD_MODAL_OPEN:this.setIsUploadModalOpen(t.data);break;case i.UploaderActionType.SET_INLINE_STATUS_SHOULD_BE_DISMISSED:this.setInlineStatusShouldBeDismissed(t.data);break;case i.UploaderActionType.ADD_NEW_FAILED_FILE:this.addNewFailedFile(t.data);break;case i.UploaderActionType.CONFIRM_FSW:this.confirmFSW(t.data)}},t})(s.Store);t.UploaderStoreClass=c,t.uploaderStore=new c}),define("modules/clean/react/file_uploader/utils",["require","exports","tslib","modules/clean/base64","modules/core/browser"],function(e,t,r,o,s){"use strict";function a(){return n()}function i(){return"batch-"+n()}function n(){for(var e="",t=0;t<16;++t)e+=String.fromCharCode(Math.floor(256*Math.random()));var r=o.encode(e);return r=r.replace(/\+/g,"-"),r=r.replace(/\//g,"_"),r=r.replace(/\=*$/,"")}function l(e,t){var r=0;return e.forEach(function(e){t.indexOf(e.status)!==-1&&(r+=e.size)}),r}function c(e,t,r){var o=t,s=0;return e.forEach(function(e,t){for(var a=0,i=e.split("/"),n=r.split("/");a<i.length&&a<n.length&&i[a]===n[a];)a++;a===i.length&&a>1&&a>s&&(s=a,o=Number(t))}),o}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),t.generateUploadId=a,t.generateBatchId=i,t.calculateSizeOfUploads=l,t.getNsId=c,t.getOQmodalOQALocationCode=function(e){return"/h"===(e||s.get_uri().path)?"ho":"fb"}}),define("modules/clean/react/fileops_actions",["require","exports","tslib","react","modules/core/notify","modules/core/i18n","modules/clean/em_string","modules/clean/filepath","modules/clean/react/async_file_modal_controller","modules/clean/file_operations/notifications","modules/clean/react/browse/api","modules/clean/react/browse/nav_actions","modules/clean/react_format","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/react/browse/models","modules/clean/viewer"],function(e,t,r,o,s,a,i,n,l,c,d,u,p,h,_,f,m){"use strict";function S(e,t,r,o){var i=m.Viewer.get_viewer().team_name,c=!1;"is_cdm_member"in e&&e.is_cdm_member&&n.inSubDirectory(e.cdm_tmf_path,o)&&(c=!0);var d=E(e,t,i,r,c);if(null!=d){s.Notify.clear();var p=1===r.length,S=g(e,i,r.length,c),F=r[0]instanceof f.File&&p?a._("See owner"):void 0,w=function(){r[0]instanceof f.File&&h.asyncShowShareModal(e.id,r[0],{origin:_.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS},u.browseNavActions.setPath,u.browseNavActions.setUrl)};l.showMoveErrorModal({title:S,content:d,learnMoreLink:"/help/business/team-space-overview#move",buttonString:F,onClick:w})}}function g(e,t,r,o){return"is_cdm_member"in e&&e.is_cdm_member&&!o?a.ungettext("Can’t move shared folder to the %(team_name)s team space","Can’t move shared folders to the %(team_name)s team space",r).format({team_name:i.Emstring.em_snippet(t,_.SNIPPET_SIZES.DISPLAY_NAME)}):a.ungettext("Can’t move shared folder to a team folder","Can’t move shared folders to a team folder",r)}function E(e,t,r,s,l){var c={VIEW_ONLY_ACCESS_ERROR:"view_only_access_error",OFF_TEAM_OWNER_ERROR:"off_team_owner_error",OWNER_ONLY_MANAGE_MEMBERSHIP_ERROR:"owner_only_manage_membership_error"},d=null;return t===c.OFF_TEAM_OWNER_ERROR?d=1===s.length?null==r?p.reactFormat(a._("The owner of <strong>%(file_name)s</strong> is a member of another team.").format({file_name:i.Emstring.em_snippet(n.filename(s[0].fq_path),_.SNIPPET_SIZES.FILENAME)}),{strong:o.default.createElement("strong",{style:{fontWeight:500}})}):p.reactFormat(a._("The owner of <strong>%(file_name)s</strong> isn’t a member of %(team_name)s.").format({team_name:r,file_name:i.Emstring.em_snippet(n.filename(s[0].fq_path),_.SNIPPET_SIZES.FILENAME)}),{strong:o.default.createElement("strong",{style:{fontWeight:500}})}):null==r?a._("The owner of some of these shared folders is a member of another team."):a._("The owner of some of these shared folders isn’t a member of %(team_name)s.").format({team_name:r}):t===c.OWNER_ONLY_MANAGE_MEMBERSHIP_ERROR?d=1===s.length?"is_cdm_member"in e&&e.is_cdm_member&&!l?p.reactFormat(a._("Only the owner of <strong>%(file_name)s</strong> can move it to the %(team_name)s team space.").format({team_name:r,file_name:i.Emstring.em_snippet(n.filename(s[0].fq_path),_.SNIPPET_SIZES.FILENAME)}),{strong:o.default.createElement("strong",{style:{fontWeight:500}})}):p.reactFormat(a._("Only the owner of <strong>%(file_name)s</strong> can move it to a team folder.").format({file_name:i.Emstring.em_snippet(n.filename(s[0].fq_path),_.SNIPPET_SIZES.FILENAME)}),{strong:o.default.createElement("strong",{style:{fontWeight:500}})}):"is_cdm_member"in e&&e.is_cdm_member&&!l?a._("Only the owner can move some of these folders to the %(team_name)s team space.").format({team_name:r}):a._("Only the owner can move some of these folders to a team folder."):t===c.VIEW_ONLY_ACCESS_ERROR&&(d=1===s.length?p.reactFormat(a._("You can only view <strong>%(file_name)s</strong>. Ask an owner or editor of the folder for access to edit it.").format({file_name:i.Emstring.em_snippet(n.filename(s[0].fq_path),_.SNIPPET_SIZES.FILENAME)}),{strong:o.default.createElement("strong",{style:{fontWeight:500}})}):a._("You can’t edit some of these folders. Ask an owner or editor of the folders for access to edit them.")),d}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importStar(n),l=r.__importStar(l),c=r.__importStar(c),d=r.__importStar(d),t.copyFiles=function(e){var o=e.files,s=e.newPath,i=e.checkFSWs,n=e.onSuccess,u=e.onRequestNotSent,p=e.onUndo,h=e.user,_=e.dataApi;!(void 0===_?d:_).copyFiles({files:o,newPath:s,checkFSWs:i,userId:h.id,onSuccess:function(i){var d=i.newFiles,u=i.changesets,_=i.rollbackHints,f=i.failureDetails;if(f){var m=function(){t.copyFiles(r.__assign({},e,{checkFSWs:!1}))};l.showFileSystemWarningsModal({fsws:f,onFinalAccept:m,confirmText:a._("Copy")})}else n&&n(d),c.notifyCopySuccess(o.length,h,u,s,_,function(){p&&p()})}})&&u&&u()},t.moveFiles=function(e){var o=e.path,i=e.files,n=e.newPath,u=e.checkFSWs,p=e.onSuccess,h=e.onRequestNotSent,_=e.onUndo,f=e.user,m=e.dataApi,g=void 0===m?d:m,E=function(o){var s=o.newFiles,d=o.changesets,u=o.rollbackHints,h=o.failureDetails;if(h){var m=function(){t.moveFiles(r.__assign({},e,{checkFSWs:!1}))};l.showFileSystemWarningsModal({fsws:h,onFinalAccept:m,confirmText:a._("Move")})}else c.notifyMoveSuccess(i.length,f,d,n,u,function(){_&&_()}),p&&p(s)},F=function(e){"This will result in losing ownership of these folders."===e?(s.Notify.clear(),l.showConfirmOwnershipTransferModal(function(){g.moveFiles({path:o,files:i,newPath:n,userId:f.id,onSuccess:E,allowOwnershipTransfer:!0})})):S(f,e,i,n)};!g.moveFiles({path:o,files:i,newPath:n,checkFSWs:u,userId:f.id,onSuccess:E,onError:F,allowOwnershipTransfer:!1})&&h&&h()}}),define("modules/clean/react/files_view/data/action_creators",["require","exports","tslib","modules/clean/react/browse/constants","modules/clean/react/files_view/data/selectors","modules/clean/react/files_view/data/types","modules/core/cookies"],function(e,t,r,o,s,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s);t.setViewType=function(e){var t=e.viewType;return function(e,r){i.Cookies.delete(o.VIEW_TYPE_COOKIE_NAME),i.Cookies.create(o.VIEW_TYPE_COOKIE_NAME,t,1095),e({type:a.ActionTypes.SET_VIEW_TYPE,payload:{viewType:t}})}},t.loadViewType=function(){return function(e,t){var r=i.Cookies.read(o.VIEW_TYPE_COOKIE_NAME);null!==r&&r!==s.viewType(t())&&e({type:a.ActionTypes.SET_VIEW_TYPE,payload:{viewType:r}})}}}),define("modules/clean/react/files_view/data/reducer",["require","exports","tslib","modules/clean/react/files_view/data/types","modules/clean/react/files_view/types"],function(e,t,r,o,s){"use strict";function a(e,r){switch(void 0===e&&(e=t.defaultFilesViewState),r.type){case o.ActionTypes.SET_VIEW_TYPE:return i(e,r.payload)}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.defaultFilesViewState={viewType:s.ViewType.List};var i=function(e,t){var o=t.viewType;return r.__assign({},e,{viewType:o})};t.filesViewReducer=a}),define("modules/clean/react/files_view/data/selectors",["require","exports","modules/clean/react/files_view/data/reducer","modules/clean/redux/selectors","modules/clean/redux/types"],function(e,t,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return o.getStateAtNamespace(e,s.FILES_VIEW_NAMESPACE_KEY)||r.defaultFilesViewState};t.viewType=function(e){return a(e).viewType}}),define("modules/clean/react/files_view/data/store",["require","exports","modules/clean/react/files_view/data/reducer","modules/clean/redux/store","modules/clean/redux/types"],function(e,t,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a;t.getStoreForFilesView=function(){return a||(a=o.getStoreAndRegisterReducers((e={},e[s.FILES_VIEW_NAMESPACE_KEY]=r.filesViewReducer,e))),a;var e}}),define("modules/clean/react/files_view/data/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.SET_VIEW_TYPE="FILES_VIEW/SET_VIEW_TYPE"})(t.ActionTypes||(t.ActionTypes={}))}),define("modules/clean/search/api",["require","exports","tslib","modules/clean/ajax","modules/clean/analytics","modules/clean/react/browse/models","modules/clean/search/search_helpers","modules/clean/search/constants","modules/clean/search/types","modules/clean/search/models","modules/clean/search/api_helpers","modules/clean/search/search_helpers","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_bar/data/store"],function(e,t,r,o,s,a,i,n,l,c,d,u,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),i=r.__importStar(i),n=r.__importStar(n);var _=(function(){function e(){this._activeRequest=null}return e.prototype.abortPreviousLoading=function(){null!=this._activeRequest&&this._activeRequest.abort()},e.prototype.loadResults=function(e){var t=e.user,r=e.path,o=e.query,s=e.start,a=e.maxResults,l=e.searchSessionId,c=e.nsid,u=e.fileNameOnly,p=e.loadDeleted,h=e.showPaperResults,_=e.isDropdown,f=e.isAdminConsole,m=e.showSymlinkIcon,S=e.webTimer,g=e.onSuccess,E=e.onError,F=e.overrideUrl,w=d.getCurrentTimezoneOffset(),T={query:o,search_token:i.getSearchCsrfToken(),fq_path:r,ns_id:c,filename_only:!!u,max_results:a,deleted:!!p,start:s,show_paper_results:!!h,is_dropdown:!!_,is_admin_console:!!f,show_unmounted_results:!0,timezone_offset:w,show_symlink_icon:m,include_browse_context:!0},y=F?F:n.FULLTEXT_SEARCH_ENDPOINT;this._fetchResults({requestData:T,user:t,searchSessionId:l,url:y,onSuccess:g,onError:E,webTimer:S})},e.prototype._extractSearchResultsList=function(e){for(var t=[],r=0,o=e;r<o.length;r++){var s=o[r];switch(s.search_result_type){case l.SearchResultTypes.FILE:t.push(a.File.fromServerObject(s));break;case l.SearchResultTypes.PAPER:t.push(a.Paper.fromServerObject(s));break;case l.SearchResultTypes.PAPER_FOLDER:t.push(a.PaperFolder.fromServerObject(s))}}return t},e.prototype._getSearchType=function(e){return e.is_dropdown?"dropdown":e.deleted?"full_page_deleted":"full_page"},e.prototype.loadPartialResults=function(e){var t=e.user,o=e.maxResults,s=e.start,a=e.path,l=e.query,c=e.fileCategories,d=e.searchSessionId,p=e.showSymlinkIcon,h=e.includeBrowseContext,_=e.webTimer,f=e.onSuccess,m=e.onError,S=c?u.fileCategoriesToString(c):"",g=r.__assign({query:l,search_token:i.getSearchCsrfToken(),fq_path:a,start:s,max_results:o,show_paper_results:!0,show_symlink_icon:p,include_browse_context:h,search_session_id:d},S&&{file_categories:S});this._fetchResults({requestData:g,user:t,searchSessionId:d,url:n.PARTIAL_SEARCH_FRONTEND_SERVICE_ENDPOINT,onSuccess:f,onError:m,webTimer:_})},e.prototype._fetchResults=function(e){var t=this,a=e.requestData,i=e.user,n=e.searchSessionId,l=e.url,d=e.onSuccess,_=e.onError,f=e.webTimer;null!=this._activeRequest&&this._activeRequest.abort();var m=u.fileCategoryStringToLogValue(a.file_categories),S=p.experiments(h.getStoreForSearchBar().getState()),g=r.__assign({path_scoped:"/"!==a.fq_path,search_type:this._getSearchType(a),query_string:a.query,start:a.start,search_session_id:n,timezone_offset:a.timezone_offset},u.isInFileTypeFilterExperiment(S)&&{file_type_filters:m});s.SearchClientActivityLogger.log("query_started",i.id,g);var E=(new Date).getTime();this._activeRequest=o.WebRequest({url:l,data:a,dataType:"json",subject_user:i,success:function(e,r,o){var l;a.include_browse_context&&(l=c.extractBrowseContext(e));var u=e.search_results,p=o.getResponseHeader("x-dropbox-request-id");u.forEach(function(e){return e.request_id=p});var h=t._extractSearchResultsList(u);d({context:l,searchResults:h,deleted:!!a.deleted});var _=s.SearchClientActivityLogger.create_search_log_dict(g,p,E,a.query,h.length,null,n,null);s.SearchClientActivityLogger.log("query_completed",i.id,_),f&&f.end(p?p:void 0)},error:function(e,t,r){"abort"!==t&&"function"==typeof _&&_(r);var o=e.getResponseHeader("x-dropbox-request-id"),l=s.SearchClientActivityLogger.create_search_log_dict(g,o,E,a.query,null,t,n,null);s.SearchClientActivityLogger.log("query_failed",i.id,l),f&&f.abort()},complete:function(){this._activeRequest=null}})},e.prototype.fetchAdditionalFileMetadata=function(e){var t=e.searchResults,r=e.user,s=e.onSuccess,i=e.onError,l=t.filter(function(e){return e instanceof a.File}),c=l.map(function(e){return[e.ns_id,e.sjid,e.fq_path.substr(0,e.fq_path.length-e.ns_path.length)]});c.length>0&&o.WebRequest({url:n.FILE_INFO_ENDPOINT,data:{nsid_sjid_fq_mount_point_tuples:JSON.stringify(c)},dataType:"json",subject_user:r,success:function(e,t,r){for(var o=e.file_results,a=[],i=0,n=o;i<n.length;i++){var l=n[i];a.push(l)}s(a)},error:function(e,t,r){"abort"!==t&&"function"==typeof i&&i(r)}})},e})();t.SearchApiClient=_,t.searchApiClient=new _}),define("modules/clean/search/search_results/actions",["require","exports","tslib","modules/clean/search/constants","modules/core/i18n","modules/clean/search/search_results/dispatcher","modules/clean/search/api","modules/clean/search/search_results/store","modules/clean/search/types","modules/clean/search/constants","modules/clean/search/store_helpers","modules/clean/search/search_helpers"],function(e,t,r,o,s,a,i,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),d=r.__importStar(d);var p=(function(){function e(e,t){void 0===e&&(e=i.searchApiClient),void 0===t&&(t=n.getSearchResultsStore()),this._searchApi=e,this._searchResultsStore=t}return e.prototype.runSearch=function(e){var t=this,r=e.user,s=e.path,i=e.query,n=e.searchSessionId,l=e.webTimer,u=e.logOnceFetchedDataRequiredForTTI,p=e.deletedFiles,h=e.showSymlinkIcon,_=e.expSinglePageSearch,f=e.fileCategories,m=e.deletedFileInCerebro,S=e.isPaperEnabled,g=void 0===S||S,E=d.generateRandomId();_||a.SearchResultsDispatcher.dispatch({type:o.CLEAR_SEARCH_ACTION}),a.SearchResultsDispatcher.dispatch({type:o.START_SEARCH_ACTION,data:{query:i,searchSessionId:n,queryId:E,fileCategories:f}});var F=c.MaxResults.MAX_SEARCH_RESULTS;p!==!0?this._searchApi.loadPartialResults({user:r,path:s,query:i,start:0,searchSessionId:n,showSymlinkIcon:h,includeBrowseContext:!0,webTimer:l,maxResults:F,fileCategories:f,onSuccess:function(e){var o=e.searchResults,a=e.context;u(),t._setSearchResults({searchResults:o,context:a,deletedFiles:!!p,queryId:E}),void 0===p&&t._loadDeletedResults({path:s,user:r,deletedFileInCerebro:m,isPaperEnabled:g}),t._searchApi.fetchAdditionalFileMetadata({searchResults:o,user:r,onSuccess:function(e){t._setFullSearchResults({searchResults:e,queryId:E})}})}}):this._searchApi.loadResults({user:r,path:s,query:i,start:0,maxResults:F,showPaperResults:!0,searchSessionId:n,showSymlinkIcon:h,webTimer:l,loadDeleted:p,overrideUrl:m?o.PARTIAL_SEARCH_FRONTEND_SERVICE_ENDPOINT:"",onSuccess:function(e){var o=e.searchResults,a=e.context;u(),t._setSearchResults({searchResults:o,context:a,deletedFiles:!!p,queryId:E}),void 0===p&&t._loadDeletedResults({path:s,user:r,deletedFileInCerebro:m,isPaperEnabled:g})}})},e.prototype.fetchCompleteSearchResultSRP=function(e){var t=this,r=e.searchResult,o=e.user,a=e.onSuccess,i=e.onError;if(r.isDeleted)return a(r);var l=n.getSearchResultsStore().fullSearchResults().get(r.fq_path,null);if(l){a(this._mergePartialAndCompleteResult({partialResult:r,completeResult:l}))}else this._searchApi.fetchAdditionalFileMetadata({searchResults:[r],user:o,onSuccess:function(e){if(e.length>0){a(t._mergePartialAndCompleteResult({partialResult:r,completeResult:e[0]}))}else if(i){var o=s._("There was a problem completing this request.");i(o)}},onError:i})},e.prototype._mergePartialAndCompleteResult=function(e){var t=e.partialResult,o=e.completeResult;return r.__assign({},t,o)},e.prototype.loadMoreResults=function(e){var t=this,s=e.path,i=e.user,n=e.deletedFiles,d=e.showSymlinkIcon,p=e.deletedFileInCerebro,h=e.isPaperEnabled,_=void 0===h||h,f=!1,m=this._searchResultsStore.latestFileCategories(),S=_?!(u.allCategoriesUnchecked(m)||u.allCategoriesChecked(m)):!(u.allCategoriesUnchecked(r.__assign({},m,(w={},w[l.FileCategory.PAPER]="unchecked",w)))||u.allCategoriesChecked(r.__assign({},m,(T={},T[l.FileCategory.PAPER]="checked",T))));if(this._searchResultsStore.loadingState()===o.SearchLoadingState.LOADED){if(void 0===n)if(this._searchResultsStore.hasMoreResults())f=!1;else{if(!this._searchResultsStore.hasMoreResults(!S))return;f=!0}else{if(!this._searchResultsStore.hasMoreResults(n&&!S))return;f=n&&!S}a.SearchResultsDispatcher.dispatch({type:o.CONTINUE_SEARCH_ACTION,data:{didLoadDeletedResults:f}});var g=f?this._searchResultsStore.numDeletedResults():this._searchResultsStore.searchResults().size,E=this._searchResultsStore.queryId();if(f)this._searchApi.loadResults({user:i,path:s,query:this._searchResultsStore.latestQuery(),fileNameOnly:!1,showPaperResults:!0,isDropdown:!1,isAdminConsole:!1,loadDeleted:f,start:g,maxResults:c.MaxResults.MAX_SEARCH_RESULTS,searchSessionId:this._searchResultsStore.searchSessionId(),showSymlinkIcon:d,overrideUrl:p?o.PARTIAL_SEARCH_FRONTEND_SERVICE_ENDPOINT:"",onSuccess:function(e){var r=e.searchResults,o=(e.context,e.deleted);t._appendSearchResults({searchResults:r,deleted:o}),void 0===n&&t._loadDeletedResults({path:s,user:i,deletedFileInCerebro:p,isPaperEnabled:_})}});else{var F=this._searchResultsStore.latestQuery();this._searchApi.loadPartialResults({user:i,path:s,query:F,start:g,showSymlinkIcon:d,includeBrowseContext:!1,searchSessionId:this._searchResultsStore.searchSessionId(),maxResults:c.MaxResults.MAX_SEARCH_RESULTS,fileCategories:m,onSuccess:function(e){var r=e.searchResults;e.context;t._appendSearchResults({searchResults:r,deleted:!1}),t._searchApi.fetchAdditionalFileMetadata({searchResults:r,user:i,onSuccess:function(e){t._setFullSearchResults({searchResults:e,queryId:E})}}),void 0===n&&t._loadDeletedResults({path:s,user:i,deletedFileInCerebro:p,isPaperEnabled:_})}})}var w,T}},e.prototype._setSearchResults=function(e){var t=e.searchResults,r=e.context,s=e.deletedFiles,i=e.queryId;a.SearchResultsDispatcher.dispatch({type:o.SET_SEARCH_RESULTS_ACTION,data:{searchResults:t,context:r,deletedFiles:s,queryId:i}})},e.prototype._setFullSearchResults=function(e){var t=e.searchResults,r=e.queryId;a.SearchResultsDispatcher.dispatch({type:o.SET_FULL_SEARCH_RESULTS_ACTION,data:{searchResults:t,queryId:r}})},e.prototype._appendSearchResults=function(e){var t=e.searchResults,r=e.deleted;a.SearchResultsDispatcher.dispatch({type:o.APPEND_SEARCH_RESULTS_ACTION,data:{searchResults:t,deleted:r}})},e.prototype._loadDeletedResults=function(e){var t=e.path,r=e.user,o=e.deletedFileInCerebro,s=e.isPaperEnabled;this._searchResultsStore.hasMoreResults()||this._searchResultsStore.didLoadDeletedResults()||this.loadMoreResults({path:t,user:r,deletedFileInCerebro:o,isPaperEnabled:s})},e.prototype.setSearchSelection=function(e){var t=e.selection;a.SearchResultsDispatcher.dispatch({type:o.SET_SEARCH_SELECTION_ACTION,data:{selection:t}})},e.prototype.clearSearch=function(){a.SearchResultsDispatcher.dispatch({type:o.CLEAR_SEARCH_ACTION})},e.prototype.setFileTypeFilter=function(e){var t=e.fileCategories;a.SearchResultsDispatcher.dispatch({type:o.SET_FILE_TYPE_FILTER_ACTION,data:{fileCategories:t}})},e.prototype.selectFirstFile=function(){a.SearchResultsDispatcher.dispatch({type:o.SELECT_FIRST_FILE_ACTION,data:{}})},e})();t.SearchResultsActions=p,t.searchResultsActions=new p}),define("modules/clean/search/search_results/controller",["require","exports","tslib","external/lodash","react","external/react-dom","modules/clean/filepath","modules/clean/react/browse/models","modules/clean/react/css","modules/clean/search/constants","modules/clean/search/search_results/actions","modules/clean/search/search_results/log_helper","modules/clean/search/search_results/store","modules/clean/search/search_results/view","modules/clean/web_user_action_events"],function(e,t,r,o,s,a,i,n,l,c,d,u,p,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importDefault(s),a=r.__importStar(a),i=r.__importStar(i),c=r.__importStar(c);var f=(function(t){function l(){var e=null!==t&&t.apply(this,arguments)||this;return e._onSearchResultsStoreChanged=function(){e.setState(e._getStateFromSearchResultsStore()),e.deferredCheckForMissingStarredData&&e.deferredCheckForMissingStarredData()},e._handleScroll=function(){if(a.findDOMNode(e).getBoundingClientRect().bottom<=window.innerHeight){var t=e.props,r=t.path,o=t.user,s=t.shouldShowDeletedFiles,i=t.searchResultsExperiments,n=t.isPaperEnabled,l=i.expShowSymlinkIcon,c=i.expDeletedFileInCerebro;d.searchResultsActions.loadMoreResults({path:r,user:o,showSymlinkIcon:!!l,deletedFiles:s,deletedFileInCerebro:!!c,isPaperEnabled:n})}},e._handleSelectionChange=function(e){d.searchResultsActions.setSearchSelection({selection:e})},e._handleLocationLinkClick=function(t,r){var o=e.props,s=o.user,a=o.viewType;if(u.recordSearchResultsAction({result:t,user:s,action_type:_.WebUserActionLogEvent.CLICK_PATH_LINK,view_type:a}),!r){var n=i.parent_dir(t.fq_path)
;e.props.onNavigateToPath(n)}},e._handleFilesViewShowShare=function(t,r){var o=e.props,s=o.user,a=o.filesViewActionHandlers,i=o.viewType;u.recordSearchResultsAction({result:t,user:s,action_type:_.WebUserActionLogEvent.SHARE,view_type:i}),a.onShowShare(t,r)},e}return r.__extends(l,t),l.prototype.componentWillMount=function(){this.state=this._getStateFromSearchResultsStore()},l.prototype.componentWillReceiveProps=function(e){e.arePostTTIModulesLoaded&&!this.props.arePostTTIModulesLoaded&&this.enableStarring()},l.prototype.componentDidMount=function(){p.getSearchResultsStore().add_change_listener(this._onSearchResultsStoreChanged),this.props.arePostTTIModulesLoaded&&this.enableStarring(),this.setState(this._getStateFromSearchResultsStore()),window.scrollTo(0,0)},l.prototype.componentWillUnmount=function(){p.getSearchResultsStore().remove_change_listener(this._onSearchResultsStoreChanged)},l.prototype.enableStarring=function(){var t=this,r=e("modules/clean/react/starred/browse_exports").checkForMissingStarredData;this.deferredCheckForMissingStarredData=function(){o.defer(function(){var e=[];p.getSearchResultsStore().searchResults().forEach(function(t){t instanceof n.File&&e.push(t),(t instanceof n.Paper||t instanceof n.PaperFolder)&&e.push(t)}),r({items:e,user:t.props.user})})},this.deferredCheckForMissingStarredData()},l.prototype._getStateFromSearchResultsStore=function(){var e=p.getSearchResultsStore(),t=e.latestQuery(),r=e.loadingState(),o=this.state?this.state.loadingState!==r&&this.state.loadingState===c.SearchLoadingState.LOADING_FIRST_PAGE?t:this.state.queryForResultsTitle:"";return{context:e.browseContext(),hasMoreResults:e.hasMoreResults(),loadingState:r,latestQuery:t,queryForResultsTitle:o,searchSessionId:e.searchSessionId(),fullSearchResults:e.fullSearchResults(),searchResults:e.searchResults(),selection:e.selection(),selectedFiles:e.selectedFiles()}},l.prototype.render=function(){var e=this.props,t=e.actionHandlers,a=e.searchResultsExperiments,i=e.searchBarExperiments,n=e.maestroSearchBarProps,l=e.onFocusSearchBar,c=e.onSearch,d=e.onNavigateToFileOrFolder,u=e.setFileUploaderPath,p=e.path,_=e.user,f=e.handleComponentTTI,m=e.ensureFileViewerClosedIfNotPreviewing,S=e.getIsFileJumping,g=e.isFileViewerShown,E=e.fileRename,F=e.arePostTTIModulesLoaded,w=e.getOverflowMenuActions,T=e.filesViewActionHandlers,y=e.onNavigateToParentFolder,v=e.shouldShowDeletedFiles,b=e.browseExperiments,R=e.onOpenPaper,A=e.renderSharedWithController,C=e.hrefForFile,I=e.responsive,P=e.onSearchFiltersChanged,O=e.starredState,N=e.fileCategories,D=e.viewType,L=e.pageHeaderHeight,x=this.state,M=x.context,U=x.hasMoreResults,B=x.loadingState,q=x.latestQuery,k=x.queryForResultsTitle,V=x.searchSessionId,W=x.searchResults,H=x.selection,G=x.selectedFiles,z=r.__assign({},T,{onShowShare:this._handleFilesViewShowShare});return s.default.createElement(h.SearchResultsView,{filesViewActionHandlers:z,searchResultsExperiments:a,searchBarExperiments:i,browseExperiments:b,maestroSearchBarProps:n,onFocusSearchBar:l,onSearch:c,onScroll:o.throttle(this._handleScroll,200),setFileUploaderPath:u,onSelectionChange:this._handleSelectionChange,path:p,user:_,actionHandlers:t,handleComponentTTI:f,ensureFileViewerClosedIfNotPreviewing:m,getIsFileJumping:S,isFileViewerShown:g,fileRename:E,arePostTTIModulesLoaded:F,getOverflowMenuActions:w,onLocationLinkClick:this._handleLocationLinkClick,onNavigateToFileOrFolder:d,onNavigateToParentFolder:y,onOpenPaper:R,context:M,hasMoreResults:U,loadingState:B,latestQuery:q,queryForResultsTitle:k,searchSessionId:V,searchResults:W,selection:H,selectedFiles:G,viewType:D,shouldShowDeletedFiles:v,renderSharedWithController:A,hrefForFile:C,responsive:I,onSearchFiltersChanged:P,starredState:O,fileCategories:N,pageHeaderHeight:L})},l})(s.default.Component);t.SearchResultsController=l.requireCssWithComponent(f,["/static/css/browse/browse-vflmJk5i5.css","/static/css/search/search_results-vflT65vb7.css","/static/css/scooter/scooter-scoped-vflrM1SRf.css"])}),define("modules/clean/search/search_results/dispatcher",["require","exports","tslib","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/search/search_results/store"],function(e,t,r,o,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.SearchResultsDispatcher={dispatch:function(e){o.assert(a.searchResultsStoreInstantiated(),"Must call getSearchResultsStore() before a dispatch"),s.Dispatcher.dispatch(e)}}}),define("modules/clean/search/search_results/log_helper",["require","exports","tslib","modules/clean/search/logger","modules/clean/search/search_results/store","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/data/action_creators"],function(e,t,r,o,s,a,i){"use strict";function n(e){var t=e.result,r=e.user,n=e.action_type,l=e.view_type,c=s.getSearchResultsStore().searchSessionId(),d=s.getSearchResultsStore().latestQuery(),u={rawQuery:d,normalizedQuery:d};a.getStoreForSearchBar().dispatch(i.addQueryToHistory({user:r,query:u,searchSessionId:c,requestId:t.request_id||""})),o.logSearchAction({searchSessionId:c,result:t,user:r,action_type:n,search_type:"full_page",viewport:"full-view",view_type:l})}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.recordSearchResultsAction=n}),define("modules/clean/search/search_results/search_filters",["require","exports","tslib","react","modules/core/i18n","spectrum/tertiary_link","spectrum/label","spectrum/radio_button","spectrum/checkbox","modules/clean/filepath","modules/clean/react/async_folder_selector_modal","modules/clean/react/path_filter_button","modules/clean/search/types","modules/clean/search/search_helpers","modules/clean/search/search_bar/experiments","spectrum/icon_arrow","modules/clean/search/constants","external/classnames","spectrum/icon_content","spectrum/tooltip","modules/clean/search/constants","spectrum/button"],function(e,t,r,o,s,a,i,n,l,c,d,u,p,h,_,f,m,S,g,E,F,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),c=r.__importStar(c),d=r.__importStar(d),S=r.__importDefault(S);var T=(function(e){function t(T){var y=e.call(this,T)||this;y.showFolderFilterModal=function(){var e=y.props,t=e.user,r=e.path,o=e.onFiltersChanged,a=e.deletedFiles,i=e.searchBarExperiments,n=void 0===i?{}:i;d.show({primaryAction:s._("Select"),secondaryAction:s._("Cancel"),title:s._("Select a folder"),ariaLabel:s._("Folder selector"),user:t,initialFolderSelection:r,forceRootSelectable:!0,onFolderSelected:function(e){o({path:e,deletedFiles:a})},showFolderPicker:!!n.expUseNewFolderPicker})},y.resetFilters=function(){var e=y.props,t=e.searchBarExperiments,o=e.onFiltersChanged,s={};_.isInDeletedFilterRightRailExperiment(t)&&(s.deletedFiles=!1),s.path="/",h.isInFileTypeFilterExperiment(t)&&(s.fileCategories=h.isInFileTypeFilterExperimentAllChecked(t)?r.__assign({},F.FILE_CATEGORIES_CHECKED):r.__assign({},F.FILE_CATEGORIES_UNCHECKED)),o(s)},y.shouldRenderResetButton=function(){var e=y.props,t=e.path,r=e.deletedFiles,o=e.fileCategories,s=e.searchBarExperiments,a=h.fileCategoriesSet(o,s,y.props.isPaperEnabled);return!c.paths_are_equal(t,"/")||!!r||a},y.renderResetButton=function(){return o.default.createElement(a.TertiaryLink,{onClick:y.resetFilters,className:"search-filters__reset"},s._("Reset filters"))},y.renderPathFilter=function(){var e=y.props.path;return o.default.createElement("div",{className:"filter-item__row"},o.default.createElement("div",{className:"filter-item__column"},o.default.createElement("div",{className:"filter-item__desc"},s._("By folder")),o.default.createElement(u.PathFilterButton,{path:e,defaultText:s._("Any folder"),dropdownClasses:"filter-item__filter",onClick:y.showFolderFilterModal})))},y.handleDeletedFilesAll=function(){y.props.onFiltersChanged({deletedFiles:!1})},y.handleDeletedFilesDeleted=function(){y.props.onFiltersChanged({deletedFiles:!0})},y.handleFileTypeChanged=function(e,t,o){var s=o.target.name;y.props.onFiltersChanged({fileCategories:r.__assign({},y.props.fileCategories,(a={},a[s]=e,a))});var a},y.handleChangeFileTypeFiltersView=function(){y.setState({showAllFilters:!y.state.showAllFilters})},y.handleClearOrSelectAll=function(){h.allCategoriesChecked(y.props.fileCategories,y.props.isPaperEnabled)?y.props.onFiltersChanged({fileCategories:r.__assign({},F.FILE_CATEGORIES_UNCHECKED)}):(y.props.onFiltersChanged({fileCategories:r.__assign({},F.FILE_CATEGORIES_CHECKED)}),y.setState({showAllFilters:!0}))},y.handleOnlyButtonClicked=function(e){return function(){y.props.onFiltersChanged({fileCategories:r.__assign({},F.FILE_CATEGORIES_UNCHECKED,(t={},t[e]="checked",t))});var t}},y.renderDeletedFilter=function(){var e=y.props.deletedFiles;return o.default.createElement("div",{className:"filter-item__row"},o.default.createElement("div",{className:"filter-item__column"},o.default.createElement("div",{className:"filter-item__desc"},s._("By status")),o.default.createElement("div",null,o.default.createElement(i.Label,{htmlFor:"filter-type-all"},o.default.createElement(n.RadioButton,{"aria-checked":!0,checked:!e,id:"filter-type-all",value:"all",onChange:y.handleDeletedFilesAll}),s._("Available"))),o.default.createElement("div",null,o.default.createElement(i.Label,{htmlFor:"filter-type-deleted"},o.default.createElement(n.RadioButton,{"aria-checked":!0,checked:e,id:"filter-type-deleted",value:"deleted",onChange:y.handleDeletedFilesDeleted}),s._("Deleted")))))},y.renderFileTypeFilter=function(){var e=y.renderFileTypeFilterCheckboxes(),t=y.state.showAllFilters?"up":"down",r=y.state.showAllFilters?s._("Show Less"):s._("Show More"),i=h.allCategoriesChecked(y.props.fileCategories,y.props.isPaperEnabled),n=i?s._("Clear all"):s._("Select all");return o.default.createElement("div",{className:"filter-item__row"},o.default.createElement("div",{className:"filter-item__column"},o.default.createElement("div",{className:"filter-item__desc"},s._("By type"),o.default.createElement(a.TertiaryLink,{onClick:y.handleClearOrSelectAll,className:"filter-type-file-select-or-clear-all-button"},n)),e,o.default.createElement("button",{className:"show-more-filters",onClick:y.handleChangeFileTypeFiltersView},o.default.createElement("div",{className:"show-more-filters__arrow show-more-filters__arrow-"+t},o.default.createElement(f.IconArrow,{name:"right"})),r)))},y.renderFileTypeFilterCheckboxes=function(){var e=[],r=0;return Object.keys(t.FileCategoryData).forEach(function(t){(y.props.isPaperEnabled||t!==p.FileCategory.PAPER)&&(e.push(y.createCheckBox(t,r>=m.NUMBER_FILE_TYPE_CHECKBOXES_ALWAYS_SHOWN)),r++)}),e},y.createCheckBox=function(e,r){var a=y.props.searchBarExperiments,n=h.isInFileTypeFilterExperimentAllChecked(a),c=t.FileCategoryData[e].label,d=t.FileCategoryData[e].icon,u=t.FileCategoryData[e].tooltip,p="filter-type-file-"+e,_="filter-type-file-only-"+e,f="filter-type-file-label filter-type-file-label__"+(n?"partial-width":"full-width"),m=y.state.showAllFilters?"":S.default({"filter-type-file-checkbox__hidden":r}),F=o.default.createElement("div",{className:"filter-type-file-icon-wrapper"},o.default.createElement(E.Tooltip,{tooltipContent:u,positioning:"left"},o.default.createElement(g.IconContent,{className:"filter-type-file-icon",name:d}))),T=n?o.default.createElement(i.Label,{htmlFor:_,className:"filter-type-file-only-button-label"},o.default.createElement(w.Button,{className:"filter-type-file-only-button",onClick:y.handleOnlyButtonClicked(e),variant:"styleless"},s._("Only",{comment:"This string is used on the file type filters as a button that selects only that filter from the list of them. It is displayed when a user hovers over a checkbox in the filters."})),F):F;return o.default.createElement("div",{key:p,className:"filter-type-file-checkbox-wrapper "+m},o.default.createElement(i.Label,{htmlFor:p,className:f},o.default.createElement(l.Checkbox,{name:e,"aria-checked":!0,checked:y.props.fileCategories[e],id:p,onChange:y.handleFileTypeChanged,className:"filter-type-file-checkbox"}),c,n?null:T),n?T:null)},y.handleClick=function(e){e.stopPropagation()};var v=y.props.searchBarExperiments,b=h.fileCategoriesToString(y.props.fileCategories);return!h.isInFileTypeFilterExperimentAllChecked(v)&&_.isInDeletedFilterRightRailExperiment(v)?y.state={showAllFilters:!!b}:y.state={showAllFilters:!0},y.props.fileTypeFilterEnabled&&h.isInFileTypeFilterExperiment(v)&&void 0===t.FileCategoryData&&(t.FileCategoryData=(R={},R[p.FileCategory.IMAGE]={label:s._("Images"),tooltip:s._("JPG, PNG, GIF, and more",{comment:"Intended to represent 3 of the most common file formats for images."}),icon:"image-small"},R[p.FileCategory.DOCUMENT]={label:s._("Documents"),tooltip:s._("DOC, DOCX, TXT, and more",{comment:"Intended to represent 3 of the most common file formats for documents."}),icon:"docx-small"},R[p.FileCategory.PDF]={label:s._("PDFs"),tooltip:s._("PDF"),icon:"pdf-small"},R[p.FileCategory.SPREADSHEET]={label:s._("Spreadsheets"),tooltip:s._("XLSX, XLS, CSV, and more",{comment:"Intended to represent 3 of the most common file formats for spreadsheets."}),icon:"xls-small"},R[p.FileCategory.PRESENTATION]={label:s._("Presentations"),tooltip:s._("PPT, PPTX, KEY, and more",{comment:"Intended to represent 3 of the most common file formats for presentations."}),icon:"ppt-small"},R[p.FileCategory.AUDIO]={label:s._("Audio"),tooltip:s._("MP3, WAV, MID, and more",{comment:"Intended to represent 3 of the most common file formats for audio."}),icon:"audio-small"},R[p.FileCategory.VIDEO]={label:s._("Video"),tooltip:s._("MOV, WMV, MP4, and more",{comment:"Intended to represent 3 of the most common file formats for videos."}),icon:"video-small"},R[p.FileCategory.FOLDER]={label:s._("Folders"),tooltip:s._("Dropbox folders"),icon:"folder-small"},R[p.FileCategory.PAPER]={label:s._("Paper docs"),tooltip:s._("Dropbox Paper docs"),icon:"paper-small"},R[p.FileCategory.OTHER]={label:s._("Other"),tooltip:s._("Other filetypes"),icon:"unknown-small"},R)),y;var R}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.searchBarExperiments,o=e.fileCategories;e.fileTypeFilterEnabled?h.isInFileTypeFilterExperimentAllChecked(t)&&h.allCategoriesUnchecked(o)&&this.props.onFiltersChanged({fileCategories:r.__assign({},F.FILE_CATEGORIES_CHECKED)}):h.allCategoriesUnchecked(o)||this.props.onFiltersChanged({fileCategories:r.__assign({},F.FILE_CATEGORIES_UNCHECKED)})},t.prototype.render=function(){var e=this.props.searchBarExperiments;return o.default.createElement("div",{onClick:this.handleClick},o.default.createElement("div",{className:"filter-header"},o.default.createElement("h3",null,s._("Filter")),this.shouldRenderResetButton()&&this.renderResetButton()),o.default.createElement("div",{className:"filter-item"},this.renderPathFilter()),o.default.createElement("div",{className:"filter-item"},this.props.fileTypeFilterEnabled&&h.isInFileTypeFilterExperiment(e)&&this.renderFileTypeFilter()),o.default.createElement("div",{className:"filter-item"},_.isInDeletedFilterRightRailExperiment(e)&&this.renderDeletedFilter()))},t})(o.default.Component);t.SearchFilters=T}),define("modules/clean/search/search_results/sidebar_view",["require","exports","tslib","react","modules/core/exception","modules/clean/react/browse/util","modules/core/i18n","modules/clean/search/search_results/search_filters","modules/clean/react/app_actions_view"],function(e,t,r,o,s,a,i,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o);var c=(function(t){function c(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(c,t),c.prototype.render=function(){var t=this.props,r=t.context,c=t.selectedFiles,d=t.arePostTTIModulesLoaded,u=t.user,p=t.path,h=t.actionHandlers,_=t.searchBarExperiments,f=t.shouldShowDeletedFiles,m=t.viewType,S=t.responsive,g=t.onSearchFiltersChanged,E=t.fileCategories,F=t.isNautilusEnabled,w=t.isPaperEnabled;if(c.size){var T=[];if(d){T=e("modules/clean/react/browse/file_actions").getActionsForFileCollection({files:c,context:r,user:u,viewType:m,actionHandlers:h,isSearchMode:!0,responsive:S,showNewMoveDialog:!0})}if(T.length){s.assert("function"!=typeof T[0],"The primary menu item for AppActionsView must be a BrowseAppActionLink");var y=T[0],v={displayName:y.label,handleClick:y.performAction,iconName:y.iconName,className:y.className,disabled:y.disabled},b=T.slice(1).map(function(e){return"function"==typeof e?e:{displayName:e.label,handleClick:e.performAction,iconName:e.iconName,className:e.className,disabled:e.disabled}}),R=a.getSelectedFilesText(c,r);return o.default.createElement(l.AppActionsView,{headerText:R,popoverTriggerLabel:i._("Actions"),primaryMenuItem:v,secondaryMenuItems:b,responsive:S})}}return o.default.createElement(n.SearchFilters,{user:u,searchBarExperiments:_,path:p,onFiltersChanged:g,deletedFiles:f,fileCategories:E,fileTypeFilterEnabled:F,isPaperEnabled:w})},c})(o.default.PureComponent);t.SearchResultsSidebarView=c}),define("modules/clean/search/search_results/store",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/react/selection","modules/clean/search/constants","modules/clean/react/browse/models","modules/clean/search/store_helpers"],function(e,t,r,o,s,a,i,n,l,c){"use strict";function d(){return null===h&&(h=new p),h}function u(){return null!==h}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),n=r.__importStar(n),c=r.__importStar(c);var p=(function(e){function t(t){var r=e.call(this,t)||this;return r._resetSearchResults(),r}return r.__extends(t,e),t.prototype._resetSearchResults=function(){this._browseContext=void 0,this._rawQuery="",this._latestQuery="",this._loadingState=n.SearchLoadingState.LOADED,this._fullSearchResults=o.OrderedMap(),this._searchResults=o.List(),this._selection=void 0,this._hasMoreLiveResults=!0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._didLoadDeletedResults=!1,this._latestFileCategories=n.FILE_CATEGORIES_UNCHECKED},t.prototype.rawQuery=function(){return this._rawQuery},t.prototype.searchSessionId=function(){return this._searchSessionId},t.prototype.queryId=function(){return this._queryId},t.prototype.browseContext=function(){return this._browseContext||(this._browseContext=new l.BrowseContext)},t.prototype.latestQuery=function(){return this._latestQuery},t.prototype.loadingState=function(){return this._loadingState},t.prototype.searchResults=function(){return this._searchResults},t.prototype.fullSearchResults=function(){return this._fullSearchResults},t.prototype.hasMoreResults=function(e){return void 0===e&&(e=!1),this._hasMoreLiveResults||e&&this._hasMoreDeletedResults},t.prototype.numDeletedResults=function(){return this._numDeletedResults},t.prototype.didLoadDeletedResults=function(){return this._didLoadDeletedResults},t.prototype.selection=function(){return this._selection||(this._selection=i.createSelection())},t.prototype.selectedFiles=function(){var e=this,t=this._searchResults.filter(function(t){return t instanceof l.File&&e.selection().selected.has(t.fq_path)});return o.OrderedMap(t.map(function(e){return[e.fq_path,e]}))},t.prototype.latestFileCategories=function(){return this._latestFileCategories},t.prototype._setRawQuery=function(e,t){t?this._searchSessionId=t:c.shouldStartNewSearchSession(this._rawQuery,e)&&(this._searchSessionId=c.generateRandomId()),this._rawQuery=e},t.prototype._setSearchQuery=function(e){var t=e.query;this._setRawQuery(t),this.emit_change()},t.prototype._startSearch=function(e){var t=e.query,r=e.searchSessionId,o=e.queryId,s=e.fileCategories;this._setRawQuery(t,r),this._latestQuery=c.normalize(t),this._loadingState=n.SearchLoadingState.LOADING_FIRST_PAGE,this._hasMoreLiveResults=!0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._didLoadDeletedResults=!1,this._queryId=o,this._latestFileCategories=s?s:n.FILE_CATEGORIES_UNCHECKED,this.emit_change()},t.prototype._setSearchResults=function(e){var t=e.searchResults,r=e.context,o=e.deletedFiles;e.queryId===this.queryId()&&(this._setSearchResultsInternal(t,o),this._loadingState=n.SearchLoadingState.LOADED,r&&(this._browseContext=r),this._updateMoreResults(t),this.emit_change())},t.prototype._setFullSearchResults=function(e){var t=e.searchResults;if(e.queryId===this._queryId){for(var r=0,o=t;r<o.length;r++){var s=o[r];this._fullSearchResults=this._fullSearchResults.set(s.fq_path,s)}this._loadingState=n.SearchLoadingState.LOADED,this.emit_change()}},t.prototype._setSearchResultsInternal=function(e,t){this._searchResults=o.List(e),t&&(this._numDeletedResults=e.length)},t.prototype._continueSearch=function(e){e.didLoadDeletedResults&&(this._didLoadDeletedResults=!0),this._loadingState=n.SearchLoadingState.LOADING_ADDITIONAL_PAGE,this.emit_change()},t.prototype._appendSearchResults=function(e){var t=e.deleted,r=e.searchResults;t&&(this._numDeletedResults+=r.length),this._searchResults=this._searchResults.concat(r),this._loadingState=n.SearchLoadingState.LOADED,this._updateMoreResults(r),this.emit_change()},t.prototype._clearSearch=function(){this._resetSearchResults(),this.emit_change()},t.prototype._updateMoreResults=function(e){var t=e.length===n.MaxResults.MAX_SEARCH_RESULTS;this._hasMoreLiveResults?this._hasMoreLiveResults=t:this._hasMoreDeletedResults&&(this._hasMoreDeletedResults=t)},t.prototype._setSearchSelection=function(e){var t=e.selection;this._selection=t,this.emit_change()},t.prototype._selectFirstFile=function(){var e=this._searchResults.find(function(e){return e instanceof l.File});e&&this._setSearchSelection({selection:i.createSelection([e.fq_path])})},t.prototype._applyFileDeltas=function(e){var t=e.fileDeltas;if(t){for(var r=function(e,t){var r=void 0;!e&&t?o._searchResults=o._searchResults.push(t):e&&!t?(r=o._searchResults.findIndex(function(t){return t instanceof l.File&&s.paths_are_equal(t.fq_path,e)}),o._searchResults=o._searchResults.delete(r)):e&&t&&(r=o._searchResults.findIndex(function(t){return t instanceof l.File&&s.paths_are_equal(t.fq_path,e)}),o._searchResults=r>-1?o._searchResults.set(r,t):o._searchResults.push(t))},o=this,a=0,i=t;a<i.length;a++){var n=i[a];r(n.before,n.after)}this.emit_change()}},t.prototype._new_payload=function(e){switch(e.action.type){case n.START_SEARCH_ACTION:this._startSearch(e.action.data);break;case n.SET_SEARCH_RESULTS_ACTION:this._setSearchResults(e.action.data);break;case n.CONTINUE_SEARCH_ACTION:this._continueSearch(e.action.data);break;case n.APPEND_SEARCH_RESULTS_ACTION:this._appendSearchResults(e.action.data);break;case n.SET_FULL_SEARCH_RESULTS_ACTION:this._setFullSearchResults(e.action.data);break;case n.SET_SEARCH_SELECTION_ACTION:this._setSearchSelection(e.action.data);break;case n.CHANGE_FILES_ACTION:this._applyFileDeltas(e.action.data);break;case n.CLEAR_SEARCH_ACTION:this._clearSearch();break;case n.SELECT_FIRST_FILE_ACTION:this._selectFirstFile()}},t})(a.Store);t.SearchResultsStore=p;var h=null;t.getSearchResultsStore=d,t.searchResultsStoreInstantiated=u}),define("modules/clean/search/search_results/view",["require","exports","tslib","external/lodash","react","spectrum/table","spectrum/tip_card","modules/clean/em_string","modules/clean/filepath","modules/clean/history","modules/clean/illustration_helper","modules/clean/react_format","modules/clean/react/files_view/constants","modules/clean/react/files_view/controller","modules/clean/react/files_view/file_list_empty_folder_table","modules/clean/react/files_view/fixed_table_head","modules/clean/react/files_view/types","modules/clean/react/image","modules/clean/search/constants","modules/clean/search/search_bar/experiments","modules/clean/search/search_helpers","modules/core/i18n","modules/core/uri"],function(e,t,r,o,s,a,i,n,l,c,d,u,p,h,_,f,m,S,g,E,F,w,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importDefault(s),l=r.__importStar(l),c=r.__importDefault(c),g=r.__importStar(g),F=r.__importStar(F);var y=(function(e){function t(t){var o=e.call(this,t)||this;return o._handleScroll=function(){o.props.onScroll()},o._ensureFileViewerClosedIfNotPreviewing=function(){var e=c.default.deconstruct_url().qargs;o.props.ensureFileViewerClosedIfNotPreviewing(e)},o._handleFullSearchOnClick=function(e){e.preventDefault(),o.props.onSearch(o.props.latestQuery,"/")},o._handleEmptyFolderViewTTI=function(){o.props.handleComponentTTI("FilesViewController")},o._handleSearchAllFiles=function(e){e.preventDefault();var t=o.props.path;o.props.onSearchFiltersChanged({path:t,deletedFiles:!1})},o._handleSearchDeletedFiles=function(e){e.preventDefault();var t=o.props.path;o.props.onSearchFiltersChanged({path:t,deletedFiles:!0})},o._handleRemoveAllFilters=function(e){e.preventDefault();var t=o.props,s=t.shouldShowDeletedFiles,a=t.searchBarExperiments;o.props.onSearchFiltersChanged({path:"/",deletedFiles:s,fileCategories:F.isInFileTypeFilterExperimentAllChecked(a)?r.__assign({},g.FILE_CATEGORIES_CHECKED):r.__assign({},g.FILE_CATEGORIES_UNCHECKED)})},o._getEmptyFolderViewUrl=function(e,t){var r=o.props,s=r.user,a=r.latestQuery,i=r.searchSessionId;return F.buildSearchURL({user:s,searchPath:e,normalizedQuery:a,searchSessionId:i,searchToken:F.getSearchCsrfToken(),qargs:{d:t?"1":void 0}}).toString()},o._getRemoveAllFiltersViewUrl=function(e){var t=o.props,r=t.user,s=t.latestQuery,a=t.searchSessionId,i=t.searchBarExperiments;return F.buildSearchURL({user:r,searchPath:"/",normalizedQuery:s,searchSessionId:a,searchToken:F.getSearchCsrfToken(),qargs:{d:e?"1":void 0,file_categories:F.isInFileTypeFilterExperimentAllChecked(i)?F.fileCategoriesToString(g.FILE_CATEGORIES_CHECKED):void 0}}).toString()},o._renderEmptyFolderSubtitle=function(){var e=o.props,t=e.path,r=e.shouldShowDeletedFiles,a=e.searchBarExperiments,i=e.fileCategories;return l.paths_are_equal(t,"/")&&!F.fileCategoriesSet(i,a)?r?u.reactFormat(w._("Try different keywords or <Link>search files that aren’t deleted</Link>"),{Link:s.default.createElement("a",{href:o._getEmptyFolderViewUrl(t,!1),onClick:o._handleSearchAllFiles})}):E.isInDeletedFilterRightRailExperiment(a)?u.reactFormat(w._("Try different keywords or <Link>search deleted files</Link>"),{Link:s.default.createElement("a",{href:o._getEmptyFolderViewUrl(t,!0),onClick:o._handleSearchDeletedFiles})}):w._("Try different keywords"):r?u.reactFormat(w._("<LinkScope>Search all folders</LinkScope> or <LinkDeleted>files that aren’t deleted</LinkDeleted>"),{LinkScope:s.default.createElement("a",{href:o._getEmptyFolderViewUrl("/",r),onClick:o._handleRemoveAllFilters}),LinkDeleted:s.default.createElement("a",{href:o._getEmptyFolderViewUrl(t,!1),onClick:o._handleSearchAllFiles})}):E.isInDeletedFilterRightRailExperiment(a)?u.reactFormat(w._("<LinkScope>Search all folders</LinkScope> or <LinkDeleted>deleted files</LinkDeleted>"),{LinkScope:s.default.createElement("a",{href:o._getEmptyFolderViewUrl("/",r),onClick:o._handleRemoveAllFilters}),LinkDeleted:s.default.createElement("a",{href:o._getEmptyFolderViewUrl(t,!0),onClick:o._handleSearchDeletedFiles})}):u.reactFormat(w._("Try <LinkScope>resetting all filters</LinkScope>"),{LinkScope:s.default.createElement("a",{href:o._getRemoveAllFiltersViewUrl(),onClick:o._handleRemoveAllFilters})})},o._renderEmptyFolderView=function(e){var t=o.props.path,r=l.paths_are_equal(t,"/"),i=w._("No results found");if(o.shouldRenderNewEmptyState())return s.default.createElement("div",null,s.default.createElement(a.Table,{columnFlex:[p.CHECKBOX_CELL_FLEX,1]},s.default.createElement(f.FixedTableHead,{offsetHeight:p.DEFAULT_COLUMN_HEADER_HEIGHT},s.default.createElement(a.TableHeadCell,{className:"brws-column-header-table-cell brws-checkbox-cell",key:"checkbox-cell",role:"columnheader",scope:"col"},s.default.createElement("div",{className:"brws-vertically-center"})),s.default.createElement(a.TableHeadCell,{role:"columnheader",scope:"col",className:"brws-column-header-table-cell"},s.default.createElement("div",{className:"normal brws-column-header-menu"},s.default.createElement("span",{className:"brws-column-header-menu-trigger-disabled"},o._searchResultsTitle(e))))),s.default.createElement("tbody",null,s.default.createElement("tr",null,s.default.createElement("td",null),s.default.createElement("td",null)))),s.default.createElement("div",{className:"u-font-center u-pad-top-xl"},s.default.createElement(S.Image,{src:d.empty_state_url("search"),srcHiRes:d.empty_state_url("search@2x"),alt:""}),s.default.createElement("h2",{className:"u-font-strong empty-folder-table-title"},i),s.default.createElement("span",null,o._renderEmptyFolderSubtitle())));var n=r?w._("Please update your search and try again"):w._("Search all of my Dropbox instead"),c=r?void 0:o._getFullSearchLink(),u=r?void 0:o._handleFullSearchOnClick;return s.default.createElement(_.EmptyFolderTable,{title:i,subtitle:n,subtitleLink:c,subtitleOnClick:u,onTTI:o._handleEmptyFolderViewTTI})},o._renderDeletedFilesTipcard=function(){return E.isInDeletedFilterRightRailExperiment(o.props.searchBarExperiments)&&o.props.shouldShowDeletedFiles&&o.props.loadingState===g.SearchLoadingState.LOADED&&o.props.searchResults.count()>0?s.default.createElement(i.TipCard,{className:"mc-tip-card--deleted-files"},u.reactFormat(w._("Can’t find what you’re looking for? <a>View all deleted files</a>"),{a:s.default.createElement("a",{href:"/deleted_files"})})):null},o.state={},o}return r.__extends(t,e),t.prototype.componentWillMount=function(){c.default.add_callback("/search",this._ensureFileViewerClosedIfNotPreviewing)},t.prototype.componentDidMount=function(){window.addEventListener("scroll",this._handleScroll)},t.prototype.componentWillUnmount=function(){window.removeEventListener("scroll",this._handleScroll),c.default.remove_callback("/search",this._ensureFileViewerClosedIfNotPreviewing)},t.prototype._getFullSearchLink=function(){var e=this.props,t=e.latestQuery,r=e.searchSessionId,o=e.user;return T.URI.parse("/search/"+o.role).setQuery({path:"/",query:t,searchSessionId:r}).toString()},t.prototype.shouldRenderNewEmptyState=function(){var e=this.props.searchBarExperiments;return F.isInFileTypeFilterExperiment(e)||E.isInDeletedFilterRightRailExperiment(e)||E.isInSinglePageSearchExperiment(e)},t.prototype._searchResultsTitle=function(e){var t=E.isInSinglePageSearchExperiment(this.props.searchBarExperiments)&&this.props.loadingState===g.SearchLoadingState.LOADING_FIRST_PAGE?this.props.queryForResultsTitle:this.props.latestQuery,r=this.props,o=r.searchResults,a=r.path,i=r.viewType,c=r.shouldShowDeletedFiles,d=o.size,p=l.paths_are_equal(a,"/");if(!this.shouldRenderNewEmptyState()&&0===d)return"";var h,_=e.isMatchedMedium?e.isMatchedLarge?30:20:10;i===m.ViewType.List&&(_/=2);if(p){var f=n.Emstring.em_snippet(t,_,.6);h=c?w.ungettext("%(size)d deleted result for “%(query)s”","%(size)d deleted results for “%(query)s”",d).format({size:d,query:f}):w.ungettext("%(size)d result for “%(query)s”","%(size)d results for “%(query)s”",d).format({size:d,query:f})}else{var S=n.Emstring.em_snippet(l.filename(a),_/2,.6),f=n.Emstring.em_snippet(t,_/2,.6);h=c?u.reactFormat(w.ungettext("%(size)d deleted result for “%(query)s” in <strong>%(path)s</strong>","%(size)d deleted results for “%(query)s” in <strong>%(path)s</strong>",d).format({size:d,query:f,path:S}),{strong:s.default.createElement("strong",null)}):u.reactFormat(w.ungettext("%(size)d result for “%(query)s” in <strong>%(path)s</strong>","%(size)d results for “%(query)s” in <strong>%(path)s</strong>",d).format({size:d,query:f,path:S}),{strong:s.default.createElement("strong",null)})}return h},t.prototype._getLoadingState=function(){var e=this.props,t=e.searchResults,r=e.searchBarExperiments,o=e.loadingState;return E.isInSinglePageSearchExperiment(r)&&!t.isEmpty()?m.LoadingState.LOADED:o===g.SearchLoadingState.LOADING_FIRST_PAGE?m.LoadingState.LOADING_FIRST_PAGE:o===g.SearchLoadingState.LOADING_ADDITIONAL_PAGE?m.LoadingState.LOADING_REMAINING_PAGES:m.LoadingState.LOADED},t.prototype._renderSearchResultItems=function(e){
var t=this.props,a=t.getOverflowMenuActions,i=t.onFocusSearchBar,n=t.onLocationLinkClick,l=t.onNavigateToFileOrFolder,c=t.onNavigateToParentFolder,d=t.onOpenPaper,u=t.context,_=t.fileRename,f=t.searchResults,S=t.getIsFileJumping,g=t.isFileViewerShown,E=t.arePostTTIModulesLoaded,F=t.handleComponentTTI,w=t.onSelectionChange,T=t.selectedFiles,y=t.selection,v=t.setFileUploaderPath,b=t.viewType,R=t.user,A=t.path,C=t.filesViewActionHandlers,I=t.renderSharedWithController,P=t.hrefForFile,O=t.starredState,N=t.pageHeaderHeight;return s.default.createElement(h.FilesViewController,r.__assign({},C,{getOverflowMenuActions:a,onLocationLinkClick:n,onNavigateToFileOrFolder:l,onNavigateToParentFolder:c,onOpenPaper:d,context:u,customEmptyFolderView:this._renderEmptyFolderView,createNewFolderState:m.NewFolderCreationState.CREATE_FOLDER_INACTIVE,fileRename:_,items:f,getIsFileJumping:S,isFileViewerShown:g,isSearchMode:!0,arePostTTIModulesLoaded:E,isTextSelectable:!1,loadingState:this._getLoadingState(),onComponentTTI:F,onSelectionChange:w,onSortChange:o.noop,onFocusSearchBar:i,path:A,selectedFiles:T,selection:y,setFileUploaderPath:v,showFileUploaderModal:o.noop,user:R,viewType:b,totalNumFiles:f.size,responsive:e,columns:this._generateColumns(e),renderSharedWithController:I,hrefForFile:P,viewTypes:p.AllViewTypes,viewTypeLabels:p.ViewTypeLabels,starredState:O,pageHeaderHeight:N}))},t.prototype._generateColumns=function(e){var t=this;return(this.props.shouldShowDeletedFiles?p.SEARCH_LIST_VIEW_COLUMNS_DELETED:p.SEARCH_LIST_VIEW_COLUMNS).map(function(o,s){return r.__assign({},o,{label:0===s?t._searchResultsTitle(e):o.label})})},t.prototype.render=function(){var e=this.props.responsive;return s.default.createElement("div",{className:"search-results"},this._renderSearchResultItems(e),this._renderDeletedFilesTipcard())},t})(s.default.Component);t.SearchResultsView=y}),define("modules/clean/web_upload_action_logger",["require","exports","tslib","modules/clean/ajax"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.MAX_ERRORS=3;var s=(function(){function e(){this.errorCount=0,this.lastError=Date.now(),this.shouldReport=!0}return e.prototype.log=function(e,r,s){var a=this;return this.shouldReport&&(this.errorCount<t.MAX_ERRORS||Date.now()-this.lastError>6e5)?new Promise(function(i,n){o.SilentBackgroundRequest({url:"/log/web_upload_action",data:{_subject_uid:e,event_type:r,extra_params:JSON.stringify(s)},error:function(e){429===e.status?a.errorCount=t.MAX_ERRORS:a.errorCount++,a.lastError=Date.now(),n(e)},success:function(e){try{var t=JSON.parse(e);t&&!t.continue_sending&&(a.shouldReport=!1),a.errorCount=0,i(e)}catch(e){throw a.errorCount++,a.lastError=Date.now(),n(e),e}}})}):Promise.resolve({})},e})();t.WebUploadActionLog=new s,t.WebUploadActionLogClass=s});
//# sourceMappingURL=pkg-browse.min.js-vfl3oXTkG.map