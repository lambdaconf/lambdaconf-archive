define(["require","exports","tslib","react","classnames","spectrum_comments/thread","spectrum_comments/comment_stream/comment_stream_post_bar","spectrum_comments/comment","spectrum_comments/comment_editor/comment_utils","spectrum_comments/comment_editor/comment_editor","prop-types","spectrum_comments/comment_stream/unread_pill_wrapper","spectrum_comments/utils/calc_unread_pill_data","spectrum_comments/utils/throttle"],function(e,t,n,o,r,a,i,d,s,c,m,l,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=function(){};i.CommentStreamPostBar.contextTypes={localization:m.object};var f=(function(e){function t(t){var n=e.call(this,t)||this;return n.threadIdToRef={},n.editorHasChanges={},n.onThreadActivated=function(e){return function(){n.props.actionsAdapter.onThreadActivated(e)}},n.onStartEdit=function(e){n.setState({editedComment:e})},n.onEndEdit=function(){n.setState({editedComment:void 0})},n.setDraftRef=function(e){n.draftRef=e},n.handleClick=function(e){e.currentTarget===e.target&&n.props.actionsAdapter.onAllThreadsDeactivated()},n.onThreadReplyCancel=function(){n.props.actionsAdapter.onAllThreadsDeactivated()},n.onPrimaryEditorCancel=function(){n.props.actionsAdapter.onCommentDraftCancel(),n.setState({content:s.createEmptyContent(),editedComment:void 0})},n.onPrimaryEditorFocus=function(){n.props.actionsAdapter.onAllThreadsDeactivated(),n.props.actionsAdapter.onEditorFocused()},n.onEditorContentChange=function(e){return function(t){n.editorHasChanges[e]=!t.isEmpty}},n.onPrimaryEditorContentChange=n.onEditorContentChange("PRIMARY"),n.hasUnsavedChanges=function(){var e=n.props.threads;return n.editorHasChanges.PRIMARY||e.some(function(e){return n.editorHasChanges[e.id]||!!e.pending})||void 0!==n.state.editedComment},n.promptBeforeCloseHandler=function(e){if(n.hasUnsavedChanges())return e.returnValue="",e.preventDefault(),""},n.createThreadActions=function(e){var t=n.props.actionsAdapter,o=t.onCommentDeleted,r=t.onCommentEdited,a=t.onClickTimeCode,i=t.onEditorFocused,d=t.onMentionsQueryUpdated,s=t.onThreadMarkedAsRead,c=t.onThreadMarkedAsUnread,m=t.onThreadRepliedTo,l=t.onThreadResolved,u=t.onThreadUnresolved,p=t.onThreadMouseEnter,f=void 0===p?h:p,C=t.onThreadMouseLeave,v=void 0===C?h:C;return{onClickTimeCode:a,onReply:function(t){return m(e,t)},onMarkAsRead:function(){return s(e)},onMarkAsUnread:function(){return c(e)},onResolve:function(){return l(e)},onUnresolve:function(){return u(e)},onMouseEnter:function(){return f(e)},onMouseLeave:function(){return v(e)},onEditorFocused:function(){return i(e)},onCommentDeleted:function(t){return o(t,e)},onCommentEdited:function(t,n){return r(t,n,e)},onMentionsQueryUpdated:d,onEditorContentChange:n.onEditorContentChange(e)}},n.renewUnreadPillData=function(){var e=n.scrollListRef.listRef;if(e){var t=e.getBoundingClientRect();n.setState({unreadPillData:u.calcUnreadPillData({containerTop:t.top,containerBottom:t.bottom,threadIdToRef:n.threadIdToRef,threads:n.props.threads})})}},n.state={content:s.createEmptyContent(),editedComment:void 0,unreadPillData:{unreadsAbove:0,nearestUnreadThreadAbove:null,unreadsBelow:0,nearestUnreadThreadBelow:null}},n.throttledRenewUnreadPillData=p.throttle(n.renewUnreadPillData,250),n}return n.__extends(t,e),t.prototype.getChildContext=function(){return{localization:this.props.localization}},t.prototype.componentDidMount=function(){window.addEventListener("beforeunload",this.promptBeforeCloseHandler)},t.prototype.componentWillUnmount=function(){window.removeEventListener("beforeunload",this.promptBeforeCloseHandler)},t.prototype.focusPrimaryEditor=function(){this.draftRef&&this.draftRef.focusEditor()},t.prototype.render=function(){var e=this,t=this.props,a=t.actionsAdapter,s=a.onMentionsQueryUpdated,m=a.onThreadCreated,u=t.className,p=void 0===u?"":u,h=t.commentComponent,f=void 0===h?function(e){return o.createElement(d.Comment,n.__assign({},e))}:h,C=t.editorComponent,v=void 0===C?function(e){return o.createElement(c.CommentEditor,n.__assign({},e))}:C,E=t.enabled,T=t.user,_=t.mentionsMatches,y=t.activeThreadID,A=t.hoverThreadID,g=t.isMobile,P=t.threads,R=t.localization,M=r(p,{"sc-comment-stream":!0,"sc-comment-stream-enabled":E,"sc-comment-stream-all-changes-saved":!this.hasUnsavedChanges()}),U=null;T&&!g&&(U=v({author:T,className:"sc-comment-stream-editor",content:this.state.content,placeholder:R.streamEditorPlaceholder,postSignalComponent:i.CommentStreamPostBar,onCancel:this.onPrimaryEditorCancel,setDraftRef:this.setDraftRef,onPost:m,mentionsMatches:_,onMentionsQueryUpdated:s,onFocus:this.onPrimaryEditorFocus,onContentChange:this.onPrimaryEditorContentChange}));var D=P.reduce(function(t,o){return n.__assign({},t,(r={},r[o.id]={actions:e.createThreadActions(o.id),active:o.id===y,hover:o.id===A,commentComponent:f,editedComment:e.state.editedComment,onActivated:e.onThreadActivated(o),onCancel:e.onThreadReplyCancel,onStartEdit:e.onStartEdit,onEndEdit:e.onEndEdit,isMobile:g,thread:o,user:T,mentionsMatches:_},r));var r},{});return o.createElement(l.UnreadPillWrapper,{clickHandler:this.handleClick,editor:U,onThreadActivated:this.onThreadActivated,threads:P,threadIdToThreadProps:D,showUnreadPill:this.props.showUnreadPill,wrapperClassnames:M})},t.childContextTypes={localization:m.object},t})(o.PureComponent);t.CommentStream=f,a.Thread.displayName="Thread"});
//# sourceMappingURL=comment_stream.min.js-vfl6ePcj0.map